Lambda Calculus

\begin{code}%
\>\AgdaKeyword{module} \AgdaModule{Examples.LambdaCalculus} \AgdaKeyword{where}\<%
\\
%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{Function} \AgdaKeyword{hiding} \AgdaSymbol{(}\AgdaFunction{\_⟨\_⟩\_}\AgdaSymbol{)}\<%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{Data.Nat} \AgdaKeyword{hiding} \AgdaSymbol{(}\AgdaFunction{fold}\AgdaSymbol{;}\AgdaPrimitive{\_*\_}\AgdaSymbol{)}\<%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{Data.Nat.Properties}\<%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{Data.Sum}\<%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{Data.List}\<%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{Data.Empty}\<%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{Relation.Nullary}\<%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{Data.Product} \AgdaKeyword{hiding} \AgdaSymbol{(}\AgdaFunction{swap}\AgdaSymbol{;}\AgdaFunction{,\_}\AgdaSymbol{)}\<%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{Relation.Binary} \AgdaKeyword{hiding} \AgdaSymbol{(}\AgdaFunction{Rel}\AgdaSymbol{)}\<%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{Data.List.Any} \AgdaSymbol{as} \AgdaModule{Any} \AgdaKeyword{hiding} \AgdaSymbol{(}\AgdaFunction{tail}\AgdaSymbol{;}\AgdaFunction{map}\AgdaSymbol{)}\<%
\\
\>\AgdaKeyword{open} \AgdaModule{Any.}\AgdaModule{Membership-≡} \AgdaKeyword{renaming} \AgdaSymbol{(}\AgdaFunction{\_⊆\_} \AgdaSymbol{to} \AgdaFunction{\_⊆l\_}\AgdaSymbol{)}\<%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{Relation.Binary.PropositionalEquality} \AgdaSymbol{as} \AgdaModule{PropEq} \AgdaKeyword{renaming} \AgdaSymbol{(}\AgdaInductiveConstructor{[\_]} \AgdaSymbol{to} \AgdaInductiveConstructor{[\_]ᵢ}\AgdaSymbol{;}\AgdaFunction{trans} \AgdaSymbol{to} \AgdaFunction{trans≡}\AgdaSymbol{)}\<%
\\
\>\AgdaKeyword{open} \AgdaModule{PropEq.}\AgdaModule{≡-Reasoning} \AgdaKeyword{renaming} \AgdaSymbol{(}\AgdaFunction{begin\_} \AgdaSymbol{to} \AgdaFunction{begin≡\_}\AgdaSymbol{;}\AgdaFunction{\_∎} \AgdaSymbol{to} \AgdaFunction{\_□}\AgdaSymbol{)}\<%
\\
%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{GPBindings}\<%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{Atom}\<%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{Swap}\<%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{FreeVariables}\<%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{Alpha}\<%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{AlphaInduction}\<%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{OccurBind}\<%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{List.ListProperties}\<%
\\
%
\\
\>\AgdaKeyword{infix} \AgdaNumber{8} \AgdaFunction{\_·\_}\<%
\end{code}

\begin{code}%
\>\AgdaFunction{SortλTermVars} \AgdaSymbol{:} \AgdaFunction{Sort}\<%
\\
\>\AgdaFunction{SortλTermVars} \AgdaSymbol{=} \AgdaNumber{1}\<%
\end{code}

%<*lambdacalculus>
\begin{code}%
\>\AgdaFunction{λF} \AgdaSymbol{:} \AgdaDatatype{Functor} \<[41]%
\>[41]\AgdaComment{-- M,N  :-}\<%
\\
\>\AgdaFunction{λF} \AgdaSymbol{=} \<[10]%
\>[10]\AgdaInductiveConstructor{|v|} \AgdaFunction{SortλTermVars} \<[41]%
\>[41]\AgdaComment{--           x}\<%
\\
\>[0]\AgdaIndent{5}{}\<[5]%
\>[5]\AgdaInductiveConstructor{|+|} \<[10]%
\>[10]\AgdaInductiveConstructor{|R|} \AgdaInductiveConstructor{|x|} \AgdaInductiveConstructor{|R|} \<[41]%
\>[41]\AgdaComment{--      |    M N}\<%
\\
\>[0]\AgdaIndent{5}{}\<[5]%
\>[5]\AgdaInductiveConstructor{|+|} \<[10]%
\>[10]\AgdaInductiveConstructor{|B|} \AgdaFunction{SortλTermVars} \AgdaInductiveConstructor{|R|} \<[41]%
\>[41]\AgdaComment{--      |    λ x M}\<%
\end{code}
%</lambdacalculus>

%<*lambdacalculusmu>
\begin{code}%
\>\AgdaFunction{λTerm} \AgdaSymbol{:} \AgdaPrimitiveType{Set}\<%
\\
\>\AgdaFunction{λTerm} \AgdaSymbol{=} \AgdaDatatype{μ} \AgdaFunction{λF}\<%
\end{code}
%</lambdacalculusmu>

%<*lambdaconstvar>
\begin{code}%
\>\AgdaFunction{v} \AgdaSymbol{:} \AgdaFunction{V} \AgdaSymbol{→} \AgdaFunction{λTerm}\<%
\\
\>\AgdaFunction{v} \AgdaSymbol{=} \AgdaInductiveConstructor{⟨\_⟩} \AgdaFunction{∘} \AgdaInductiveConstructor{inj₁}\<%
\end{code}
%</lambdaconstvar>

%<*lambdaconstapp>
\begin{code}%
\>\AgdaFunction{\_·\_} \AgdaSymbol{:} \AgdaFunction{λTerm} \AgdaSymbol{→} \AgdaFunction{λTerm} \AgdaSymbol{→} \AgdaFunction{λTerm}\<%
\\
\>\AgdaBound{M} \AgdaFunction{·} \AgdaBound{N} \AgdaSymbol{=} \AgdaInductiveConstructor{⟨} \AgdaInductiveConstructor{inj₂} \AgdaSymbol{(}\AgdaInductiveConstructor{inj₁} \AgdaSymbol{(}\AgdaBound{M} \AgdaInductiveConstructor{,} \AgdaBound{N}\AgdaSymbol{))} \AgdaInductiveConstructor{⟩}\<%
\end{code}
%</lambdaconstapp>

%<*lambdaconstlam>
\begin{code}%
\>\AgdaFunction{ƛ} \AgdaSymbol{:} \AgdaFunction{V} \AgdaSymbol{→} \AgdaFunction{λTerm} \AgdaSymbol{→} \AgdaFunction{λTerm}\<%
\\
\>\AgdaFunction{ƛ} \AgdaBound{n} \AgdaBound{M} \AgdaSymbol{=} \AgdaInductiveConstructor{⟨} \AgdaInductiveConstructor{inj₂} \AgdaSymbol{(}\AgdaInductiveConstructor{inj₂} \AgdaSymbol{(}\AgdaBound{n} \AgdaInductiveConstructor{,} \AgdaBound{M}\AgdaSymbol{))} \AgdaInductiveConstructor{⟩}\<%
\end{code}
%</lambdaconstlam>

\begin{code}%
\>\AgdaFunction{testswap1} \AgdaSymbol{:} \AgdaFunction{swap} \AgdaFunction{SortλTermVars} \AgdaNumber{1} \AgdaNumber{2} \AgdaSymbol{(}\AgdaFunction{ƛ} \AgdaNumber{1} \AgdaSymbol{(}\AgdaFunction{v} \AgdaNumber{1} \AgdaFunction{·} \AgdaFunction{v} \AgdaNumber{2}\AgdaSymbol{))} \AgdaDatatype{≡} \AgdaSymbol{(}\AgdaFunction{ƛ} \AgdaNumber{2} \AgdaSymbol{(}\AgdaFunction{v} \AgdaNumber{2} \AgdaFunction{·} \AgdaFunction{v} \AgdaNumber{1}\AgdaSymbol{))}\<%
\\
\>\AgdaFunction{testswap1} \AgdaSymbol{=} \AgdaInductiveConstructor{refl}\<%
\end{code}

Define function by primitive recursion directly

%<*vars>
\begin{code}%
\>\AgdaFunction{vars'} \AgdaSymbol{:} \AgdaDatatype{μ} \AgdaFunction{λF} \AgdaSymbol{→} \AgdaDatatype{ℕ}\<%
\\
\>\AgdaFunction{vars'} \AgdaInductiveConstructor{⟨} \AgdaInductiveConstructor{inj₁} \AgdaSymbol{\_} \AgdaInductiveConstructor{⟩} \<[31]%
\>[31]\AgdaSymbol{=} \<[34]%
\>[34]\AgdaNumber{1}\<%
\\
\>\AgdaFunction{vars'} \AgdaInductiveConstructor{⟨} \AgdaInductiveConstructor{inj₂} \AgdaSymbol{(}\AgdaInductiveConstructor{inj₁} \AgdaSymbol{(}\AgdaBound{m} \AgdaInductiveConstructor{,} \AgdaBound{n}\AgdaSymbol{))} \AgdaInductiveConstructor{⟩} \<[31]%
\>[31]\AgdaSymbol{=} \<[34]%
\>[34]\AgdaFunction{vars'} \AgdaBound{m}\<%
\\
\>[5]\AgdaIndent{31}{}\<[31]%
\>[31]\AgdaPrimitive{+} \<[34]%
\>[34]\AgdaFunction{vars'} \AgdaBound{n}\<%
\\
\>\AgdaFunction{vars'} \AgdaInductiveConstructor{⟨} \AgdaInductiveConstructor{inj₂} \AgdaSymbol{(}\AgdaInductiveConstructor{inj₂} \AgdaSymbol{(\_} \AgdaInductiveConstructor{,} \AgdaBound{m}\AgdaSymbol{))} \AgdaInductiveConstructor{⟩} \<[31]%
\>[31]\AgdaSymbol{=} \<[34]%
\>[34]\AgdaFunction{vars'} \AgdaBound{m}\<%
\end{code}
%</vars>

Now using fold.

%<*varsfold1>
\begin{code}%
\>\AgdaFunction{varsaux} \AgdaSymbol{:} \AgdaFunction{⟦} \AgdaFunction{λF} \AgdaFunction{⟧} \AgdaDatatype{ℕ} \AgdaSymbol{→} \AgdaDatatype{ℕ}\<%
\\
\>\AgdaFunction{varsaux} \AgdaSymbol{(}\AgdaInductiveConstructor{inj₁} \AgdaSymbol{\_)} \<[31]%
\>[31]\AgdaSymbol{=} \AgdaNumber{1}\<%
\\
\>\AgdaFunction{varsaux} \AgdaSymbol{(}\AgdaInductiveConstructor{inj₂} \AgdaSymbol{(}\AgdaInductiveConstructor{inj₁} \AgdaSymbol{(}\AgdaBound{m} \AgdaInductiveConstructor{,} \AgdaBound{n}\AgdaSymbol{)))} \<[31]%
\>[31]\AgdaSymbol{=} \AgdaBound{m} \AgdaPrimitive{+} \AgdaBound{n}\<%
\\
\>\AgdaFunction{varsaux} \AgdaSymbol{(}\AgdaInductiveConstructor{inj₂} \AgdaSymbol{(}\AgdaInductiveConstructor{inj₂} \AgdaSymbol{(\_} \AgdaInductiveConstructor{,} \AgdaBound{m}\AgdaSymbol{)))} \<[31]%
\>[31]\AgdaSymbol{=} \AgdaBound{m}\<%
\end{code}
%</varsfold1>

%<*varsfold2>
\begin{code}%
\>\AgdaFunction{vars} \AgdaSymbol{:} \AgdaDatatype{μ} \AgdaFunction{λF} \AgdaSymbol{→} \AgdaDatatype{ℕ}\<%
\\
\>\AgdaFunction{vars} \AgdaSymbol{=} \AgdaFunction{fold} \AgdaFunction{λF} \AgdaFunction{varsaux}\<%
\end{code}
%</varsfold2>

Prove trivial property of vars function by primitive induction.

%<*varsproof1>
\begin{code}%
\>\AgdaFunction{PVars} \AgdaSymbol{:} \AgdaDatatype{μ} \AgdaFunction{λF} \AgdaSymbol{→} \AgdaPrimitiveType{Set}\<%
\\
\>\AgdaFunction{PVars} \AgdaBound{M} \AgdaSymbol{=} \AgdaFunction{vars} \AgdaBound{M} \AgdaFunction{>} \AgdaNumber{0}\<%
\end{code}
%</varsproof1>

%<*varsproof2>
\begin{code}%
\>\AgdaFunction{plus>0} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{m} \AgdaBound{n} \AgdaSymbol{:} \AgdaDatatype{ℕ}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaBound{m} \AgdaFunction{>} \AgdaNumber{0} \AgdaSymbol{→} \AgdaBound{n} \AgdaFunction{>} \AgdaNumber{0} \AgdaSymbol{→} \AgdaBound{m} \AgdaPrimitive{+} \AgdaBound{n} \AgdaFunction{>} \AgdaNumber{0}\<%
\\
\>\AgdaFunction{plus>0} \AgdaSymbol{\{}\AgdaBound{m}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{n}\AgdaSymbol{\}} \AgdaBound{m>0} \AgdaBound{n>0} \AgdaSymbol{=} \AgdaFunction{≤-steps} \AgdaBound{m} \AgdaBound{n>0}\<%
\end{code}
%</varsproof2>

%<*proof'>
\begin{code}%
\>\AgdaFunction{provePVars'} \AgdaSymbol{:} \AgdaSymbol{(}\AgdaBound{M} \AgdaSymbol{:} \AgdaDatatype{μ} \AgdaFunction{λF}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaFunction{PVars} \AgdaBound{M}\<%
\\
\>\AgdaFunction{provePVars'} \AgdaInductiveConstructor{⟨} \AgdaInductiveConstructor{inj₁} \AgdaBound{x} \<[37]%
\>[37]\AgdaInductiveConstructor{⟩} \<[40]%
\>[40]\AgdaSymbol{=} \AgdaInductiveConstructor{s≤s} \AgdaInductiveConstructor{z≤n}\<%
\\
\>\AgdaFunction{provePVars'} \AgdaInductiveConstructor{⟨} \AgdaInductiveConstructor{inj₂} \AgdaSymbol{(}\AgdaInductiveConstructor{inj₁} \AgdaSymbol{(} \AgdaBound{M} \<[30]%
\>[30]\AgdaInductiveConstructor{,} \AgdaBound{N} \AgdaSymbol{))} \AgdaInductiveConstructor{⟩} \<[40]%
\>[40]\AgdaSymbol{=} \AgdaFunction{plus>0} \AgdaSymbol{(}\AgdaFunction{provePVars'} \AgdaBound{M}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{provePVars'} \AgdaBound{N}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{provePVars'} \AgdaInductiveConstructor{⟨} \AgdaInductiveConstructor{inj₂} \AgdaSymbol{(}\AgdaInductiveConstructor{inj₂} \AgdaSymbol{(\_} \AgdaInductiveConstructor{,} \<[31]%
\>[31]\AgdaBound{M}\AgdaSymbol{))} \<[37]%
\>[37]\AgdaInductiveConstructor{⟩} \<[40]%
\>[40]\AgdaSymbol{=} \AgdaFunction{provePVars'} \AgdaBound{M}\<%
\end{code}
%</proof'>

%<*proof>
\begin{code}%
\>\AgdaFunction{provePVars} \AgdaSymbol{:} \AgdaSymbol{(}\AgdaBound{M} \AgdaSymbol{:} \AgdaDatatype{μ} \AgdaFunction{λF}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaFunction{PVars} \AgdaBound{M}\<%
\\
\>\AgdaFunction{provePVars} \AgdaSymbol{=} \AgdaFunction{foldInd} \AgdaFunction{λF} \AgdaFunction{PVars} \AgdaFunction{proof}\<%
\\
\>[0]\AgdaIndent{3}{}\<[3]%
\>[3]\AgdaKeyword{where}\<%
\\
\>[0]\AgdaIndent{3}{}\<[3]%
\>[3]\AgdaFunction{proof} \AgdaSymbol{:} \AgdaSymbol{(}\AgdaBound{e} \AgdaSymbol{:} \AgdaFunction{⟦} \AgdaFunction{λF} \AgdaFunction{⟧} \AgdaSymbol{(}\AgdaDatatype{μ} \AgdaFunction{λF}\AgdaSymbol{))} \AgdaSymbol{→} \AgdaFunction{fih} \AgdaFunction{λF} \AgdaFunction{PVars} \AgdaBound{e} \AgdaSymbol{→} \AgdaFunction{PVars} \AgdaInductiveConstructor{⟨} \AgdaBound{e} \AgdaInductiveConstructor{⟩}\<%
\\
\>[0]\AgdaIndent{3}{}\<[3]%
\>[3]\AgdaFunction{proof} \AgdaSymbol{(}\AgdaInductiveConstructor{inj₁} \AgdaBound{x}\AgdaSymbol{)} \<[33]%
\>[33]\AgdaBound{tt} \<[46]%
\>[46]\AgdaSymbol{=} \AgdaInductiveConstructor{s≤s} \AgdaInductiveConstructor{z≤n}\<%
\\
\>[0]\AgdaIndent{3}{}\<[3]%
\>[3]\AgdaFunction{proof} \AgdaSymbol{(}\AgdaInductiveConstructor{inj₂} \AgdaSymbol{(}\AgdaInductiveConstructor{inj₁} \AgdaSymbol{(}\AgdaBound{M} \<[25]%
\>[25]\AgdaInductiveConstructor{,} \AgdaBound{N}\AgdaSymbol{)))} \<[33]%
\>[33]\AgdaSymbol{(}\AgdaBound{ihM} \AgdaInductiveConstructor{,} \AgdaBound{ihN}\AgdaSymbol{)} \<[46]%
\>[46]\AgdaSymbol{=} \AgdaFunction{plus>0} \AgdaBound{ihM} \AgdaBound{ihN}\<%
\\
\>[0]\AgdaIndent{3}{}\<[3]%
\>[3]\AgdaFunction{proof} \AgdaSymbol{(}\AgdaInductiveConstructor{inj₂} \AgdaSymbol{(}\AgdaInductiveConstructor{inj₂} \AgdaSymbol{(\_} \<[25]%
\>[25]\AgdaInductiveConstructor{,} \AgdaBound{M}\AgdaSymbol{)))} \<[33]%
\>[33]\AgdaBound{ihM} \<[46]%
\>[46]\AgdaSymbol{=} \AgdaBound{ihM}\<%
\end{code}
%</proof>

Substitiution

\begin{code}%
\>\AgdaKeyword{infix} \AgdaNumber{20} \AgdaFunction{\_[\_≔\_]ₙ}\<%
\\
\>\AgdaKeyword{infix} \AgdaNumber{20} \AgdaFunction{\_[\_≔\_]}\<%
\end{code}


Naive substitution, assuming binders in M not equal x !

In abstraction case we do not check if x ≡ y, we cannot alse because is a iteration principle

%<*substcontext>
\begin{code}%
\>\AgdaFunction{cF} \AgdaSymbol{=} \<[6]%
\>[6]\AgdaInductiveConstructor{|v|} \AgdaFunction{SortλTermVars} \AgdaInductiveConstructor{|x|} \AgdaInductiveConstructor{|Ef|} \AgdaFunction{λF}\<%
\end{code}
%</substcontext>

%<*substaux>
\begin{code}%
\>\AgdaFunction{substaux} \AgdaSymbol{:} \AgdaDatatype{μ} \AgdaFunction{cF} \AgdaSymbol{→} \AgdaFunction{⟦} \AgdaFunction{λF} \AgdaFunction{⟧} \AgdaSymbol{(}\AgdaDatatype{μ} \AgdaFunction{λF}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaDatatype{μ} \AgdaFunction{λF}\<%
\\
\>\AgdaFunction{substaux} \AgdaSymbol{\_} \<[21]%
\>[21]\AgdaSymbol{(}\AgdaInductiveConstructor{inj₂} \AgdaSymbol{(}\AgdaInductiveConstructor{inj₁} \AgdaSymbol{(}\AgdaBound{t₁} \AgdaInductiveConstructor{,} \AgdaBound{t₂}\AgdaSymbol{)))} \<[46]%
\>[46]\AgdaSymbol{=} \AgdaBound{t₁} \AgdaFunction{·} \AgdaBound{t₂}\<%
\\
\>\AgdaFunction{substaux} \AgdaSymbol{\_} \<[21]%
\>[21]\AgdaSymbol{(}\AgdaInductiveConstructor{inj₂} \AgdaSymbol{(}\AgdaInductiveConstructor{inj₂} \AgdaSymbol{(}\AgdaBound{y} \AgdaInductiveConstructor{,} \AgdaBound{t}\AgdaSymbol{)))} \<[46]%
\>[46]\AgdaSymbol{=} \AgdaFunction{ƛ} \AgdaBound{y} \AgdaBound{t} \<[56]%
\>[56]\<%
\\
\>\AgdaFunction{substaux} \AgdaInductiveConstructor{⟨} \AgdaBound{x} \AgdaInductiveConstructor{,} \<[16]%
\>[16]\AgdaBound{N} \AgdaInductiveConstructor{⟩} \<[21]%
\>[21]\AgdaSymbol{(}\AgdaInductiveConstructor{inj₁} \AgdaBound{y}\AgdaSymbol{)} \AgdaKeyword{with} \AgdaBound{x} \AgdaFunction{≟v} \AgdaBound{y}\<%
\\
\>\AgdaSymbol{...} \AgdaSymbol{|} \AgdaInductiveConstructor{yes} \AgdaSymbol{\_} \<[46]%
\>[46]\AgdaSymbol{=} \AgdaBound{N}\<%
\\
\>\AgdaSymbol{...} \AgdaSymbol{|} \AgdaInductiveConstructor{no} \AgdaSymbol{\_} \<[46]%
\>[46]\AgdaSymbol{=} \AgdaFunction{v} \AgdaBound{y} \<%
\end{code}
%</substaux>

%<*naivesubst>
\begin{code}%
\>\AgdaFunction{\_[\_≔\_]ₙ} \AgdaSymbol{:} \AgdaFunction{λTerm} \AgdaSymbol{→} \AgdaFunction{V} \AgdaSymbol{→} \AgdaFunction{λTerm} \AgdaSymbol{→} \AgdaFunction{λTerm}\<%
\\
\>\AgdaBound{M} \AgdaFunction{[} \AgdaBound{x} \AgdaFunction{≔} \AgdaBound{N} \AgdaFunction{]ₙ} \<[14]%
\>[14]\AgdaSymbol{=} \AgdaFunction{foldCtx} \AgdaFunction{λF} \AgdaFunction{substaux} \AgdaSymbol{(}\AgdaInductiveConstructor{⟨} \AgdaBound{x} \AgdaInductiveConstructor{,} \AgdaBound{N} \AgdaInductiveConstructor{⟩}\AgdaSymbol{)} \AgdaBound{M}\<%
\end{code}
%</naivesubst>

%<*subst>
\begin{code}%
\>\AgdaFunction{\_[\_≔\_]} \AgdaSymbol{:} \AgdaFunction{λTerm} \AgdaSymbol{→} \AgdaFunction{V} \AgdaSymbol{→} \AgdaFunction{λTerm} \AgdaSymbol{→} \AgdaFunction{λTerm}\<%
\\
\>\AgdaBound{M} \AgdaFunction{[} \AgdaBound{x} \AgdaFunction{≔} \AgdaBound{N} \AgdaFunction{]} \<[14]%
\>[14]\AgdaSymbol{=} \AgdaFunction{foldCtxα} \AgdaFunction{λF} \AgdaFunction{substaux} \AgdaSymbol{(}\AgdaInductiveConstructor{⟨} \AgdaBound{x} \AgdaInductiveConstructor{,} \AgdaBound{N} \AgdaInductiveConstructor{⟩}\AgdaSymbol{)} \AgdaBound{M} \<%
\end{code}
%</subst>

Examples 

\begin{code}%
\>\AgdaFunction{exampleSubstn1} \AgdaSymbol{:} \AgdaSymbol{(}\AgdaFunction{ƛ} \AgdaNumber{1} \AgdaSymbol{(}\AgdaFunction{v} \AgdaNumber{1} \AgdaFunction{·} \AgdaFunction{v} \AgdaNumber{2}\AgdaSymbol{))} \AgdaFunction{[} \AgdaNumber{2} \AgdaFunction{≔} \AgdaFunction{v} \AgdaNumber{1} \AgdaFunction{]ₙ} \AgdaDatatype{≡} \AgdaFunction{ƛ} \AgdaNumber{1} \AgdaSymbol{(}\AgdaFunction{v} \AgdaNumber{1} \AgdaFunction{·} \AgdaFunction{v} \AgdaNumber{1}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{exampleSubstn1} \AgdaSymbol{=} \AgdaInductiveConstructor{refl}\<%
\\
%
\\
\>\AgdaFunction{exampleSubst1} \AgdaSymbol{:} \AgdaSymbol{(}\AgdaFunction{ƛ} \AgdaNumber{1} \AgdaSymbol{(}\AgdaFunction{v} \AgdaNumber{1} \AgdaFunction{·} \AgdaFunction{v} \AgdaNumber{2}\AgdaSymbol{))} \AgdaFunction{[} \AgdaNumber{2} \AgdaFunction{≔} \AgdaFunction{v} \AgdaNumber{1} \AgdaFunction{]} \AgdaDatatype{≡} \AgdaFunction{ƛ} \AgdaNumber{0} \AgdaSymbol{(}\AgdaFunction{v} \AgdaNumber{0} \AgdaFunction{·} \AgdaFunction{v} \AgdaNumber{1}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{exampleSubst1} \AgdaSymbol{=} \AgdaInductiveConstructor{refl}\<%
\\
%
\\
\>\AgdaFunction{exampleSubst2} \AgdaSymbol{:} \AgdaSymbol{(}\AgdaFunction{ƛ} \AgdaNumber{2} \AgdaSymbol{(}\AgdaFunction{v} \AgdaNumber{2} \AgdaFunction{·} \AgdaFunction{v} \AgdaNumber{3}\AgdaSymbol{))} \AgdaFunction{[} \AgdaNumber{3} \AgdaFunction{≔} \AgdaFunction{v} \AgdaNumber{1} \AgdaFunction{]} \AgdaDatatype{≡} \AgdaFunction{ƛ} \AgdaNumber{0} \AgdaSymbol{(}\AgdaFunction{v} \AgdaNumber{0} \AgdaFunction{·} \AgdaFunction{v} \AgdaNumber{1}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{exampleSubst2} \AgdaSymbol{=} \AgdaInductiveConstructor{refl}\<%
\end{code}

%<*substlemma1>
\begin{code}%
\>\AgdaFunction{lemma-substα} \<[14]%
\>[14]\AgdaSymbol{:} \<[17]%
\>[17]\AgdaSymbol{\{}\AgdaBound{M} \AgdaBound{M′} \AgdaBound{N} \AgdaSymbol{:} \AgdaFunction{λTerm}\AgdaSymbol{\}\{}\AgdaBound{x} \AgdaSymbol{:} \AgdaFunction{V}\AgdaSymbol{\}} \AgdaSymbol{→} \<[44]%
\>[44]\AgdaBound{M} \AgdaFunction{∼α} \AgdaBound{M′} \AgdaSymbol{→} \AgdaBound{M} \AgdaFunction{[} \AgdaBound{x} \AgdaFunction{≔} \AgdaBound{N} \AgdaFunction{]} \AgdaDatatype{≡} \AgdaBound{M′} \AgdaFunction{[} \AgdaBound{x} \AgdaFunction{≔} \AgdaBound{N} \AgdaFunction{]}\<%
\\
\>\AgdaFunction{lemma-substα} \AgdaSymbol{\{}\AgdaBound{M}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{M′}\AgdaSymbol{\}} \AgdaBound{M∼M′}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{=} \AgdaFunction{lemma-foldCtxα-StrongαCompatible} \AgdaSymbol{\{}\AgdaFunction{cF}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaFunction{λF}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaFunction{λF}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaFunction{substaux}\AgdaSymbol{\}} \AgdaBound{M′} \AgdaBound{M∼M′}\<%
\end{code}
%</substlemma1>

\begin{code}%
\>\AgdaKeyword{infix} \AgdaNumber{9} \AgdaFunction{（\_∙\_）\_} \<[15]%
\>[15]\<%
\\
\>\AgdaFunction{（\_∙\_）\_} \AgdaSymbol{=} \AgdaFunction{swap} \AgdaSymbol{\{}\AgdaFunction{λF}\AgdaSymbol{\}} \AgdaFunction{SortλTermVars}\<%
\end{code}

%<*substauxswap>
\begin{code}%
\>\AgdaFunction{lemma-substauxSwap} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{c} \AgdaSymbol{:} \AgdaDatatype{μ} \AgdaFunction{cF}\AgdaSymbol{\}\{}\AgdaBound{S} \AgdaSymbol{:} \AgdaFunction{Sort}\AgdaSymbol{\}\{}\AgdaBound{y} \AgdaBound{z} \AgdaSymbol{:} \AgdaFunction{V}\AgdaSymbol{\}\{}\AgdaBound{e} \AgdaSymbol{:} \AgdaFunction{⟦} \AgdaFunction{λF} \AgdaFunction{⟧} \AgdaFunction{λTerm}\AgdaSymbol{\}}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{→} \AgdaFunction{substaux} \AgdaSymbol{(}\AgdaFunction{swap} \AgdaBound{S} \AgdaBound{y} \AgdaBound{z} \AgdaBound{c}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{swapF} \AgdaFunction{λF} \AgdaBound{S} \AgdaBound{y} \AgdaBound{z} \AgdaBound{e}\AgdaSymbol{)}\<%
\\
\>[2]\AgdaIndent{5}{}\<[5]%
\>[5]\AgdaDatatype{≡}\<%
\\
\>[0]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaFunction{swap} \AgdaBound{S} \AgdaBound{y} \AgdaBound{z} \AgdaSymbol{(}\AgdaFunction{substaux} \AgdaBound{c} \AgdaBound{e}\AgdaSymbol{)}\<%
\end{code}
%</substauxswap>

\begin{code}%
\>\AgdaFunction{lemma-substauxSwap} \AgdaSymbol{\{}\AgdaInductiveConstructor{⟨} \AgdaBound{x} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{⟨} \AgdaBound{N} \AgdaInductiveConstructor{⟩} \AgdaInductiveConstructor{⟩}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{S}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{y}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{z}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaInductiveConstructor{inj₁} \AgdaBound{w}\AgdaSymbol{\}} \<[84]%
\>[84]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaKeyword{with} \AgdaFunction{SortλTermVars} \AgdaFunction{≟S} \AgdaBound{S}\<%
\\
\>\AgdaSymbol{...} \AgdaSymbol{|} \AgdaInductiveConstructor{yes} \AgdaSymbol{\_} \AgdaKeyword{with} \AgdaBound{x} \AgdaFunction{≟v} \AgdaBound{w}\<%
\\
\>\AgdaSymbol{...} \<[12]%
\>[12]\AgdaSymbol{|} \AgdaInductiveConstructor{yes} \AgdaSymbol{\_} \AgdaKeyword{with} \AgdaBound{x} \AgdaFunction{≟v} \AgdaBound{y}\<%
\\
\>\AgdaSymbol{...} \<[20]%
\>[20]\AgdaSymbol{|} \AgdaInductiveConstructor{yes} \AgdaSymbol{\_} \<[29]%
\>[29]\AgdaKeyword{with} \AgdaBound{w} \AgdaFunction{≟v} \AgdaBound{y}\<%
\\
\>\AgdaSymbol{...} \<[28]%
\>[28]\AgdaSymbol{|} \AgdaInductiveConstructor{yes} \AgdaSymbol{\_} \AgdaKeyword{with} \AgdaBound{z} \AgdaFunction{≟v} \AgdaBound{z}\<%
\\
\>\AgdaSymbol{...} \<[37]%
\>[37]\AgdaSymbol{|} \AgdaInductiveConstructor{yes} \AgdaSymbol{\_} \AgdaSymbol{=} \AgdaInductiveConstructor{refl}\<%
\\
\>\AgdaSymbol{...} \<[37]%
\>[37]\AgdaSymbol{|} \AgdaInductiveConstructor{no} \<[43]%
\>[43]\AgdaBound{z≢z} \AgdaSymbol{=} \AgdaFunction{⊥-elim} \AgdaSymbol{(}\AgdaBound{z≢z} \AgdaInductiveConstructor{refl}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{lemma-substauxSwap} \AgdaSymbol{\{}\AgdaInductiveConstructor{⟨} \AgdaBound{x} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{⟨} \AgdaBound{N} \AgdaInductiveConstructor{⟩} \AgdaInductiveConstructor{⟩}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{S}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{y}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{z}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaInductiveConstructor{inj₁} \AgdaBound{w}\AgdaSymbol{\}} \<[84]%
\>[84]\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaSymbol{|} \AgdaInductiveConstructor{yes} \AgdaSymbol{\_} \AgdaSymbol{|} \AgdaInductiveConstructor{yes} \AgdaBound{x≡w} \<[23]%
\>[23]\AgdaSymbol{|} \AgdaInductiveConstructor{yes} \AgdaBound{x≡y} \AgdaSymbol{|} \AgdaInductiveConstructor{no} \AgdaBound{w≢y} \AgdaSymbol{=} \AgdaFunction{⊥-elim} \AgdaSymbol{(}\AgdaBound{w≢y} \AgdaSymbol{(}\AgdaFunction{trans≡} \AgdaSymbol{(}\AgdaFunction{sym} \AgdaBound{x≡w}\AgdaSymbol{)} \AgdaBound{x≡y}\AgdaSymbol{))}\<%
\\
\>\AgdaFunction{lemma-substauxSwap} \AgdaSymbol{\{}\AgdaInductiveConstructor{⟨} \AgdaBound{x} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{⟨} \AgdaBound{N} \AgdaInductiveConstructor{⟩} \AgdaInductiveConstructor{⟩}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{S}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{y}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{z}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaInductiveConstructor{inj₁} \AgdaBound{w}\AgdaSymbol{\}} \<[84]%
\>[84]\<%
\\
\>[0]\AgdaIndent{3}{}\<[3]%
\>[3]\AgdaSymbol{|} \AgdaInductiveConstructor{yes} \AgdaSymbol{\_} \<[12]%
\>[12]\AgdaSymbol{|} \AgdaInductiveConstructor{yes} \AgdaBound{x≡w} \<[23]%
\>[23]\AgdaSymbol{|} \AgdaInductiveConstructor{no} \AgdaBound{x≢y} \<[33]%
\>[33]\AgdaKeyword{with} \AgdaBound{x} \AgdaFunction{≟v} \AgdaBound{z}\<%
\\
\>\AgdaSymbol{...} \<[33]%
\>[33]\AgdaSymbol{|} \AgdaInductiveConstructor{yes} \AgdaBound{x≡z} \AgdaKeyword{with} \AgdaBound{w} \AgdaFunction{≟v} \AgdaBound{y} \<[55]%
\>[55]\<%
\\
\>\AgdaSymbol{...} \<[43]%
\>[43]\AgdaSymbol{|} \AgdaInductiveConstructor{yes} \AgdaBound{w≡y} \AgdaSymbol{=} \AgdaFunction{⊥-elim} \AgdaSymbol{(}\AgdaBound{x≢y} \AgdaSymbol{(}\AgdaFunction{trans≡} \AgdaBound{x≡w} \AgdaBound{w≡y}\AgdaSymbol{))}\<%
\\
\>\AgdaFunction{lemma-substauxSwap} \AgdaSymbol{\{}\AgdaInductiveConstructor{⟨} \AgdaBound{x} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{⟨} \AgdaBound{N} \AgdaInductiveConstructor{⟩} \AgdaInductiveConstructor{⟩}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{S}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{y}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{z}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaInductiveConstructor{inj₁} \AgdaBound{w}\AgdaSymbol{\}} \<[84]%
\>[84]\<%
\\
\>[0]\AgdaIndent{3}{}\<[3]%
\>[3]\AgdaSymbol{|} \AgdaInductiveConstructor{yes} \AgdaSymbol{\_} \<[12]%
\>[12]\AgdaSymbol{|} \AgdaInductiveConstructor{yes} \AgdaBound{x≡w} \<[23]%
\>[23]\AgdaSymbol{|} \AgdaInductiveConstructor{no} \AgdaBound{x≢y} \<[33]%
\>[33]\AgdaSymbol{|} \AgdaInductiveConstructor{yes} \AgdaBound{x≡z} \AgdaSymbol{|} \AgdaInductiveConstructor{no} \AgdaBound{w≢y} \AgdaKeyword{with} \AgdaBound{w} \AgdaFunction{≟v} \AgdaBound{z}\<%
\\
\>\AgdaSymbol{...} \<[52]%
\>[52]\AgdaSymbol{|} \AgdaInductiveConstructor{yes} \AgdaBound{w≡z} \AgdaKeyword{with} \AgdaBound{y} \AgdaFunction{≟v} \AgdaBound{y} \<[74]%
\>[74]\<%
\\
\>\AgdaSymbol{...} \<[62]%
\>[62]\AgdaSymbol{|} \AgdaInductiveConstructor{yes} \AgdaSymbol{\_} \<[71]%
\>[71]\AgdaSymbol{=} \AgdaInductiveConstructor{refl}\<%
\\
\>\AgdaSymbol{...} \<[62]%
\>[62]\AgdaSymbol{|} \AgdaInductiveConstructor{no} \AgdaBound{y≢y} \AgdaSymbol{=} \AgdaFunction{⊥-elim} \AgdaSymbol{(}\AgdaBound{y≢y} \AgdaInductiveConstructor{refl}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{lemma-substauxSwap} \AgdaSymbol{\{}\AgdaInductiveConstructor{⟨} \AgdaBound{x} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{⟨} \AgdaBound{N} \AgdaInductiveConstructor{⟩} \AgdaInductiveConstructor{⟩}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{S}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{y}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{z}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaInductiveConstructor{inj₁} \AgdaBound{w}\AgdaSymbol{\}} \<[84]%
\>[84]\<%
\\
\>[0]\AgdaIndent{3}{}\<[3]%
\>[3]\AgdaSymbol{|} \AgdaInductiveConstructor{yes} \AgdaSymbol{\_} \<[12]%
\>[12]\AgdaSymbol{|} \AgdaInductiveConstructor{yes} \AgdaBound{x≡w} \<[23]%
\>[23]\AgdaSymbol{|} \AgdaInductiveConstructor{no} \AgdaBound{x≢y} \<[33]%
\>[33]\AgdaSymbol{|} \AgdaInductiveConstructor{yes} \AgdaBound{x≡z} \AgdaSymbol{|} \AgdaInductiveConstructor{no} \AgdaBound{w≢y} \AgdaSymbol{|} \AgdaInductiveConstructor{no} \<[58]%
\>[58]\AgdaBound{w≢z} \AgdaSymbol{=} \AgdaFunction{⊥-elim} \AgdaSymbol{(}\AgdaBound{w≢z} \AgdaSymbol{(}\AgdaFunction{trans≡} \AgdaSymbol{(}\AgdaFunction{sym} \AgdaBound{x≡w}\AgdaSymbol{)} \AgdaBound{x≡z}\AgdaSymbol{))}\<%
\\
\>\AgdaFunction{lemma-substauxSwap} \AgdaSymbol{\{}\AgdaInductiveConstructor{⟨} \AgdaBound{x} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{⟨} \AgdaBound{N} \AgdaInductiveConstructor{⟩} \AgdaInductiveConstructor{⟩}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{S}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{y}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{z}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaInductiveConstructor{inj₁} \AgdaBound{w}\AgdaSymbol{\}} \<[84]%
\>[84]\<%
\\
\>[0]\AgdaIndent{3}{}\<[3]%
\>[3]\AgdaSymbol{|} \AgdaInductiveConstructor{yes} \AgdaSymbol{\_} \<[12]%
\>[12]\AgdaSymbol{|} \AgdaInductiveConstructor{yes} \AgdaBound{x≡w} \<[23]%
\>[23]\AgdaSymbol{|} \AgdaInductiveConstructor{no} \AgdaBound{x≢y} \<[33]%
\>[33]\AgdaSymbol{|} \AgdaInductiveConstructor{no} \<[39]%
\>[39]\AgdaBound{x≢z} \AgdaKeyword{with} \AgdaBound{w} \AgdaFunction{≟v} \AgdaBound{y} \<[55]%
\>[55]\<%
\\
\>\AgdaSymbol{...} \<[43]%
\>[43]\AgdaSymbol{|} \AgdaInductiveConstructor{yes} \AgdaBound{w≡y} \AgdaSymbol{=} \AgdaFunction{⊥-elim} \AgdaSymbol{(}\AgdaBound{x≢y} \AgdaSymbol{(}\AgdaFunction{trans≡} \AgdaBound{x≡w} \AgdaBound{w≡y}\AgdaSymbol{))} \<[88]%
\>[88]\<%
\\
\>\AgdaSymbol{...} \<[43]%
\>[43]\AgdaSymbol{|} \AgdaInductiveConstructor{no} \<[49]%
\>[49]\AgdaBound{w≢y} \AgdaKeyword{with} \AgdaBound{w} \AgdaFunction{≟v} \AgdaBound{z}\<%
\\
\>\AgdaSymbol{...} \<[53]%
\>[53]\AgdaSymbol{|} \AgdaInductiveConstructor{yes} \AgdaBound{w≡z} \AgdaSymbol{=} \AgdaFunction{⊥-elim} \AgdaSymbol{(}\AgdaBound{x≢z} \AgdaSymbol{(}\AgdaFunction{trans≡} \AgdaBound{x≡w} \AgdaBound{w≡z}\AgdaSymbol{))} \<[98]%
\>[98]\<%
\\
\>\AgdaSymbol{...} \<[53]%
\>[53]\AgdaSymbol{|} \AgdaInductiveConstructor{no} \AgdaBound{w≢z} \AgdaKeyword{with} \AgdaBound{x} \AgdaFunction{≟v} \AgdaBound{w}\<%
\\
\>\AgdaSymbol{...} \<[62]%
\>[62]\AgdaSymbol{|} \AgdaInductiveConstructor{yes} \AgdaSymbol{\_} \AgdaSymbol{=} \AgdaInductiveConstructor{refl} \<[80]%
\>[80]\<%
\\
\>\AgdaSymbol{...} \<[62]%
\>[62]\AgdaSymbol{|} \AgdaInductiveConstructor{no} \AgdaBound{x≢w} \AgdaSymbol{=} \AgdaFunction{⊥-elim} \AgdaSymbol{(}\AgdaBound{x≢w} \AgdaBound{x≡w}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{lemma-substauxSwap} \AgdaSymbol{\{}\AgdaInductiveConstructor{⟨} \AgdaBound{x} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{⟨} \AgdaBound{N} \AgdaInductiveConstructor{⟩} \AgdaInductiveConstructor{⟩}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{S}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{y}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{z}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaInductiveConstructor{inj₁} \AgdaBound{w}\AgdaSymbol{\}} \<[84]%
\>[84]\<%
\\
\>[0]\AgdaIndent{3}{}\<[3]%
\>[3]\AgdaSymbol{|} \AgdaInductiveConstructor{yes} \AgdaBound{SortλTermVars≡S} \AgdaSymbol{|} \AgdaInductiveConstructor{no} \<[31]%
\>[31]\AgdaBound{x≢w} \AgdaKeyword{with} \AgdaFunction{SortλTermVars} \AgdaFunction{≟S} \AgdaBound{S}\<%
\\
\>\AgdaSymbol{...} \<[22]%
\>[22]\AgdaSymbol{|} \AgdaInductiveConstructor{no} \<[28]%
\>[28]\AgdaBound{SortλTermVars≢S} \AgdaSymbol{=} \AgdaFunction{⊥-elim} \AgdaSymbol{(}\AgdaBound{SortλTermVars≢S} \AgdaBound{SortλTermVars≡S}\AgdaSymbol{)}\<%
\\
\>\AgdaSymbol{...} \<[22]%
\>[22]\AgdaSymbol{|} \AgdaInductiveConstructor{yes} \AgdaSymbol{\_} \AgdaKeyword{with} \AgdaBound{x} \AgdaFunction{≟v} \AgdaBound{y}\<%
\\
\>\AgdaSymbol{...} \<[30]%
\>[30]\AgdaSymbol{|} \AgdaInductiveConstructor{yes} \AgdaBound{x≡y} \AgdaKeyword{with} \AgdaBound{w} \AgdaFunction{≟v} \AgdaBound{y}\<%
\\
\>\AgdaSymbol{...} \<[40]%
\>[40]\AgdaSymbol{|} \AgdaInductiveConstructor{yes} \AgdaBound{w≡y} \AgdaSymbol{=} \AgdaFunction{⊥-elim} \AgdaSymbol{(}\AgdaBound{x≢w} \AgdaSymbol{(}\AgdaFunction{trans≡} \AgdaBound{x≡y} \AgdaSymbol{(}\AgdaFunction{sym} \AgdaBound{w≡y}\AgdaSymbol{)))}\<%
\\
\>\AgdaSymbol{...} \<[40]%
\>[40]\AgdaSymbol{|} \AgdaInductiveConstructor{no} \<[46]%
\>[46]\AgdaBound{w≢y} \AgdaKeyword{with} \AgdaBound{w} \AgdaFunction{≟v} \AgdaBound{z}\<%
\\
\>\AgdaSymbol{...} \<[51]%
\>[51]\AgdaSymbol{|} \AgdaInductiveConstructor{yes} \AgdaBound{w≡z} \AgdaKeyword{with} \AgdaBound{z} \AgdaFunction{≟v} \AgdaBound{y} \<[73]%
\>[73]\<%
\\
\>\AgdaSymbol{...} \<[61]%
\>[61]\AgdaSymbol{|} \AgdaInductiveConstructor{yes} \AgdaBound{z≡y} \AgdaSymbol{=} \AgdaFunction{⊥-elim} \AgdaSymbol{(}\AgdaBound{x≢w} \AgdaSymbol{(}\AgdaFunction{trans≡} \AgdaBound{x≡y} \AgdaSymbol{(}\AgdaFunction{trans≡} \AgdaSymbol{(}\AgdaFunction{sym} \AgdaBound{z≡y}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{sym} \AgdaBound{w≡z}\AgdaSymbol{))))}\<%
\\
\>\AgdaSymbol{...} \<[61]%
\>[61]\AgdaSymbol{|} \AgdaInductiveConstructor{no} \AgdaBound{z≢y} \<[71]%
\>[71]\AgdaSymbol{=} \AgdaInductiveConstructor{refl}\<%
\\
\>\AgdaFunction{lemma-substauxSwap} \AgdaSymbol{\{}\AgdaInductiveConstructor{⟨} \AgdaBound{x} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{⟨} \AgdaBound{N} \AgdaInductiveConstructor{⟩} \AgdaInductiveConstructor{⟩}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{S}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{y}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{z}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaInductiveConstructor{inj₁} \AgdaBound{w}\AgdaSymbol{\}} \<[84]%
\>[84]\<%
\\
\>[0]\AgdaIndent{3}{}\<[3]%
\>[3]\AgdaSymbol{|} \AgdaInductiveConstructor{yes} \AgdaBound{SortλTermVars≡S} \AgdaSymbol{|} \AgdaInductiveConstructor{no} \<[31]%
\>[31]\AgdaBound{x≢w} \<[35]%
\>[35]\<%
\\
\>[3]\AgdaIndent{22}{}\<[22]%
\>[22]\AgdaSymbol{|} \AgdaInductiveConstructor{yes} \AgdaSymbol{\_} \AgdaSymbol{|} \AgdaInductiveConstructor{yes} \AgdaBound{x≡y} \AgdaSymbol{|} \AgdaInductiveConstructor{no} \AgdaBound{w≢y} \<[51]%
\>[51]\AgdaSymbol{|} \AgdaInductiveConstructor{no} \AgdaBound{w≢z} \<[61]%
\>[61]\AgdaKeyword{with} \AgdaBound{z} \AgdaFunction{≟v} \AgdaBound{w}\<%
\\
\>\AgdaSymbol{...} \<[62]%
\>[62]\AgdaSymbol{|} \AgdaInductiveConstructor{yes} \AgdaBound{z≡w} \AgdaSymbol{=} \<[75]%
\>[75]\AgdaFunction{⊥-elim} \AgdaSymbol{(}\AgdaBound{w≢z} \AgdaSymbol{(}\AgdaFunction{sym} \AgdaBound{z≡w}\AgdaSymbol{))}\<%
\\
\>\AgdaSymbol{...} \<[62]%
\>[62]\AgdaSymbol{|} \AgdaInductiveConstructor{no} \AgdaSymbol{\_} \AgdaSymbol{=} \<[72]%
\>[72]\AgdaInductiveConstructor{refl}\<%
\\
\>\AgdaFunction{lemma-substauxSwap} \AgdaSymbol{\{}\AgdaInductiveConstructor{⟨} \AgdaBound{x} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{⟨} \AgdaBound{N} \AgdaInductiveConstructor{⟩} \AgdaInductiveConstructor{⟩}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{S}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{y}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{z}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaInductiveConstructor{inj₁} \AgdaBound{w}\AgdaSymbol{\}} \<[84]%
\>[84]\<%
\\
\>[0]\AgdaIndent{3}{}\<[3]%
\>[3]\AgdaSymbol{|} \AgdaInductiveConstructor{yes} \AgdaBound{SortλTermVars≡S} \AgdaSymbol{|} \AgdaInductiveConstructor{no} \<[31]%
\>[31]\AgdaBound{x≢w} \AgdaSymbol{|} \AgdaInductiveConstructor{yes} \AgdaSymbol{\_} \AgdaSymbol{|} \AgdaInductiveConstructor{no} \AgdaBound{x≢y} \AgdaKeyword{with} \AgdaBound{x} \AgdaFunction{≟v} \AgdaBound{z}\<%
\\
\>\AgdaSymbol{...} \<[51]%
\>[51]\AgdaSymbol{|} \AgdaInductiveConstructor{yes} \AgdaBound{x≡z} \AgdaKeyword{with} \AgdaBound{w} \AgdaFunction{≟v} \AgdaBound{y}\<%
\\
\>\AgdaSymbol{...} \<[61]%
\>[61]\AgdaSymbol{|} \AgdaInductiveConstructor{yes} \AgdaBound{w≡y} \AgdaKeyword{with} \AgdaBound{y} \AgdaFunction{≟v} \AgdaBound{z}\<%
\\
\>\AgdaSymbol{...} \<[71]%
\>[71]\AgdaSymbol{|} \AgdaInductiveConstructor{yes} \AgdaBound{y≡z} \AgdaSymbol{=} \AgdaFunction{⊥-elim} \AgdaSymbol{(}\AgdaBound{x≢w} \AgdaSymbol{(}\AgdaFunction{trans≡} \AgdaBound{x≡z} \AgdaSymbol{(}\AgdaFunction{trans≡} \AgdaSymbol{(}\AgdaFunction{sym} \AgdaBound{y≡z}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{sym} \AgdaBound{w≡y}\AgdaSymbol{))))}\<%
\\
\>\AgdaSymbol{...} \<[71]%
\>[71]\AgdaSymbol{|} \AgdaInductiveConstructor{no} \AgdaBound{y≢z} \AgdaSymbol{=} \AgdaInductiveConstructor{refl}\<%
\\
\>\AgdaFunction{lemma-substauxSwap} \AgdaSymbol{\{}\AgdaInductiveConstructor{⟨} \AgdaBound{x} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{⟨} \AgdaBound{N} \AgdaInductiveConstructor{⟩} \AgdaInductiveConstructor{⟩}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{S}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{y}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{z}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaInductiveConstructor{inj₁} \AgdaBound{w}\AgdaSymbol{\}} \<[84]%
\>[84]\<%
\\
\>[0]\AgdaIndent{3}{}\<[3]%
\>[3]\AgdaSymbol{|} \AgdaInductiveConstructor{yes} \AgdaBound{SortλTermVars≡S} \AgdaSymbol{|} \AgdaInductiveConstructor{no} \<[31]%
\>[31]\AgdaBound{x≢w} \AgdaSymbol{|} \AgdaInductiveConstructor{yes} \AgdaSymbol{\_} \AgdaSymbol{|} \AgdaInductiveConstructor{no} \AgdaBound{x≢y} \AgdaSymbol{|} \AgdaInductiveConstructor{yes} \AgdaBound{x≡z} \AgdaSymbol{|} \AgdaInductiveConstructor{no} \AgdaBound{w≢y} \AgdaKeyword{with} \AgdaBound{w} \AgdaFunction{≟v} \AgdaBound{z}\<%
\\
\>\AgdaSymbol{...} \<[71]%
\>[71]\AgdaSymbol{|} \AgdaInductiveConstructor{yes} \AgdaBound{w≡z} \AgdaSymbol{=} \AgdaFunction{⊥-elim} \AgdaSymbol{(}\AgdaBound{x≢w} \AgdaSymbol{(}\AgdaFunction{trans≡} \AgdaBound{x≡z} \AgdaSymbol{(}\AgdaFunction{sym} \AgdaBound{w≡z}\AgdaSymbol{)))}\<%
\\
\>\AgdaSymbol{...} \<[71]%
\>[71]\AgdaSymbol{|} \AgdaInductiveConstructor{no} \AgdaBound{w≢z} \AgdaKeyword{with} \AgdaBound{y} \AgdaFunction{≟v} \AgdaBound{w}\<%
\\
\>\AgdaSymbol{...} \<[80]%
\>[80]\AgdaSymbol{|} \AgdaInductiveConstructor{yes} \AgdaBound{y≡w} \AgdaSymbol{=} \<[93]%
\>[93]\AgdaFunction{⊥-elim} \AgdaSymbol{(}\AgdaBound{w≢y} \AgdaSymbol{(}\AgdaFunction{sym} \AgdaBound{y≡w}\AgdaSymbol{))}\<%
\\
\>\AgdaSymbol{...} \<[80]%
\>[80]\AgdaSymbol{|} \AgdaInductiveConstructor{no} \AgdaBound{y≢w} \AgdaSymbol{=} \<[92]%
\>[92]\AgdaInductiveConstructor{refl}\<%
\\
\>\AgdaFunction{lemma-substauxSwap} \AgdaSymbol{\{}\AgdaInductiveConstructor{⟨} \AgdaBound{x} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{⟨} \AgdaBound{N} \AgdaInductiveConstructor{⟩} \AgdaInductiveConstructor{⟩}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{S}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{y}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{z}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaInductiveConstructor{inj₁} \AgdaBound{w}\AgdaSymbol{\}} \<[84]%
\>[84]\<%
\\
\>[0]\AgdaIndent{3}{}\<[3]%
\>[3]\AgdaSymbol{|} \AgdaInductiveConstructor{yes} \AgdaBound{SortλTermVars≡S} \AgdaSymbol{|} \AgdaInductiveConstructor{no} \<[31]%
\>[31]\AgdaBound{x≢w} \AgdaSymbol{|} \AgdaInductiveConstructor{yes} \AgdaSymbol{\_} \AgdaSymbol{|} \AgdaInductiveConstructor{no} \AgdaBound{x≢y} \AgdaSymbol{|} \AgdaInductiveConstructor{no} \<[58]%
\>[58]\AgdaBound{x≢z} \AgdaKeyword{with} \AgdaBound{w} \AgdaFunction{≟v} \AgdaBound{y} \<[74]%
\>[74]\<%
\\
\>\AgdaSymbol{...} \<[61]%
\>[61]\AgdaSymbol{|} \AgdaInductiveConstructor{yes} \AgdaBound{w≡y} \AgdaKeyword{with} \AgdaBound{x} \AgdaFunction{≟v} \AgdaBound{z}\<%
\\
\>\AgdaSymbol{...} \<[71]%
\>[71]\AgdaSymbol{|} \AgdaInductiveConstructor{yes} \AgdaBound{x≡z} \AgdaSymbol{=} \<[84]%
\>[84]\AgdaFunction{⊥-elim} \AgdaSymbol{(}\AgdaBound{x≢z} \AgdaBound{x≡z}\AgdaSymbol{)}\<%
\\
\>\AgdaSymbol{...} \<[71]%
\>[71]\AgdaSymbol{|} \AgdaInductiveConstructor{no} \AgdaSymbol{\_} \AgdaSymbol{=} \AgdaInductiveConstructor{refl}\<%
\\
\>\AgdaFunction{lemma-substauxSwap} \AgdaSymbol{\{}\AgdaInductiveConstructor{⟨} \AgdaBound{x} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{⟨} \AgdaBound{N} \AgdaInductiveConstructor{⟩} \AgdaInductiveConstructor{⟩}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{S}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{y}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{z}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaInductiveConstructor{inj₁} \AgdaBound{w}\AgdaSymbol{\}} \<[84]%
\>[84]\<%
\\
\>[0]\AgdaIndent{3}{}\<[3]%
\>[3]\AgdaSymbol{|} \AgdaInductiveConstructor{yes} \AgdaBound{SortλTermVars≡S} \AgdaSymbol{|} \AgdaInductiveConstructor{no} \<[31]%
\>[31]\AgdaBound{x≢w} \AgdaSymbol{|} \AgdaInductiveConstructor{yes} \AgdaSymbol{\_} \AgdaSymbol{|} \AgdaInductiveConstructor{no} \AgdaBound{x≢y} \AgdaSymbol{|} \AgdaInductiveConstructor{no} \<[58]%
\>[58]\AgdaBound{x≢z} \AgdaSymbol{|} \AgdaInductiveConstructor{no} \AgdaBound{w≢y} \AgdaKeyword{with} \AgdaBound{w} \AgdaFunction{≟v} \AgdaBound{z} \<[83]%
\>[83]\<%
\\
\>\AgdaSymbol{...} \<[71]%
\>[71]\AgdaSymbol{|} \AgdaInductiveConstructor{yes} \AgdaBound{w≡z} \AgdaKeyword{with} \AgdaBound{x} \AgdaFunction{≟v} \AgdaBound{y}\<%
\\
\>\AgdaSymbol{...} \<[81]%
\>[81]\AgdaSymbol{|} \AgdaInductiveConstructor{yes} \AgdaBound{x≡y} \AgdaSymbol{=} \<[94]%
\>[94]\AgdaFunction{⊥-elim} \AgdaSymbol{(}\AgdaBound{x≢y} \AgdaBound{x≡y}\AgdaSymbol{)}\<%
\\
\>\AgdaSymbol{...} \<[81]%
\>[81]\AgdaSymbol{|} \AgdaInductiveConstructor{no} \AgdaSymbol{\_} \AgdaSymbol{=} \AgdaInductiveConstructor{refl}\<%
\\
\>\AgdaFunction{lemma-substauxSwap} \AgdaSymbol{\{}\AgdaInductiveConstructor{⟨} \AgdaBound{x} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{⟨} \AgdaBound{N} \AgdaInductiveConstructor{⟩} \AgdaInductiveConstructor{⟩}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{S}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{y}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{z}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaInductiveConstructor{inj₁} \AgdaBound{w}\AgdaSymbol{\}} \<[84]%
\>[84]\<%
\\
\>[0]\AgdaIndent{3}{}\<[3]%
\>[3]\AgdaSymbol{|} \AgdaInductiveConstructor{yes} \AgdaBound{SortλTermVars≡S} \AgdaSymbol{|} \AgdaInductiveConstructor{no} \<[31]%
\>[31]\AgdaBound{x≢w} \AgdaSymbol{|} \AgdaInductiveConstructor{yes} \AgdaSymbol{\_} \AgdaSymbol{|} \AgdaInductiveConstructor{no} \AgdaBound{x≢y} \AgdaSymbol{|} \AgdaInductiveConstructor{no} \<[58]%
\>[58]\AgdaBound{x≢z} \AgdaSymbol{|} \AgdaInductiveConstructor{no} \AgdaBound{w≢y} \<[72]%
\>[72]\AgdaSymbol{|} \AgdaInductiveConstructor{no} \AgdaBound{w≢z} \AgdaKeyword{with} \AgdaBound{x} \AgdaFunction{≟v} \AgdaBound{w}\<%
\\
\>\AgdaSymbol{...} \<[81]%
\>[81]\AgdaSymbol{|} \AgdaInductiveConstructor{yes} \AgdaBound{x≡w} \AgdaSymbol{=} \<[94]%
\>[94]\AgdaFunction{⊥-elim} \AgdaSymbol{(}\AgdaBound{x≢w} \AgdaBound{x≡w}\AgdaSymbol{)}\<%
\\
\>\AgdaSymbol{...} \<[81]%
\>[81]\AgdaSymbol{|} \AgdaInductiveConstructor{no} \AgdaSymbol{\_} \AgdaSymbol{=} \AgdaInductiveConstructor{refl}\<%
\\
\>\AgdaFunction{lemma-substauxSwap} \AgdaSymbol{\{}\AgdaInductiveConstructor{⟨} \AgdaBound{x} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{⟨} \AgdaBound{N} \AgdaInductiveConstructor{⟩} \AgdaInductiveConstructor{⟩}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{S}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{y}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{z}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaInductiveConstructor{inj₁} \AgdaBound{w}\AgdaSymbol{\}} \<[84]%
\>[84]\<%
\\
\>[3]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaSymbol{|} \AgdaInductiveConstructor{no} \<[10]%
\>[10]\AgdaBound{SortλTermVars≢S} \AgdaKeyword{with} \AgdaBound{x} \AgdaFunction{≟v} \AgdaBound{w}\<%
\\
\>\AgdaSymbol{...} \<[14]%
\>[14]\AgdaSymbol{|} \AgdaInductiveConstructor{yes} \AgdaBound{x≡w} \<[25]%
\>[25]\AgdaSymbol{=} \AgdaInductiveConstructor{refl}\<%
\\
\>\AgdaSymbol{...} \<[14]%
\>[14]\AgdaSymbol{|} \AgdaInductiveConstructor{no} \<[20]%
\>[20]\AgdaSymbol{\_} \<[25]%
\>[25]\AgdaKeyword{with} \AgdaFunction{SortλTermVars} \AgdaFunction{≟S} \AgdaBound{S}\<%
\\
\>\AgdaSymbol{...} \<[26]%
\>[26]\AgdaSymbol{|} \AgdaInductiveConstructor{yes} \AgdaBound{SortλTermVars≡S} \AgdaSymbol{=} \AgdaFunction{⊥-elim} \AgdaSymbol{(}\AgdaBound{SortλTermVars≢S} \AgdaBound{SortλTermVars≡S}\AgdaSymbol{)}\<%
\\
\>\AgdaSymbol{...} \<[26]%
\>[26]\AgdaSymbol{|} \AgdaInductiveConstructor{no} \AgdaSymbol{\_} \<[34]%
\>[34]\AgdaSymbol{=} \AgdaInductiveConstructor{refl}\<%
\\
\>\AgdaFunction{lemma-substauxSwap} \AgdaSymbol{\{}\AgdaInductiveConstructor{⟨} \AgdaBound{x} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{⟨} \AgdaBound{N} \AgdaInductiveConstructor{⟩} \AgdaInductiveConstructor{⟩}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{S}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaArgument{e} \AgdaSymbol{=} \AgdaInductiveConstructor{inj₂} \AgdaSymbol{(}\AgdaInductiveConstructor{inj₁} \AgdaSymbol{(}\AgdaBound{M} \AgdaInductiveConstructor{,} \AgdaBound{M'}\AgdaSymbol{))\}} \<[80]%
\>[80]\AgdaSymbol{=} \AgdaInductiveConstructor{refl}\<%
\\
\>\AgdaFunction{lemma-substauxSwap} \AgdaSymbol{\{}\AgdaInductiveConstructor{⟨} \AgdaBound{x} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{⟨} \AgdaBound{N} \AgdaInductiveConstructor{⟩} \AgdaInductiveConstructor{⟩}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{S}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaArgument{e} \AgdaSymbol{=} \AgdaInductiveConstructor{inj₂} \AgdaSymbol{(}\AgdaInductiveConstructor{inj₂} \AgdaSymbol{(}\AgdaBound{y} \AgdaInductiveConstructor{,} \AgdaBound{M}\AgdaSymbol{))\}} \<[80]%
\>[80]\AgdaSymbol{=} \AgdaInductiveConstructor{refl}\<%
\end{code}

%<*swapsubst>
\begin{code}%
\>\AgdaFunction{lemma-[]Swap} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{x} \AgdaBound{y} \AgdaBound{z} \AgdaSymbol{:} \AgdaFunction{V}\AgdaSymbol{\}\{}\AgdaBound{M} \AgdaBound{N} \AgdaSymbol{:} \AgdaFunction{λTerm}\AgdaSymbol{\}}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{→} \<[5]%
\>[5]\AgdaSymbol{(}\AgdaFunction{（} \AgdaBound{y} \AgdaFunction{∙} \AgdaBound{z} \AgdaFunction{）} \AgdaBound{M}\AgdaSymbol{)} \AgdaFunction{[} \AgdaFunction{（} \AgdaBound{y} \AgdaFunction{∙} \AgdaBound{z} \AgdaFunction{）ₐ} \AgdaBound{x} \AgdaFunction{≔} \AgdaFunction{（} \AgdaBound{y} \AgdaFunction{∙} \AgdaBound{z} \AgdaFunction{）} \AgdaBound{N} \AgdaFunction{]ₙ} \AgdaDatatype{≡} \AgdaFunction{（} \AgdaBound{y} \AgdaFunction{∙} \AgdaBound{z} \AgdaFunction{）} \AgdaSymbol{(}\AgdaBound{M} \AgdaFunction{[} \AgdaBound{x} \AgdaFunction{≔} \AgdaBound{N} \AgdaFunction{]ₙ}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{lemma-[]Swap} \AgdaSymbol{\{}\AgdaBound{x}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{y}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{z}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{M}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaInductiveConstructor{⟨} \AgdaBound{N} \AgdaInductiveConstructor{⟩}\AgdaSymbol{\}}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{=} \AgdaFunction{lemmaSwapFoldCtxEquiv} \<[27]%
\>[27]\AgdaSymbol{\{}\AgdaFunction{cF}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaFunction{λF}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaFunction{λF}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaFunction{SortλTermVars}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{y}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{z}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{M}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaFunction{substaux}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaInductiveConstructor{⟨} \AgdaBound{x} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{⟨} \AgdaBound{N} \AgdaInductiveConstructor{⟩} \AgdaInductiveConstructor{⟩}\AgdaSymbol{\}} \<[97]%
\>[97]\<%
\\
\>[2]\AgdaIndent{7}{}\<[7]%
\>[7]\AgdaSymbol{(λ} \AgdaSymbol{\{}\AgdaBound{c}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{S}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{x}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{y}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{e}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaFunction{lemma-substauxSwap} \AgdaSymbol{\{}\AgdaBound{c}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{S}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{x}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{y}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{e}\AgdaSymbol{\})}\<%
\end{code}
%</swapsubst>

\begin{code}%
\>\AgdaFunction{lemma-substaux} \<[16]%
\>[16]\AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{e} \AgdaBound{e′} \AgdaSymbol{:} \AgdaFunction{⟦} \AgdaFunction{λF} \AgdaFunction{⟧} \AgdaSymbol{(}\AgdaDatatype{μ} \AgdaFunction{λF}\AgdaSymbol{)\}\{}\AgdaBound{c} \AgdaBound{c′} \AgdaSymbol{:} \<[49]%
\>[49]\AgdaDatatype{μ} \AgdaFunction{cF}\AgdaSymbol{\}}\<%
\\
\>[7]\AgdaIndent{16}{}\<[16]%
\>[16]\AgdaSymbol{→} \AgdaBound{c} \AgdaFunction{∼α} \AgdaBound{c′}\<%
\\
\>[7]\AgdaIndent{16}{}\<[16]%
\>[16]\AgdaSymbol{→} \AgdaDatatype{∼αF} \AgdaFunction{λF} \AgdaBound{e} \AgdaBound{e′}\<%
\\
\>[7]\AgdaIndent{16}{}\<[16]%
\>[16]\AgdaSymbol{→} \AgdaFunction{substaux} \AgdaBound{c} \AgdaBound{e} \AgdaFunction{∼α} \AgdaFunction{substaux} \AgdaBound{c′} \AgdaBound{e′}\<%
\\
\>\AgdaFunction{lemma-substaux} \AgdaSymbol{\{}\AgdaInductiveConstructor{inj₁} \AgdaBound{y}\AgdaSymbol{\}} \AgdaSymbol{(}\AgdaInductiveConstructor{∼αR} \AgdaSymbol{\{}\AgdaBound{x} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{⟨} \AgdaBound{N} \AgdaInductiveConstructor{⟩}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaSymbol{.}\AgdaBound{x} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{⟨} \AgdaBound{N′} \AgdaInductiveConstructor{⟩}\AgdaSymbol{\}} \AgdaSymbol{(}\AgdaInductiveConstructor{∼αx} \AgdaInductiveConstructor{∼αV} \AgdaSymbol{(}\AgdaInductiveConstructor{∼αEf} \AgdaBound{N∼N′}\AgdaSymbol{)))} \AgdaSymbol{(}\AgdaInductiveConstructor{∼α+₁} \AgdaInductiveConstructor{∼αV}\AgdaSymbol{)} \<[89]%
\>[89]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaKeyword{with} \AgdaBound{x} \AgdaFunction{≟v} \AgdaBound{y} \<[14]%
\>[14]\<%
\\
\>\AgdaSymbol{...} \AgdaSymbol{|} \AgdaInductiveConstructor{yes} \AgdaSymbol{\_} \<[52]%
\>[52]\AgdaSymbol{=} \<[55]%
\>[55]\AgdaInductiveConstructor{∼αR} \AgdaBound{N∼N′}\<%
\\
\>\AgdaSymbol{...} \AgdaSymbol{|} \AgdaInductiveConstructor{no} \AgdaSymbol{\_} \<[52]%
\>[52]\AgdaSymbol{=} \<[55]%
\>[55]\AgdaInductiveConstructor{∼αR} \AgdaSymbol{(}\AgdaInductiveConstructor{∼α+₁} \AgdaInductiveConstructor{∼αV}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{lemma-substaux} \AgdaSymbol{\_} \AgdaSymbol{(}\AgdaInductiveConstructor{∼α+₂} \AgdaSymbol{(}\AgdaInductiveConstructor{∼α+₁} \<[30]%
\>[30]\AgdaSymbol{(}\AgdaInductiveConstructor{∼αx} \AgdaBound{e∼e′} \AgdaBound{e∼e′₁}\AgdaSymbol{)))} \<[52]%
\>[52]\AgdaSymbol{=} \<[55]%
\>[55]\AgdaInductiveConstructor{∼αR} \AgdaSymbol{(}\AgdaInductiveConstructor{∼α+₂} \AgdaSymbol{(}\AgdaInductiveConstructor{∼α+₁}\AgdaSymbol{(}\AgdaInductiveConstructor{∼αx} \AgdaBound{e∼e′} \AgdaBound{e∼e′₁}\AgdaSymbol{)))}\<%
\\
\>\AgdaFunction{lemma-substaux} \AgdaSymbol{\_} \AgdaSymbol{(}\AgdaInductiveConstructor{∼α+₂} \AgdaSymbol{(}\AgdaInductiveConstructor{∼α+₂} \<[30]%
\>[30]\AgdaSymbol{(}\AgdaInductiveConstructor{∼αB} \AgdaBound{xs} \AgdaBound{e}\AgdaSymbol{)))} \<[52]%
\>[52]\AgdaSymbol{=} \<[55]%
\>[55]\AgdaInductiveConstructor{∼αR} \AgdaSymbol{(}\AgdaInductiveConstructor{∼α+₂} \AgdaSymbol{(}\AgdaInductiveConstructor{∼α+₂} \AgdaSymbol{(}\AgdaInductiveConstructor{∼αB} \AgdaBound{xs} \AgdaBound{e}\AgdaSymbol{)))}\<%
\\
%
\\
%
\\
\>\AgdaFunction{lemma-substnα′} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{x} \AgdaSymbol{:} \AgdaFunction{V}\AgdaSymbol{\}\{}\AgdaBound{M} \AgdaBound{N} \AgdaBound{N′} \AgdaSymbol{:} \AgdaFunction{λTerm}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaBound{N} \AgdaFunction{∼α} \AgdaBound{N′} \AgdaSymbol{→} \AgdaBound{M} \AgdaFunction{[} \AgdaBound{x} \AgdaFunction{≔} \AgdaBound{N} \AgdaFunction{]ₙ} \AgdaFunction{∼α} \AgdaBound{M} \AgdaFunction{[} \AgdaBound{x} \AgdaFunction{≔} \AgdaBound{N′} \AgdaFunction{]ₙ}\<%
\\
\>\AgdaFunction{lemma-substnα′} \AgdaSymbol{\{}\AgdaBound{x}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{M}\AgdaSymbol{\}} \AgdaSymbol{(}\AgdaInductiveConstructor{∼αR} \AgdaBound{N∼N′}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaFunction{lemma-foldCtxαCtx} \AgdaFunction{lemma-substaux} \AgdaSymbol{(}\AgdaInductiveConstructor{∼αR} \AgdaSymbol{(}\AgdaInductiveConstructor{∼αx} \AgdaInductiveConstructor{∼αV} \AgdaSymbol{(}\AgdaInductiveConstructor{∼αEf} \AgdaBound{N∼N′}\AgdaSymbol{)))} \AgdaBound{M}\<%
\end{code}

%<*substlemma2>
\begin{code}%
\>\AgdaFunction{lemma-substα′} \<[15]%
\>[15]\AgdaSymbol{:} \<[18]%
\>[18]\AgdaSymbol{\{}\AgdaBound{x} \AgdaSymbol{:} \AgdaFunction{V}\AgdaSymbol{\}\{}\AgdaBound{M} \AgdaBound{N} \AgdaBound{N′} \AgdaSymbol{:} \AgdaFunction{λTerm}\AgdaSymbol{\}} \AgdaSymbol{→} \<[45]%
\>[45]\AgdaBound{N} \AgdaFunction{∼α} \AgdaBound{N′} \AgdaSymbol{→} \AgdaBound{M} \AgdaFunction{[} \AgdaBound{x} \AgdaFunction{≔} \AgdaBound{N} \AgdaFunction{]} \AgdaFunction{∼α} \AgdaBound{M} \AgdaFunction{[} \AgdaBound{x} \AgdaFunction{≔} \AgdaBound{N′} \AgdaFunction{]}\<%
\\
\>\AgdaFunction{lemma-substα′} \AgdaSymbol{\{}\AgdaBound{x}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{M}\AgdaSymbol{\}} \AgdaSymbol{(}\AgdaInductiveConstructor{∼αR} \AgdaBound{N∼N′}\AgdaSymbol{)} \<[33]%
\>[33]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{=} \AgdaFunction{lemma-foldCtxα-cxtα} \AgdaFunction{lemma-substaux} \AgdaSymbol{(}\AgdaInductiveConstructor{∼αR} \AgdaSymbol{(}\AgdaInductiveConstructor{∼αx} \AgdaInductiveConstructor{∼αV} \AgdaSymbol{(}\AgdaInductiveConstructor{∼αEf} \AgdaBound{N∼N′}\AgdaSymbol{)))} \AgdaBound{M}\<%
\end{code}
%</substlemma2>

\begin{code}%
\>\AgdaFunction{fv2ctx} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{x} \AgdaSymbol{:} \AgdaFunction{V}\AgdaSymbol{\}\{}\AgdaBound{M} \AgdaBound{N} \AgdaSymbol{:} \AgdaFunction{λTerm}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaFunction{ListNotOccurBind} \AgdaSymbol{(}\AgdaBound{x} \AgdaInductiveConstructor{∷} \AgdaFunction{fv} \AgdaBound{N}\AgdaSymbol{)} \AgdaBound{M} \<[63]%
\>[63]\AgdaSymbol{→} \AgdaFunction{ListNotOccurBind} \AgdaSymbol{(}\AgdaFunction{fv} \AgdaSymbol{\{}\AgdaFunction{cF}\AgdaSymbol{\}} \AgdaInductiveConstructor{⟨} \AgdaBound{x} \AgdaInductiveConstructor{,} \AgdaBound{N} \AgdaInductiveConstructor{⟩}\AgdaSymbol{)} \AgdaBound{M}\<%
\\
\>\AgdaFunction{fv2ctx} \AgdaSymbol{\{}\AgdaBound{x}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{M}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaInductiveConstructor{⟨} \AgdaBound{N} \AgdaInductiveConstructor{⟩}\AgdaSymbol{\}} \AgdaBound{nb} \AgdaSymbol{=} \AgdaBound{nb}\<%
\end{code}

%<*lemmanaivesubst>
\begin{code}%
\>\AgdaFunction{lemmaSubsts} \AgdaSymbol{:} \<[15]%
\>[15]\AgdaSymbol{\{}\AgdaBound{z} \AgdaSymbol{:} \AgdaFunction{V}\AgdaSymbol{\}\{}\AgdaBound{M} \AgdaBound{N} \AgdaSymbol{:} \AgdaFunction{λTerm}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaFunction{ListNotOccurBind} \AgdaSymbol{(}\AgdaBound{z} \AgdaInductiveConstructor{∷} \AgdaFunction{fv} \AgdaBound{N}\AgdaSymbol{)} \AgdaBound{M} \AgdaSymbol{→} \AgdaBound{M} \AgdaFunction{[} \AgdaBound{z} \AgdaFunction{≔} \AgdaBound{N} \AgdaFunction{]} \AgdaFunction{∼α} \AgdaBound{M} \AgdaFunction{[} \AgdaBound{z} \AgdaFunction{≔} \AgdaBound{N} \AgdaFunction{]ₙ}\<%
\\
\>\AgdaFunction{lemmaSubsts} \AgdaSymbol{\{}\AgdaBound{z}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{M}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{N}\AgdaSymbol{\}} \AgdaBound{nb}\<%
\\
\> \AgdaSymbol{=} \AgdaFunction{lemma-foldCtxα-foldCtx} \AgdaSymbol{\{}\AgdaFunction{cF}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaFunction{λF}\AgdaSymbol{\}} \AgdaFunction{λF} \AgdaSymbol{\{}\AgdaFunction{substaux}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaInductiveConstructor{⟨} \AgdaBound{z} \AgdaInductiveConstructor{,} \AgdaBound{N} \AgdaInductiveConstructor{⟩}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{M}\AgdaSymbol{\}}\<%
\\
\>[2]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaFunction{lemma-substaux}\<%
\\
\>[2]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaSymbol{(λ} \AgdaSymbol{\{}\AgdaBound{c}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{S}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{x}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{y}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{e}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaFunction{lemma-substauxSwap} \AgdaSymbol{\{}\AgdaBound{c}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{S}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{x}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{y}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{e}\AgdaSymbol{\})}\<%
\\
\>[2]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaSymbol{(}\AgdaFunction{fv2ctx} \AgdaSymbol{\{}\AgdaBound{z}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{M}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{N}\AgdaSymbol{\}} \AgdaBound{nb}\AgdaSymbol{)}\<%
\end{code}
%</lemmanaivesubst>

Naive Substitution Composition

\begin{code}%
\>\AgdaFunction{lemma-substnfv} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{M} \AgdaBound{N} \AgdaSymbol{:} \AgdaFunction{λTerm}\AgdaSymbol{\}\{}\AgdaBound{x} \AgdaSymbol{:} \AgdaFunction{V}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaBound{x} \AgdaFunction{∉} \AgdaFunction{fvS} \AgdaFunction{SortλTermVars} \AgdaBound{M} \AgdaSymbol{→} \AgdaBound{x} \AgdaFunction{notOccurBind} \AgdaBound{M} \AgdaSymbol{→} \AgdaBound{M} \AgdaDatatype{≡} \AgdaBound{M} \AgdaFunction{[} \AgdaBound{x} \AgdaFunction{≔} \AgdaBound{N} \AgdaFunction{]ₙ}\<%
\\
\>\AgdaFunction{lemma-substnfv} \AgdaSymbol{\{}\AgdaInductiveConstructor{⟨} \AgdaInductiveConstructor{inj₁} \AgdaBound{y} \AgdaInductiveConstructor{⟩}\AgdaSymbol{\}} \<[54]%
\>[54]\AgdaSymbol{\{}\AgdaBound{N}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{x}\AgdaSymbol{\}} \AgdaBound{x∉fvy} \AgdaSymbol{\_} \<[70]%
\>[70]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaKeyword{with} \AgdaBound{x} \AgdaFunction{≟v} \AgdaBound{y}\<%
\\
\>\AgdaSymbol{...} \AgdaSymbol{|} \AgdaInductiveConstructor{yes} \AgdaBound{x≡y} \AgdaSymbol{=} \AgdaFunction{⊥-elim} \AgdaSymbol{((}\AgdaFunction{b∉a∷xs→b≢a} \AgdaBound{x∉fvy}\AgdaSymbol{)} \AgdaBound{x≡y}\AgdaSymbol{)}\<%
\\
\>\AgdaSymbol{...} \AgdaSymbol{|} \AgdaInductiveConstructor{no} \<[10]%
\>[10]\AgdaBound{x≢y} \AgdaSymbol{=} \AgdaInductiveConstructor{refl}\<%
\\
\>\AgdaFunction{lemma-substnfv} \<[16]%
\>[16]\AgdaSymbol{\{}\AgdaInductiveConstructor{⟨} \AgdaInductiveConstructor{inj₂} \AgdaSymbol{(}\AgdaInductiveConstructor{inj₁} \AgdaSymbol{(}\AgdaBound{M} \AgdaInductiveConstructor{,} \AgdaBound{M′}\AgdaSymbol{))} \AgdaInductiveConstructor{⟩}\AgdaSymbol{\}} \<[54]%
\>[54]\AgdaSymbol{\{}\AgdaBound{N}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{x}\AgdaSymbol{\}} \AgdaBound{x∉fv} \<[67]%
\>[67]\<%
\\
\>[2]\AgdaIndent{16}{}\<[16]%
\>[16]\AgdaSymbol{(}\AgdaInductiveConstructor{notOccurBR} \AgdaSymbol{(}\AgdaInductiveConstructor{notOccurBinj₂} \AgdaSymbol{(}\AgdaInductiveConstructor{notOccurBinj₁} \AgdaSymbol{(}\AgdaInductiveConstructor{notOccurBx} \AgdaBound{xnbM} \AgdaBound{xnbM′}\AgdaSymbol{))))}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{=} \<[5]%
\>[5]\AgdaFunction{begin≡}\<%
\\
\>[2]\AgdaIndent{7}{}\<[7]%
\>[7]\AgdaBound{M} \AgdaFunction{·} \AgdaBound{M′}\<%
\\
\>[0]\AgdaIndent{5}{}\<[5]%
\>[5]\AgdaFunction{≡⟨} \AgdaFunction{cong₂} \AgdaFunction{\_·\_} \<[19]%
\>[19]\AgdaSymbol{(}\AgdaFunction{lemma-substnfv} \AgdaSymbol{\{}\AgdaBound{M}\AgdaSymbol{\}} \<[41]%
\>[41]\AgdaSymbol{(}\AgdaFunction{c∉xs++ys→c∉xs} \AgdaBound{x∉fv}\AgdaSymbol{)} \AgdaBound{xnbM}\AgdaSymbol{)}\<%
\\
\>[5]\AgdaIndent{19}{}\<[19]%
\>[19]\AgdaSymbol{(}\AgdaFunction{lemma-substnfv} \AgdaSymbol{\{}\AgdaBound{M′}\AgdaSymbol{\}} \<[41]%
\>[41]\AgdaSymbol{(}\AgdaFunction{c∉xs++ys→c∉ys} \AgdaSymbol{\{}\AgdaBound{x}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaFunction{fvS} \AgdaFunction{SortλTermVars} \<[80]%
\>[80]\AgdaBound{M}\AgdaSymbol{\}} \AgdaBound{x∉fv}\AgdaSymbol{)} \AgdaBound{xnbM′}\AgdaSymbol{)} \<[98]%
\>[98]\AgdaFunction{⟩}\<%
\\
\>[0]\AgdaIndent{7}{}\<[7]%
\>[7]\AgdaSymbol{(}\AgdaBound{M} \AgdaFunction{[} \AgdaBound{x} \AgdaFunction{≔} \AgdaBound{N} \AgdaFunction{]ₙ}\AgdaSymbol{)} \AgdaFunction{·} \AgdaSymbol{(}\AgdaBound{M′} \AgdaFunction{[} \AgdaBound{x} \AgdaFunction{≔} \AgdaBound{N} \AgdaFunction{]ₙ}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{5}{}\<[5]%
\>[5]\AgdaFunction{≡⟨} \AgdaInductiveConstructor{refl} \AgdaFunction{⟩}\<%
\\
\>[5]\AgdaIndent{7}{}\<[7]%
\>[7]\AgdaSymbol{(}\AgdaBound{M} \AgdaFunction{·} \AgdaBound{M′}\AgdaSymbol{)} \AgdaFunction{[} \AgdaBound{x} \AgdaFunction{≔} \AgdaBound{N} \AgdaFunction{]ₙ}\<%
\\
\>[0]\AgdaIndent{5}{}\<[5]%
\>[5]\AgdaFunction{□}\<%
\\
\>\AgdaFunction{lemma-substnfv} \<[16]%
\>[16]\AgdaSymbol{\{}\AgdaInductiveConstructor{⟨} \AgdaInductiveConstructor{inj₂} \AgdaSymbol{(}\AgdaInductiveConstructor{inj₂} \AgdaSymbol{(}\AgdaBound{y} \AgdaInductiveConstructor{,} \AgdaBound{M}\AgdaSymbol{))} \AgdaInductiveConstructor{⟩}\AgdaSymbol{\}} \<[55]%
\>[55]\AgdaSymbol{\{}\AgdaBound{N}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{x}\AgdaSymbol{\}} \AgdaBound{x∉fv} \<[68]%
\>[68]\<%
\\
\>[5]\AgdaIndent{16}{}\<[16]%
\>[16]\AgdaSymbol{(}\AgdaInductiveConstructor{notOccurBR} \AgdaSymbol{(}\AgdaInductiveConstructor{notOccurBinj₂} \AgdaSymbol{(}\AgdaInductiveConstructor{notOccurBinj₂} \AgdaSymbol{(}\AgdaInductiveConstructor{notOccurBB≢} \AgdaBound{x≢y} \AgdaBound{xnbM}\AgdaSymbol{))))}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{=} \<[5]%
\>[5]\AgdaFunction{begin≡}\<%
\\
\>[2]\AgdaIndent{7}{}\<[7]%
\>[7]\AgdaFunction{ƛ} \AgdaBound{y} \AgdaBound{M}\<%
\\
\>[0]\AgdaIndent{5}{}\<[5]%
\>[5]\AgdaFunction{≡⟨} \AgdaFunction{cong} \AgdaSymbol{(}\AgdaFunction{ƛ} \AgdaBound{y}\AgdaSymbol{)} \<[20]%
\>[20]\AgdaSymbol{(}\AgdaFunction{lemma-substnfv} \<[37]%
\>[37]\AgdaSymbol{\{}\AgdaBound{M}\AgdaSymbol{\}}\<%
\\
\>[5]\AgdaIndent{37}{}\<[37]%
\>[37]\AgdaSymbol{(}\AgdaFunction{lemma-∉} \AgdaSymbol{(}\AgdaFunction{sym≢} \AgdaBound{x≢y}\AgdaSymbol{)} \AgdaBound{x∉fv}\AgdaSymbol{)}\<%
\\
\>[5]\AgdaIndent{37}{}\<[37]%
\>[37]\AgdaBound{xnbM}\AgdaSymbol{)} \<[44]%
\>[44]\AgdaFunction{⟩} \<[47]%
\>[47]\<%
\\
\>[0]\AgdaIndent{7}{}\<[7]%
\>[7]\AgdaFunction{ƛ} \AgdaBound{y} \AgdaSymbol{(}\AgdaBound{M} \AgdaFunction{[} \AgdaBound{x} \AgdaFunction{≔} \AgdaBound{N} \AgdaFunction{]ₙ}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{5}{}\<[5]%
\>[5]\AgdaFunction{≡⟨} \AgdaInductiveConstructor{refl} \AgdaFunction{⟩} \<[20]%
\>[20]\<%
\\
\>[5]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaSymbol{(}\AgdaFunction{ƛ} \AgdaBound{y} \AgdaBound{M}\AgdaSymbol{)} \AgdaFunction{[} \AgdaBound{x} \AgdaFunction{≔} \AgdaBound{N} \AgdaFunction{]ₙ}\<%
\\
\>[0]\AgdaIndent{5}{}\<[5]%
\>[5]\AgdaFunction{□}\<%
\\
%
\\
\>\AgdaFunction{lemma-substCompositionV} \<[25]%
\>[25]\AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{x} \AgdaBound{y} \AgdaBound{z} \AgdaSymbol{:} \AgdaFunction{V}\AgdaSymbol{\}\{}\AgdaBound{N} \AgdaBound{L} \AgdaSymbol{:} \AgdaFunction{λTerm}\AgdaSymbol{\}}\<%
\\
\>[5]\AgdaIndent{25}{}\<[25]%
\>[25]\AgdaSymbol{→} \AgdaBound{x} \AgdaFunction{∉} \AgdaBound{y} \AgdaInductiveConstructor{∷} \AgdaFunction{fv} \<[39]%
\>[39]\AgdaBound{L}\<%
\\
\>[5]\AgdaIndent{25}{}\<[25]%
\>[25]\AgdaSymbol{→} \AgdaBound{x} \AgdaFunction{notOccurBind} \AgdaBound{L}\<%
\\
\>[5]\AgdaIndent{25}{}\<[25]%
\>[25]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaFunction{v} \AgdaBound{z}\AgdaSymbol{)} \AgdaFunction{[} \AgdaBound{x} \AgdaFunction{≔} \AgdaBound{N} \AgdaFunction{]ₙ} \AgdaFunction{[} \AgdaBound{y} \AgdaFunction{≔} \AgdaBound{L} \AgdaFunction{]ₙ} \AgdaDatatype{≡} \AgdaSymbol{(}\AgdaFunction{v} \AgdaBound{z}\AgdaSymbol{)} \AgdaFunction{[} \AgdaBound{y} \AgdaFunction{≔} \AgdaBound{L} \AgdaFunction{]ₙ} \AgdaFunction{[} \AgdaBound{x} \AgdaFunction{≔} \AgdaBound{N} \AgdaFunction{[} \AgdaBound{y} \AgdaFunction{≔} \AgdaBound{L} \AgdaFunction{]ₙ} \AgdaFunction{]ₙ} \<[96]%
\>[96]\<%
\\
\>\AgdaFunction{lemma-substCompositionV} \AgdaSymbol{\{}\AgdaBound{x}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{y}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{z}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{N}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{L}\AgdaSymbol{\}} \AgdaBound{x∉yfvL} \AgdaSymbol{\_} \AgdaKeyword{with} \AgdaBound{x} \AgdaFunction{≟v} \AgdaBound{z}\<%
\\
\>\AgdaSymbol{...} \AgdaSymbol{|} \AgdaInductiveConstructor{yes} \AgdaBound{x≡z} \AgdaKeyword{with} \AgdaBound{y} \AgdaFunction{≟v} \AgdaBound{z} \<[26]%
\>[26]\<%
\\
\>\AgdaSymbol{...} \<[12]%
\>[12]\AgdaSymbol{|} \AgdaInductiveConstructor{yes} \AgdaBound{y≡z} \<[34]%
\>[34]\AgdaSymbol{=} \AgdaFunction{⊥-elim} \AgdaSymbol{((}\AgdaFunction{b∉a∷xs→b≢a} \AgdaBound{x∉yfvL}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{trans≡} \AgdaBound{x≡z} \AgdaSymbol{(}\AgdaFunction{sym} \AgdaBound{y≡z}\AgdaSymbol{)))}\<%
\\
\>\AgdaSymbol{...} \<[12]%
\>[12]\AgdaSymbol{|} \AgdaInductiveConstructor{no} \<[18]%
\>[18]\AgdaBound{y≢z} \AgdaKeyword{with} \AgdaBound{x} \AgdaFunction{≟v} \AgdaBound{z}\<%
\\
\>\AgdaSymbol{...} \<[22]%
\>[22]\AgdaSymbol{|} \<[25]%
\>[25]\AgdaInductiveConstructor{yes} \AgdaSymbol{\_} \<[34]%
\>[34]\AgdaSymbol{=} \AgdaInductiveConstructor{refl}\<%
\\
\>\AgdaSymbol{...} \<[22]%
\>[22]\AgdaSymbol{|} \<[25]%
\>[25]\AgdaInductiveConstructor{no} \<[29]%
\>[29]\AgdaBound{x≢z} \<[34]%
\>[34]\AgdaSymbol{=} \AgdaFunction{⊥-elim} \AgdaSymbol{(}\AgdaBound{x≢z} \AgdaBound{x≡z}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{lemma-substCompositionV} \AgdaSymbol{\{}\AgdaBound{x}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{y}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{z}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{N}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{L}\AgdaSymbol{\}} \AgdaBound{x∉yfvL} \AgdaBound{xnbL}\<%
\\
\>[0]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaSymbol{|} \AgdaInductiveConstructor{no} \<[10]%
\>[10]\AgdaBound{x≢z} \AgdaKeyword{with} \AgdaBound{y} \AgdaFunction{≟v} \AgdaBound{z} \<[26]%
\>[26]\<%
\\
\>\AgdaSymbol{...} \<[12]%
\>[12]\AgdaSymbol{|} \AgdaInductiveConstructor{yes} \AgdaBound{y≡z}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{=} \AgdaFunction{lemma-substnfv} \AgdaSymbol{(}\AgdaFunction{lemma∉fvfvS} \AgdaSymbol{\{}\AgdaFunction{λF}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaFunction{SortλTermVars}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{L}\AgdaSymbol{\}} \AgdaSymbol{(}\AgdaFunction{b∉a∷xs→b∉xs} \AgdaBound{x∉yfvL}\AgdaSymbol{))} \AgdaBound{xnbL}\<%
\\
\>\AgdaSymbol{...} \<[12]%
\>[12]\AgdaSymbol{|} \AgdaInductiveConstructor{no} \<[18]%
\>[18]\AgdaBound{y≢z} \AgdaKeyword{with} \AgdaBound{x} \AgdaFunction{≟v} \AgdaBound{z}\<%
\\
\>\AgdaSymbol{...} \<[22]%
\>[22]\AgdaSymbol{|} \<[25]%
\>[25]\AgdaInductiveConstructor{yes} \AgdaBound{x≡z} \<[34]%
\>[34]\AgdaSymbol{=} \AgdaFunction{⊥-elim} \AgdaSymbol{(}\AgdaBound{x≢z} \AgdaBound{x≡z}\AgdaSymbol{)}\<%
\\
\>\AgdaSymbol{...} \<[22]%
\>[22]\AgdaSymbol{|} \<[25]%
\>[25]\AgdaInductiveConstructor{no} \<[29]%
\>[29]\AgdaSymbol{\_} \<[34]%
\>[34]\AgdaSymbol{=} \AgdaInductiveConstructor{refl}\<%
\\
%
\\
\>\AgdaFunction{lemma-substNComposition} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{M} \AgdaBound{N} \AgdaBound{L} \AgdaSymbol{:} \AgdaFunction{λTerm}\AgdaSymbol{\}\{}\AgdaBound{x} \AgdaBound{y} \AgdaSymbol{:} \AgdaFunction{V}\AgdaSymbol{\}}\<%
\\
\>[2]\AgdaIndent{5}{}\<[5]%
\>[5]\AgdaSymbol{→} \AgdaBound{x} \AgdaFunction{∉} \AgdaBound{y} \AgdaInductiveConstructor{∷} \AgdaFunction{fv} \AgdaBound{L}\<%
\\
\>[2]\AgdaIndent{5}{}\<[5]%
\>[5]\AgdaSymbol{→} \AgdaBound{x} \AgdaFunction{notOccurBind} \AgdaBound{L}\<%
\\
\>[2]\AgdaIndent{5}{}\<[5]%
\>[5]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{M} \AgdaFunction{[} \AgdaBound{x} \AgdaFunction{≔} \AgdaBound{N} \AgdaFunction{]ₙ}\AgdaSymbol{)} \AgdaFunction{[} \AgdaBound{y} \AgdaFunction{≔} \AgdaBound{L} \AgdaFunction{]ₙ} \AgdaDatatype{≡} \AgdaSymbol{(}\AgdaBound{M} \AgdaFunction{[} \AgdaBound{y} \AgdaFunction{≔} \AgdaBound{L} \AgdaFunction{]ₙ}\AgdaSymbol{)}\AgdaFunction{[} \AgdaBound{x} \AgdaFunction{≔} \AgdaBound{N} \AgdaFunction{[} \AgdaBound{y} \AgdaFunction{≔} \AgdaBound{L} \AgdaFunction{]ₙ} \AgdaFunction{]ₙ}\<%
\\
\>\AgdaFunction{lemma-substNComposition} \AgdaSymbol{\{}\AgdaInductiveConstructor{⟨} \AgdaInductiveConstructor{inj₁} \AgdaBound{z} \<[49]%
\>[49]\AgdaInductiveConstructor{⟩}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{N}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{L}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{x}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{y}\AgdaSymbol{\}} \AgdaBound{x∉y:fvL} \AgdaBound{x∉bL}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{=} \AgdaFunction{lemma-substCompositionV} \AgdaSymbol{\{}\AgdaBound{x}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{y}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{z}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{N}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{L}\AgdaSymbol{\}} \AgdaBound{x∉y:fvL} \AgdaBound{x∉bL}\<%
\\
\>\AgdaFunction{lemma-substNComposition} \AgdaSymbol{\{}\AgdaInductiveConstructor{⟨} \AgdaInductiveConstructor{inj₂} \AgdaSymbol{(}\AgdaInductiveConstructor{inj₁} \AgdaSymbol{(}\AgdaBound{M} \AgdaInductiveConstructor{,} \AgdaBound{M'}\AgdaSymbol{))} \<[49]%
\>[49]\AgdaInductiveConstructor{⟩}\AgdaSymbol{\}} \AgdaBound{x∉y:fvL} \AgdaBound{x∉bL}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{=} \AgdaFunction{cong₂} \AgdaFunction{\_·\_} \AgdaSymbol{(}\AgdaFunction{lemma-substNComposition} \AgdaSymbol{\{}\AgdaBound{M}\AgdaSymbol{\}} \AgdaBound{x∉y:fvL} \AgdaBound{x∉bL}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{lemma-substNComposition} \AgdaSymbol{\{}\AgdaBound{M'}\AgdaSymbol{\}} \AgdaBound{x∉y:fvL} \AgdaBound{x∉bL}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{lemma-substNComposition} \AgdaSymbol{\{}\AgdaInductiveConstructor{⟨} \AgdaInductiveConstructor{inj₂} \AgdaSymbol{(}\AgdaInductiveConstructor{inj₂} \AgdaSymbol{(}\AgdaBound{z} \AgdaInductiveConstructor{,} \AgdaBound{M}\AgdaSymbol{))} \<[49]%
\>[49]\AgdaInductiveConstructor{⟩}\AgdaSymbol{\}} \AgdaBound{x∉y:fvL} \AgdaBound{x∉bL}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{=} \AgdaFunction{cong} \AgdaSymbol{(}\AgdaFunction{ƛ} \AgdaBound{z}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{lemma-substNComposition} \AgdaSymbol{\{}\AgdaBound{M}\AgdaSymbol{\}} \AgdaBound{x∉y:fvL} \AgdaBound{x∉bL}\AgdaSymbol{)}\<%
\end{code}

Parallel Reduction

\begin{code}%
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{Relation.Relation} \AgdaFunction{λTerm} \AgdaKeyword{renaming} \AgdaSymbol{(}\_∘\_ \AgdaSymbol{to} \_∘ᵣ\_\AgdaSymbol{)}\<%
\\
\>\AgdaKeyword{infix} \AgdaNumber{7} \AgdaDatatype{\_⇉n\_}\<%
\end{code}

\begin{code}%
\>\AgdaKeyword{data} \AgdaDatatype{\_⇉n\_} \AgdaSymbol{:} \AgdaFunction{Rel} \AgdaKeyword{where}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaInductiveConstructor{⇉nv} \<[7]%
\>[7]\AgdaSymbol{:} \<[10]%
\>[10]\AgdaSymbol{\{}\AgdaBound{x} \AgdaSymbol{:} \AgdaFunction{V}\AgdaSymbol{\}}\<%
\\
\>[2]\AgdaIndent{9}{}\<[9]%
\>[9]\AgdaSymbol{→} \AgdaFunction{v} \AgdaBound{x} \AgdaDatatype{⇉n} \AgdaFunction{v} \AgdaBound{x}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaInductiveConstructor{⇉nƛ} \<[7]%
\>[7]\AgdaSymbol{:} \<[10]%
\>[10]\AgdaSymbol{\{}\AgdaBound{M} \AgdaBound{N} \AgdaSymbol{:} \AgdaFunction{λTerm}\AgdaSymbol{\}\{}\AgdaBound{x} \AgdaSymbol{:} \AgdaFunction{V}\AgdaSymbol{\}}\<%
\\
\>[2]\AgdaIndent{9}{}\<[9]%
\>[9]\AgdaSymbol{→} \AgdaBound{M} \AgdaDatatype{⇉n} \AgdaBound{N}\<%
\\
\>[2]\AgdaIndent{9}{}\<[9]%
\>[9]\AgdaSymbol{→} \AgdaFunction{ƛ} \AgdaBound{x} \AgdaBound{M} \AgdaDatatype{⇉n} \AgdaFunction{ƛ} \AgdaBound{x} \AgdaBound{N}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaInductiveConstructor{⇉n·} \<[7]%
\>[7]\AgdaSymbol{:} \<[10]%
\>[10]\AgdaSymbol{\{}\AgdaBound{M} \AgdaBound{M'} \AgdaBound{N} \AgdaBound{N'} \AgdaSymbol{:} \AgdaFunction{λTerm}\AgdaSymbol{\}}\<%
\\
\>[2]\AgdaIndent{9}{}\<[9]%
\>[9]\AgdaSymbol{→} \AgdaBound{M} \AgdaDatatype{⇉n} \AgdaBound{M'} \AgdaSymbol{→} \AgdaBound{N} \AgdaDatatype{⇉n} \AgdaBound{N'}\<%
\\
\>[2]\AgdaIndent{9}{}\<[9]%
\>[9]\AgdaSymbol{→} \AgdaBound{M} \AgdaFunction{·} \AgdaBound{N} \AgdaDatatype{⇉n} \AgdaBound{M'} \AgdaFunction{·} \AgdaBound{N'}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaInductiveConstructor{⇉nβ} \AgdaSymbol{:} \<[10]%
\>[10]\AgdaSymbol{\{}\AgdaBound{M} \AgdaBound{M'} \AgdaBound{N} \AgdaBound{N'} \AgdaSymbol{:} \AgdaFunction{λTerm}\AgdaSymbol{\}\{}\AgdaBound{x} \AgdaSymbol{:} \AgdaFunction{V}\AgdaSymbol{\}}\<%
\\
\>[2]\AgdaIndent{9}{}\<[9]%
\>[9]\AgdaSymbol{→} \AgdaBound{M} \AgdaDatatype{⇉n} \AgdaBound{M'} \<[19]%
\>[19]\<%
\\
\>[2]\AgdaIndent{9}{}\<[9]%
\>[9]\AgdaSymbol{→} \AgdaBound{N} \AgdaDatatype{⇉n} \AgdaBound{N'}\<%
\\
\>[2]\AgdaIndent{9}{}\<[9]%
\>[9]\AgdaSymbol{→} \AgdaFunction{ƛ} \AgdaBound{x} \AgdaBound{M} \AgdaFunction{·} \AgdaBound{N} \AgdaDatatype{⇉n} \AgdaBound{M'} \AgdaFunction{[} \AgdaBound{x} \AgdaFunction{≔} \AgdaBound{N'} \AgdaFunction{]ₙ}\<%
\end{code}

All lemmas about ⇉n relation must have freshness premises so naive substitution behaves correctly

\begin{code}%
\>\AgdaFunction{lemma⇉nEquiv} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{x} \AgdaBound{y} \AgdaSymbol{:} \AgdaFunction{V}\AgdaSymbol{\}\{}\AgdaBound{M} \AgdaBound{N} \AgdaSymbol{:} \AgdaFunction{λTerm}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaBound{M} \AgdaDatatype{⇉n} \AgdaBound{N} \AgdaSymbol{→} \AgdaFunction{（} \AgdaBound{x} \AgdaFunction{∙} \AgdaBound{y} \AgdaFunction{）} \AgdaBound{M} \AgdaDatatype{⇉n} \AgdaFunction{（} \AgdaBound{x} \AgdaFunction{∙} \AgdaBound{y} \AgdaFunction{）} \AgdaBound{N}\<%
\\
\>\AgdaFunction{lemma⇉nEquiv} \<[14]%
\>[14]\AgdaInductiveConstructor{⇉nv} \<[30]%
\>[30]\AgdaSymbol{=} \AgdaInductiveConstructor{⇉nv}\<%
\\
\>\AgdaFunction{lemma⇉nEquiv} \<[14]%
\>[14]\AgdaSymbol{(}\AgdaInductiveConstructor{⇉nƛ} \AgdaBound{M⇉N}\AgdaSymbol{)} \<[30]%
\>[30]\AgdaSymbol{=} \AgdaInductiveConstructor{⇉nƛ} \AgdaSymbol{(}\AgdaFunction{lemma⇉nEquiv} \AgdaBound{M⇉N}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{lemma⇉nEquiv} \<[14]%
\>[14]\AgdaSymbol{(}\AgdaInductiveConstructor{⇉n·} \AgdaBound{M⇉M'} \AgdaBound{N⇉N'}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaInductiveConstructor{⇉n·} \AgdaSymbol{(}\AgdaFunction{lemma⇉nEquiv} \AgdaBound{M⇉M'}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{lemma⇉nEquiv} \AgdaBound{N⇉N'}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{lemma⇉nEquiv} \<[14]%
\>[14]\AgdaSymbol{\{}\AgdaBound{x}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{y}\AgdaSymbol{\}} \<[22]%
\>[22]\<%
\\
\>[9]\AgdaIndent{13}{}\<[13]%
\>[13]\AgdaSymbol{(}\AgdaInductiveConstructor{⇉nβ} \AgdaSymbol{\{}\AgdaBound{M}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{M'}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{N}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{N'}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{z}\AgdaSymbol{\}} \AgdaBound{M⇉M'} \AgdaBound{N⇉N'}\AgdaSymbol{)} \<[51]%
\>[51]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{=} \AgdaFunction{subst} \<[11]%
\>[11]\AgdaSymbol{(λ} \AgdaBound{X} \AgdaSymbol{→} \AgdaFunction{（} \AgdaBound{x} \AgdaFunction{∙} \AgdaBound{y} \AgdaFunction{）} \AgdaSymbol{(}\AgdaFunction{ƛ} \AgdaBound{z} \AgdaBound{M} \AgdaFunction{·} \AgdaBound{N}\AgdaSymbol{)} \AgdaDatatype{⇉n} \AgdaBound{X}\AgdaSymbol{)} \<[46]%
\>[46]\<%
\\
\>[2]\AgdaIndent{11}{}\<[11]%
\>[11]\AgdaSymbol{(}\AgdaFunction{lemma-[]Swap} \AgdaSymbol{\{}\AgdaBound{z}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{x}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{y}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{M'}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{N'}\AgdaSymbol{\})} \<[48]%
\>[48]\<%
\\
\>[2]\AgdaIndent{11}{}\<[11]%
\>[11]\AgdaSymbol{(}\AgdaInductiveConstructor{⇉nβ} \AgdaSymbol{(}\AgdaFunction{lemma⇉nEquiv} \AgdaBound{M⇉M'}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{lemma⇉nEquiv} \AgdaBound{N⇉N'}\AgdaSymbol{))}\<%
\\
\>\AgdaComment{-- }\<%
\\
\>\AgdaFunction{FourλTermF} \AgdaSymbol{=} \<[14]%
\>[14]\AgdaInductiveConstructor{|Ef|} \AgdaFunction{λF} \AgdaInductiveConstructor{|x|} \AgdaInductiveConstructor{|Ef|} \AgdaFunction{λF} \AgdaInductiveConstructor{|x|} \AgdaInductiveConstructor{|Ef|} \AgdaFunction{λF} \AgdaInductiveConstructor{|x|} \AgdaInductiveConstructor{|Ef|} \AgdaFunction{λF} \<[58]%
\>[58]\<%
\\
\>\AgdaFunction{FourλTerm} \AgdaSymbol{=} \AgdaDatatype{μ} \AgdaFunction{FourλTermF}\<%
\\
%
\\
\>\AgdaKeyword{postulate}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaPostulate{lemma⇉nBinders} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{M} \AgdaBound{N} \AgdaSymbol{:} \AgdaFunction{λTerm}\AgdaSymbol{\}\{}\AgdaBound{x} \AgdaSymbol{:} \AgdaFunction{V}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaBound{x} \AgdaFunction{∈b} \AgdaBound{N} \AgdaSymbol{→} \AgdaBound{M} \AgdaDatatype{⇉n} \AgdaBound{N} \AgdaSymbol{→} \AgdaBound{x} \AgdaFunction{∈b} \AgdaBound{M}\<%
\\
\>\AgdaComment{-- lemma⇉nBinders = \{!!\}}\<%
\\
%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaPostulate{lemma⇉nNotBinders} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{M} \AgdaBound{N} \AgdaSymbol{:} \AgdaFunction{λTerm}\AgdaSymbol{\}\{}\AgdaBound{x} \AgdaSymbol{:} \AgdaFunction{V}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaBound{x} \AgdaFunction{notOccurBind} \AgdaBound{M} \AgdaSymbol{→} \AgdaBound{M} \AgdaDatatype{⇉n} \AgdaBound{N} \AgdaSymbol{→} \AgdaBound{x} \AgdaFunction{notOccurBind} \AgdaBound{N}\<%
\\
\>\AgdaComment{-- lemma⇉nNotBinders = \{!!\}}\<%
\\
%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaPostulate{lemma⇉nListNotBinders} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{M} \AgdaBound{N} \AgdaSymbol{:} \AgdaFunction{λTerm}\AgdaSymbol{\}\{}\AgdaBound{xs} \AgdaSymbol{:} \AgdaDatatype{List} \AgdaFunction{V}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaFunction{ListNotOccurBind} \AgdaBound{xs} \AgdaBound{M} \AgdaSymbol{→} \AgdaBound{M} \AgdaDatatype{⇉n} \AgdaBound{N} \AgdaSymbol{→} \AgdaFunction{ListNotOccurBind} \AgdaBound{xs} \AgdaBound{N}\<%
\\
\>\AgdaComment{-- lemma⇉nListNotBinders = \{!!\}}\<%
\\
%
\\
\>\AgdaFunction{BVC} \AgdaSymbol{:} \AgdaFunction{λTerm} \AgdaSymbol{→} \AgdaPrimitiveType{Set}\<%
\\
\>\AgdaFunction{BVC} \AgdaBound{M} \AgdaSymbol{=} \<[9]%
\>[9]\AgdaFunction{ListNotOccurBind} \AgdaSymbol{(}\AgdaFunction{fv} \AgdaBound{M}\AgdaSymbol{)} \AgdaBound{M}\<%
\\
\>[2]\AgdaIndent{5}{}\<[5]%
\>[5]\<%
\\
\>\AgdaFunction{BVCC} \AgdaSymbol{:} \AgdaFunction{λTerm} \AgdaSymbol{→} \AgdaPrimitiveType{Set}\<%
\\
\>\AgdaFunction{BVCC} \AgdaBound{M} \AgdaSymbol{=} \AgdaSymbol{(\{}\AgdaBound{y} \AgdaSymbol{:} \AgdaFunction{V}\AgdaSymbol{\}(}\AgdaBound{y∈bM} \AgdaSymbol{:} \AgdaBound{y} \AgdaFunction{∈b} \AgdaBound{M}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaFunction{notOccurBindExcept} \AgdaBound{y} \AgdaBound{M} \AgdaBound{y∈bM}\AgdaSymbol{)}\<%
\\
%
\\
\>\AgdaFunction{BVCN} \AgdaSymbol{:} \AgdaFunction{λTerm} \AgdaSymbol{→} \AgdaPrimitiveType{Set}\<%
\\
\>\AgdaFunction{BVCN} \AgdaBound{M} \AgdaSymbol{=} \AgdaFunction{BVC} \AgdaBound{M} \AgdaFunction{×} \AgdaFunction{BVCC} \AgdaBound{M}\<%
\\
%
\\
\>\AgdaKeyword{postulate}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaPostulate{lemmaSubstsBVCN} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{z} \AgdaSymbol{:} \AgdaFunction{V}\AgdaSymbol{\}\{}\AgdaBound{M} \AgdaBound{N} \AgdaSymbol{:} \AgdaFunction{λTerm}\AgdaSymbol{\}}\<%
\\
\>[2]\AgdaIndent{18}{}\<[18]%
\>[18]\AgdaSymbol{→} \AgdaFunction{BVCN} \AgdaSymbol{((}\AgdaFunction{ƛ} \AgdaBound{z} \AgdaBound{M}\AgdaSymbol{)} \AgdaFunction{·} \AgdaBound{N}\AgdaSymbol{)}\<%
\\
\>[2]\AgdaIndent{18}{}\<[18]%
\>[18]\AgdaSymbol{→} \AgdaBound{M} \AgdaFunction{[} \AgdaBound{z} \AgdaFunction{≔} \AgdaBound{N} \AgdaFunction{]} \AgdaFunction{∼α} \AgdaBound{M} \AgdaFunction{[} \AgdaBound{z} \AgdaFunction{≔} \AgdaBound{N} \AgdaFunction{]ₙ} \<[65]%
\>[65]\<%
\\
\>\AgdaComment{-- lemmaSubstsBVCN \{z\} \{M\} \{N\} (bvcƛxMN , f) = lemmaSubsts \{z\} \{M\} \{N\} \{!!\}}\<%
\\
%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaPostulate{lemma⇉nNotBindersExcept} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{M} \AgdaBound{N} \AgdaSymbol{:} \AgdaFunction{λTerm}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaBound{M} \AgdaDatatype{⇉n} \AgdaBound{N} \AgdaSymbol{→} \AgdaFunction{BVCC} \AgdaBound{M} \AgdaSymbol{→} \AgdaFunction{BVCC} \AgdaBound{N}\<%
\\
\>\AgdaComment{-- lemma⇉nNotBindersExcept M⇉nN f y∈bN = \{!!\}}\<%
\\
%
\\
\>\AgdaKeyword{postulate}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaPostulate{lemma⇉nBVCN} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{M} \AgdaBound{N} \AgdaSymbol{:} \AgdaFunction{λTerm}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaFunction{BVCN} \AgdaBound{M} \AgdaSymbol{→} \AgdaBound{M} \AgdaDatatype{⇉n} \AgdaBound{N} \AgdaSymbol{→} \AgdaFunction{BVCN} \AgdaBound{N}\<%
\\
\>\AgdaComment{-- lemma⇉nBVCN BVCNM M⇉nN = \{! !\}}\<%
\\
%
\\
\>\AgdaFunction{lemma-⇉SubstN} \AgdaSymbol{:} \<[17]%
\>[17]\AgdaSymbol{\{}\AgdaBound{x} \AgdaSymbol{:} \AgdaFunction{V}\AgdaSymbol{\}\{}\AgdaBound{M} \AgdaBound{M'} \AgdaBound{N} \AgdaBound{N'} \AgdaSymbol{:} \AgdaFunction{λTerm} \AgdaSymbol{\}}\<%
\\
\>[2]\AgdaIndent{5}{}\<[5]%
\>[5]\AgdaSymbol{→} \AgdaFunction{ListNotOccurBind} \AgdaSymbol{(}\AgdaBound{x} \AgdaInductiveConstructor{∷} \AgdaFunction{fv} \AgdaBound{N'}\AgdaSymbol{)} \AgdaBound{M}\<%
\\
\>[2]\AgdaIndent{5}{}\<[5]%
\>[5]\AgdaSymbol{→} \AgdaBound{M} \AgdaDatatype{⇉n} \AgdaBound{M'} \AgdaSymbol{→} \AgdaBound{N} \AgdaDatatype{⇉n} \AgdaBound{N'}\<%
\\
\>[2]\AgdaIndent{5}{}\<[5]%
\>[5]\AgdaSymbol{→} \AgdaSymbol{(\{}\AgdaBound{y} \AgdaSymbol{:} \AgdaFunction{V}\AgdaSymbol{\}(}\AgdaBound{y∈bM} \AgdaSymbol{:} \AgdaBound{y} \AgdaFunction{∈b} \AgdaBound{M}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaBound{y} \AgdaFunction{notOccurBind} \AgdaBound{N}\AgdaSymbol{)}\<%
\\
\>[2]\AgdaIndent{5}{}\<[5]%
\>[5]\AgdaSymbol{→} \AgdaBound{M} \AgdaFunction{[} \AgdaBound{x} \AgdaFunction{≔} \AgdaBound{N} \AgdaFunction{]ₙ} \AgdaDatatype{⇉n} \AgdaBound{M'} \AgdaFunction{[} \AgdaBound{x} \AgdaFunction{≔} \AgdaBound{N'} \AgdaFunction{]ₙ}\<%
\\
\>\AgdaFunction{lemma-⇉SubstN} \AgdaSymbol{\{}\AgdaBound{x}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaInductiveConstructor{⟨} \AgdaInductiveConstructor{inj₁} \AgdaBound{y} \AgdaInductiveConstructor{⟩}\AgdaSymbol{\}} \<[46]%
\>[46]\AgdaBound{nb} \AgdaInductiveConstructor{⇉nv} \<[66]%
\>[66]\AgdaBound{N⇉N'} \AgdaSymbol{\_}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaKeyword{with} \AgdaBound{x} \AgdaFunction{≟v} \AgdaBound{y}\<%
\\
\>\AgdaSymbol{...} \AgdaSymbol{|} \AgdaInductiveConstructor{yes} \AgdaSymbol{\_} \AgdaSymbol{=} \<[15]%
\>[15]\AgdaBound{N⇉N'}\<%
\\
\>\AgdaSymbol{...} \AgdaSymbol{|} \AgdaInductiveConstructor{no} \<[10]%
\>[10]\AgdaSymbol{\_} \AgdaSymbol{=} \<[15]%
\>[15]\AgdaInductiveConstructor{⇉nv}\<%
\\
\>\AgdaFunction{lemma-⇉SubstN} \AgdaSymbol{\{}\AgdaBound{x}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaInductiveConstructor{⟨} \AgdaInductiveConstructor{inj₂} \AgdaSymbol{(}\AgdaInductiveConstructor{inj₁} \AgdaSymbol{(}\AgdaBound{M} \AgdaInductiveConstructor{,} \AgdaBound{P}\AgdaSymbol{))} \AgdaInductiveConstructor{⟩}\AgdaSymbol{\}} \<[46]%
\>[46]\AgdaBound{nb} \AgdaSymbol{(}\AgdaInductiveConstructor{⇉n·} \AgdaBound{M⇉M'} \AgdaBound{P⇉P'}\AgdaSymbol{)} \<[66]%
\>[66]\AgdaBound{N⇉N'} \AgdaBound{f}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{=} \AgdaInductiveConstructor{⇉n·} \<[9]%
\>[9]\AgdaSymbol{(}\AgdaFunction{lemma-⇉SubstN} \<[25]%
\>[25]\AgdaSymbol{(}\AgdaFunction{listNotOccurBx₁inv} \AgdaSymbol{(}\AgdaFunction{listNotOccurBinj₁inv} \AgdaSymbol{(}\AgdaFunction{listNotOccurBinj₂inv} \AgdaSymbol{(}\AgdaFunction{lemmalistNotOccurBindFR→ListNotOccurBindF} \AgdaBound{nb}\AgdaSymbol{))))} \AgdaBound{M⇉M'} \AgdaBound{N⇉N'} \AgdaSymbol{(}\AgdaBound{f} \AgdaFunction{∘} \AgdaInductiveConstructor{∈bFR} \AgdaFunction{∘} \AgdaInductiveConstructor{∈bFinj₂} \AgdaFunction{∘} \AgdaInductiveConstructor{∈bFinj₁} \AgdaFunction{∘} \<[182]%
\>[182]\AgdaInductiveConstructor{∈bFx₁}\AgdaSymbol{))}\<%
\\
\>[2]\AgdaIndent{9}{}\<[9]%
\>[9]\AgdaSymbol{(}\AgdaFunction{lemma-⇉SubstN} \AgdaSymbol{(}\AgdaFunction{listNotOccurBx₂inv} \AgdaSymbol{(}\AgdaFunction{listNotOccurBinj₁inv} \AgdaSymbol{(}\AgdaFunction{listNotOccurBinj₂inv} \AgdaSymbol{(}\AgdaFunction{lemmalistNotOccurBindFR→ListNotOccurBindF} \AgdaBound{nb}\AgdaSymbol{))))} \AgdaBound{P⇉P'} \AgdaBound{N⇉N'} \AgdaSymbol{(}\AgdaBound{f} \AgdaFunction{∘} \AgdaInductiveConstructor{∈bFR} \AgdaFunction{∘} \AgdaInductiveConstructor{∈bFinj₂} \AgdaFunction{∘} \AgdaInductiveConstructor{∈bFinj₁} \AgdaFunction{∘} \<[181]%
\>[181]\AgdaInductiveConstructor{∈bFx₂}\AgdaSymbol{))}\<%
\\
\>\AgdaFunction{lemma-⇉SubstN} \AgdaSymbol{\{}\AgdaBound{x}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaInductiveConstructor{⟨} \AgdaInductiveConstructor{inj₂} \AgdaSymbol{(}\AgdaInductiveConstructor{inj₁} \AgdaSymbol{(}\AgdaInductiveConstructor{⟨} \AgdaInductiveConstructor{inj₂} \AgdaSymbol{(}\AgdaInductiveConstructor{inj₂} \AgdaSymbol{(}\AgdaBound{y} \AgdaInductiveConstructor{,} \AgdaBound{M}\AgdaSymbol{))} \AgdaInductiveConstructor{⟩} \AgdaInductiveConstructor{,} \AgdaBound{P}\AgdaSymbol{))} \AgdaInductiveConstructor{⟩}\AgdaSymbol{\}} \AgdaSymbol{.\{}\AgdaBound{M'} \AgdaFunction{[} \AgdaBound{y} \AgdaFunction{≔} \AgdaBound{P'} \AgdaFunction{]ₙ}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{N}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{N'}\AgdaSymbol{\}}\<%
\\
\>[9]\AgdaIndent{46}{}\<[46]%
\>[46]\AgdaBound{nb} \AgdaSymbol{(}\AgdaInductiveConstructor{⇉nβ} \AgdaSymbol{\{}\AgdaSymbol{.}\AgdaBound{M}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{M'}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaSymbol{.}\AgdaBound{P}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{P'}\AgdaSymbol{\}} \AgdaBound{M⇉M'} \AgdaBound{P⇉P'}\AgdaSymbol{)} \<[86]%
\>[86]\AgdaBound{N⇉N'} \AgdaBound{f}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{=} \AgdaFunction{subst} \<[11]%
\>[11]\AgdaSymbol{(λ} \AgdaBound{X} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaFunction{ƛ} \AgdaBound{y} \AgdaSymbol{(}\AgdaBound{M} \AgdaFunction{[} \AgdaBound{x} \AgdaFunction{≔} \AgdaBound{N} \AgdaFunction{]ₙ}\AgdaSymbol{))} \AgdaFunction{·} \AgdaSymbol{(}\AgdaBound{P} \AgdaFunction{[} \AgdaBound{x} \AgdaFunction{≔} \AgdaBound{N} \AgdaFunction{]ₙ}\AgdaSymbol{)} \AgdaDatatype{⇉n} \AgdaBound{X}\AgdaSymbol{)}\<%
\\
\>[2]\AgdaIndent{11}{}\<[11]%
\>[11]\AgdaSymbol{(}\AgdaFunction{sym} \AgdaSymbol{(}\AgdaFunction{lemma-substNComposition} \<[42]%
\>[42]\AgdaSymbol{\{}\AgdaBound{M'}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{P'}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{N'}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{y}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{x}\AgdaSymbol{\}} \<[65]%
\>[65]\<%
\\
\>[11]\AgdaIndent{42}{}\<[42]%
\>[42]\AgdaSymbol{(}\AgdaFunction{listNotOccurBBinv∉fv} \AgdaSymbol{(}\AgdaFunction{listNotOccurBinj₂inv} \AgdaSymbol{(}\AgdaFunction{listNotOccurBinj₂inv} \AgdaSymbol{(}\AgdaFunction{lemmalistNotOccurBindFR→ListNotOccurBindF} \AgdaSymbol{(}\AgdaFunction{listNotOccurBx₁inv} \AgdaSymbol{(}\AgdaFunction{listNotOccurBinj₁inv} \AgdaSymbol{(}\AgdaFunction{listNotOccurBinj₂inv} \AgdaSymbol{(}\AgdaFunction{lemmalistNotOccurBindFR→ListNotOccurBindF} \AgdaBound{nb}\AgdaSymbol{))))))))} \<[269]%
\>[269]\<%
\\
\>[11]\AgdaIndent{42}{}\<[42]%
\>[42]\AgdaSymbol{(}\AgdaPostulate{lemma⇉nNotBinders} \AgdaSymbol{(}\AgdaBound{f} \AgdaSymbol{(}\AgdaInductiveConstructor{∈bFR} \AgdaSymbol{(}\AgdaInductiveConstructor{∈bFinj₂} \AgdaSymbol{(}\AgdaInductiveConstructor{∈bFinj₁} \AgdaSymbol{(}\AgdaInductiveConstructor{∈bFx₁} \AgdaSymbol{(}\AgdaInductiveConstructor{∈bFR} \AgdaSymbol{(}\AgdaInductiveConstructor{∈bFinj₂} \AgdaSymbol{(}\AgdaInductiveConstructor{∈bFinj₂} \AgdaInductiveConstructor{∈bFB≡}\AgdaSymbol{))))))))} \AgdaBound{N⇉N'}\AgdaSymbol{)))} \<[141]%
\>[141]\<%
\\
\>[0]\AgdaIndent{11}{}\<[11]%
\>[11]\AgdaSymbol{(}\AgdaInductiveConstructor{⇉nβ} \<[17]%
\>[17]\AgdaSymbol{(}\AgdaFunction{lemma-⇉SubstN} \AgdaSymbol{(}\AgdaFunction{listNotOccurBBinv} \AgdaSymbol{(}\AgdaFunction{listNotOccurBinj₂inv} \AgdaSymbol{(}\AgdaFunction{listNotOccurBinj₂inv} \AgdaSymbol{(}\AgdaFunction{lemmalistNotOccurBindFR→ListNotOccurBindF} \AgdaSymbol{(}\AgdaFunction{listNotOccurBx₁inv} \AgdaSymbol{(}\AgdaFunction{listNotOccurBinj₁inv} \AgdaSymbol{(}\AgdaFunction{listNotOccurBinj₂inv} \AgdaSymbol{(}\AgdaFunction{lemmalistNotOccurBindFR→ListNotOccurBindF} \AgdaBound{nb}\AgdaSymbol{))))))))} \AgdaBound{M⇉M'} \AgdaBound{N⇉N'} \AgdaSymbol{(}\AgdaBound{f} \AgdaFunction{∘} \AgdaInductiveConstructor{∈bFR} \AgdaFunction{∘} \AgdaInductiveConstructor{∈bFinj₂} \AgdaFunction{∘} \AgdaInductiveConstructor{∈bFinj₁} \AgdaFunction{∘} \AgdaInductiveConstructor{∈bFx₁} \AgdaFunction{∘} \AgdaInductiveConstructor{∈bFR} \AgdaFunction{∘} \AgdaInductiveConstructor{∈bFinj₂} \AgdaFunction{∘} \AgdaInductiveConstructor{∈bFinj₂} \AgdaFunction{∘} \AgdaInductiveConstructor{∈bFB}\AgdaSymbol{))}\<%
\\
\>[11]\AgdaIndent{17}{}\<[17]%
\>[17]\AgdaSymbol{(}\AgdaFunction{lemma-⇉SubstN} \AgdaSymbol{(}\AgdaFunction{listNotOccurBx₂inv} \AgdaSymbol{(}\AgdaFunction{listNotOccurBinj₁inv} \AgdaSymbol{(}\AgdaFunction{listNotOccurBinj₂inv} \AgdaSymbol{(}\AgdaFunction{lemmalistNotOccurBindFR→ListNotOccurBindF} \AgdaBound{nb}\AgdaSymbol{))))} \AgdaBound{P⇉P'} \AgdaBound{N⇉N'} \AgdaSymbol{(}\AgdaBound{f} \AgdaFunction{∘} \AgdaInductiveConstructor{∈bFR} \AgdaFunction{∘} \AgdaInductiveConstructor{∈bFinj₂} \AgdaFunction{∘} \AgdaInductiveConstructor{∈bFinj₁} \AgdaFunction{∘} \<[189]%
\>[189]\AgdaInductiveConstructor{∈bFx₂}\AgdaSymbol{)))}\<%
\\
\>\AgdaFunction{lemma-⇉SubstN} \AgdaSymbol{\{}\AgdaBound{x}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaInductiveConstructor{⟨} \AgdaInductiveConstructor{inj₂} \AgdaSymbol{(}\AgdaInductiveConstructor{inj₂} \AgdaSymbol{(}\AgdaBound{y} \AgdaInductiveConstructor{,} \AgdaBound{M}\AgdaSymbol{))} \AgdaInductiveConstructor{⟩}\AgdaSymbol{\}} \<[46]%
\>[46]\AgdaBound{nb} \AgdaSymbol{(}\AgdaInductiveConstructor{⇉nƛ} \AgdaBound{M⇉M'}\AgdaSymbol{)} \<[66]%
\>[66]\AgdaBound{N⇉N'} \AgdaBound{f}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{=} \AgdaInductiveConstructor{⇉nƛ} \AgdaSymbol{(}\AgdaFunction{lemma-⇉SubstN} \AgdaSymbol{(}\AgdaFunction{listNotOccurBBinv} \AgdaSymbol{(}\AgdaFunction{listNotOccurBinj₂inv} \AgdaSymbol{(}\AgdaFunction{listNotOccurBinj₂inv} \AgdaSymbol{(}\AgdaFunction{lemmalistNotOccurBindFR→ListNotOccurBindF} \AgdaBound{nb}\AgdaSymbol{))))} \AgdaBound{M⇉M'} \AgdaBound{N⇉N'} \AgdaSymbol{(}\AgdaBound{f} \AgdaFunction{∘} \AgdaInductiveConstructor{∈bFR} \AgdaFunction{∘} \AgdaInductiveConstructor{∈bFinj₂} \AgdaFunction{∘} \AgdaInductiveConstructor{∈bFinj₂} \AgdaFunction{∘} \AgdaInductiveConstructor{∈bFB}\AgdaSymbol{))}\<%
\\
%
\\
\>\AgdaFunction{\_*} \AgdaSymbol{:} \AgdaFunction{λTerm} \AgdaSymbol{→} \AgdaFunction{λTerm}\<%
\\
\>\AgdaInductiveConstructor{⟨} \AgdaInductiveConstructor{inj₁} \AgdaBound{x} \<[46]%
\>[46]\AgdaInductiveConstructor{⟩} \AgdaFunction{*} \<[51]%
\>[51]\AgdaSymbol{=} \AgdaFunction{v} \AgdaBound{x}\<%
\\
\>\AgdaInductiveConstructor{⟨} \AgdaInductiveConstructor{inj₂} \AgdaSymbol{(}\AgdaInductiveConstructor{inj₁} \AgdaSymbol{(}\AgdaInductiveConstructor{⟨} \AgdaInductiveConstructor{inj₁} \AgdaBound{x} \<[37]%
\>[37]\AgdaInductiveConstructor{⟩} \AgdaInductiveConstructor{,} \AgdaBound{N}\AgdaSymbol{))} \<[46]%
\>[46]\AgdaInductiveConstructor{⟩} \AgdaFunction{*} \<[51]%
\>[51]\AgdaSymbol{=} \AgdaFunction{v} \AgdaBound{x} \<[81]%
\>[81]\AgdaFunction{·} \AgdaBound{N} \AgdaFunction{*}\<%
\\
\>\AgdaInductiveConstructor{⟨} \AgdaInductiveConstructor{inj₂} \AgdaSymbol{(}\AgdaInductiveConstructor{inj₁} \AgdaSymbol{(}\AgdaInductiveConstructor{⟨} \AgdaInductiveConstructor{inj₂} \AgdaSymbol{(}\AgdaInductiveConstructor{inj₁} \AgdaSymbol{(}\AgdaBound{M} \AgdaInductiveConstructor{,} \AgdaBound{M′}\AgdaSymbol{))} \AgdaInductiveConstructor{⟩} \AgdaInductiveConstructor{,} \AgdaBound{N}\AgdaSymbol{))} \<[46]%
\>[46]\AgdaInductiveConstructor{⟩} \AgdaFunction{*} \<[51]%
\>[51]\AgdaSymbol{=} \AgdaInductiveConstructor{⟨} \AgdaInductiveConstructor{inj₂} \AgdaSymbol{(}\AgdaInductiveConstructor{inj₁} \AgdaSymbol{(}\AgdaBound{M} \AgdaInductiveConstructor{,} \AgdaBound{M′}\AgdaSymbol{))} \AgdaInductiveConstructor{⟩} \AgdaFunction{*} \<[81]%
\>[81]\AgdaFunction{·} \AgdaBound{N} \AgdaFunction{*}\<%
\\
\>\AgdaInductiveConstructor{⟨} \AgdaInductiveConstructor{inj₂} \AgdaSymbol{(}\AgdaInductiveConstructor{inj₁} \AgdaSymbol{(}\AgdaInductiveConstructor{⟨} \AgdaInductiveConstructor{inj₂} \AgdaSymbol{(}\AgdaInductiveConstructor{inj₂} \AgdaSymbol{(}\AgdaBound{x} \AgdaInductiveConstructor{,} \AgdaBound{M} \AgdaSymbol{))} \AgdaInductiveConstructor{⟩} \AgdaInductiveConstructor{,} \AgdaBound{N}\AgdaSymbol{))} \<[46]%
\>[46]\AgdaInductiveConstructor{⟩} \AgdaFunction{*} \<[51]%
\>[51]\AgdaSymbol{=} \AgdaSymbol{(}\AgdaBound{M} \AgdaFunction{*}\AgdaSymbol{)} \AgdaFunction{[} \AgdaBound{x} \AgdaFunction{≔} \AgdaBound{N} \AgdaFunction{*} \AgdaFunction{]ₙ}\<%
\\
\>\AgdaInductiveConstructor{⟨} \AgdaInductiveConstructor{inj₂} \AgdaSymbol{(}\AgdaInductiveConstructor{inj₂} \AgdaSymbol{(}\AgdaBound{x} \AgdaInductiveConstructor{,} \AgdaBound{M}\AgdaSymbol{))} \<[46]%
\>[46]\AgdaInductiveConstructor{⟩} \AgdaFunction{*} \<[51]%
\>[51]\AgdaSymbol{=} \AgdaFunction{ƛ} \AgdaBound{x} \AgdaSymbol{(}\AgdaBound{M} \AgdaFunction{*}\AgdaSymbol{)}\<%
\\
%
\\
\>\AgdaFunction{lemmaBindersβbinder} \<[21]%
\>[21]\AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{M} \AgdaBound{N} \AgdaSymbol{:} \AgdaFunction{λTerm}\AgdaSymbol{\}\{}\AgdaBound{y} \AgdaSymbol{:} \AgdaFunction{V}\AgdaSymbol{\}}\<%
\\
\>[2]\AgdaIndent{7}{}\<[7]%
\>[7]\AgdaSymbol{→} \AgdaFunction{BVCC} \AgdaSymbol{(}\AgdaFunction{ƛ} \AgdaBound{y} \AgdaBound{M} \AgdaFunction{·} \AgdaBound{N}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaBound{y} \AgdaFunction{notOccurBind} \AgdaBound{M}\<%
\\
\>\AgdaFunction{lemmaBindersβbinder} \AgdaBound{f} \AgdaKeyword{with} \AgdaBound{f} \AgdaSymbol{(}\AgdaInductiveConstructor{∈bFR} \AgdaSymbol{(}\AgdaInductiveConstructor{∈bFinj₂} \AgdaSymbol{(}\AgdaInductiveConstructor{∈bFinj₁} \AgdaSymbol{(}\AgdaInductiveConstructor{∈bFx₁} \AgdaSymbol{(}\AgdaInductiveConstructor{∈bFR} \AgdaSymbol{(}\AgdaInductiveConstructor{∈bFinj₂} \AgdaSymbol{(}\AgdaInductiveConstructor{∈bFinj₂} \AgdaInductiveConstructor{∈bFB≡}\AgdaSymbol{)))))))}\<%
\\
\>\AgdaFunction{lemmaBindersβbinder} \AgdaBound{f} \AgdaSymbol{|} \AgdaInductiveConstructor{notOccurBExceptR} \AgdaSymbol{(}\AgdaInductiveConstructor{notOccurBExceptinj₂} \AgdaSymbol{(}\AgdaInductiveConstructor{notOccurBExceptinj₁} \AgdaSymbol{(}\AgdaInductiveConstructor{notOccurBExceptx₁} \AgdaSymbol{(}\AgdaInductiveConstructor{notOccurBExceptR} \AgdaSymbol{(}\AgdaInductiveConstructor{notOccurBExceptinj₂} \AgdaSymbol{(}\AgdaInductiveConstructor{notOccurBExceptinj₂} \AgdaSymbol{(}\AgdaInductiveConstructor{notOccurBExceptB≡} \AgdaBound{y∉bM}\AgdaSymbol{))))} \AgdaSymbol{\_)))} \AgdaSymbol{=} \AgdaBound{y∉bM}\<%
\\
%
\\
\>\AgdaFunction{lemmaBindersβ} \<[15]%
\>[15]\AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{M} \AgdaBound{N} \AgdaSymbol{:} \AgdaFunction{λTerm}\AgdaSymbol{\}\{}\AgdaBound{y} \AgdaSymbol{:} \AgdaFunction{V}\AgdaSymbol{\}}\<%
\\
\>[2]\AgdaIndent{7}{}\<[7]%
\>[7]\AgdaSymbol{→} \AgdaFunction{BVCC} \AgdaSymbol{(}\AgdaFunction{ƛ} \AgdaBound{y} \AgdaBound{M} \AgdaFunction{·} \AgdaBound{N}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{\{}\AgdaBound{x} \AgdaSymbol{:} \AgdaFunction{V}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaBound{x} \AgdaFunction{∈b} \AgdaBound{M} \AgdaSymbol{→} \AgdaBound{x} \AgdaFunction{notOccurBind} \AgdaBound{N}\<%
\\
\>\AgdaFunction{lemmaBindersβ} \AgdaBound{f} \AgdaBound{x∈} \AgdaKeyword{with} \AgdaBound{f} \AgdaSymbol{(}\AgdaInductiveConstructor{∈bFR} \AgdaSymbol{(}\AgdaInductiveConstructor{∈bFinj₂} \AgdaSymbol{(}\AgdaInductiveConstructor{∈bFinj₁} \AgdaSymbol{(}\AgdaInductiveConstructor{∈bFx₁} \AgdaSymbol{(}\AgdaInductiveConstructor{∈bFR} \AgdaSymbol{(}\AgdaInductiveConstructor{∈bFinj₂} \AgdaSymbol{(}\AgdaInductiveConstructor{∈bFinj₂} \AgdaSymbol{(}\AgdaInductiveConstructor{∈bFB} \AgdaBound{x∈}\AgdaSymbol{))))))))}\<%
\\
\>\AgdaFunction{lemmaBindersβ} \AgdaBound{f} \AgdaBound{x∈} \AgdaSymbol{|} \AgdaInductiveConstructor{notOccurBExceptR} \AgdaSymbol{(}\AgdaInductiveConstructor{notOccurBExceptinj₂} \AgdaSymbol{(}\AgdaInductiveConstructor{notOccurBExceptinj₁} \AgdaSymbol{(}\AgdaInductiveConstructor{notOccurBExceptx₁} \AgdaBound{nbe} \AgdaBound{xnotOccurBindM}\AgdaSymbol{)))} \AgdaSymbol{=} \AgdaBound{xnotOccurBindM} \<[138]%
\>[138]\<%
\\
%
\\
\>\AgdaFunction{lemmaBinders⇉β} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{M} \AgdaBound{N} \AgdaBound{M'} \AgdaBound{N'} \AgdaSymbol{:} \AgdaFunction{λTerm}\AgdaSymbol{\}\{}\AgdaBound{y} \AgdaSymbol{:} \AgdaFunction{V}\AgdaSymbol{\}}\<%
\\
\>[2]\AgdaIndent{7}{}\<[7]%
\>[7]\AgdaSymbol{→} \AgdaFunction{BVCC} \AgdaSymbol{(}\AgdaFunction{ƛ} \AgdaBound{y} \AgdaBound{M} \AgdaFunction{·} \AgdaBound{N}\AgdaSymbol{)}\<%
\\
\>[2]\AgdaIndent{7}{}\<[7]%
\>[7]\AgdaSymbol{→} \AgdaBound{M} \AgdaDatatype{⇉n} \AgdaBound{M'} \AgdaSymbol{→} \AgdaBound{N} \AgdaDatatype{⇉n} \AgdaBound{N'}\<%
\\
\>[2]\AgdaIndent{7}{}\<[7]%
\>[7]\AgdaSymbol{→} \AgdaSymbol{\{}\AgdaBound{x} \AgdaSymbol{:} \AgdaFunction{V}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaBound{x} \AgdaFunction{∈b} \AgdaBound{M'} \AgdaSymbol{→} \AgdaBound{x} \AgdaFunction{notOccurBind} \AgdaBound{N'}\<%
\\
\>\AgdaFunction{lemmaBinders⇉β} \AgdaBound{f} \AgdaBound{M⇉M'} \AgdaBound{N⇉N'} \AgdaBound{x∈bM'} \AgdaSymbol{=} \<[36]%
\>[36]\AgdaPostulate{lemma⇉nNotBinders} \AgdaSymbol{(}\AgdaFunction{lemmaBindersβ} \AgdaBound{f} \AgdaSymbol{(}\AgdaPostulate{lemma⇉nBinders} \AgdaBound{x∈bM'} \AgdaBound{M⇉M'}\AgdaSymbol{))} \AgdaBound{N⇉N'}\<%
\\
%
\\
\>\AgdaKeyword{postulate} \<[10]%
\>[10]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaPostulate{lemma-⇉nFree} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{M} \AgdaBound{N} \AgdaSymbol{:} \AgdaFunction{λTerm}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaBound{M} \AgdaDatatype{⇉n} \AgdaBound{N} \AgdaSymbol{→} \AgdaFunction{fv} \AgdaBound{N} \AgdaFunction{⊆l} \AgdaFunction{fv} \AgdaBound{M}\<%
\\
\>\AgdaComment{-- lemma-⇉nFree = \{!!\}}\<%
\\
%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaPostulate{lemma-⇉nFree*} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{M} \AgdaSymbol{:} \AgdaFunction{λTerm}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaFunction{fv} \AgdaSymbol{(}\AgdaBound{M} \AgdaFunction{*}\AgdaSymbol{)} \AgdaFunction{⊆l} \AgdaFunction{fv} \AgdaBound{M}\<%
\\
\>\AgdaComment{-- lemma-⇉nFree* = \{!!\}}\<%
\\
%
\\
\>\AgdaKeyword{postulate}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaPostulate{lemma*} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{M} \AgdaBound{N} \AgdaSymbol{:} \AgdaFunction{λTerm}\AgdaSymbol{\}}\<%
\\
\>[2]\AgdaIndent{7}{}\<[7]%
\>[7]\AgdaSymbol{→} \AgdaFunction{BVCN} \AgdaBound{M}\<%
\\
\>[2]\AgdaIndent{7}{}\<[7]%
\>[7]\AgdaSymbol{→} \AgdaBound{M} \AgdaDatatype{⇉n} \AgdaBound{N} \AgdaSymbol{→} \AgdaBound{N} \AgdaDatatype{⇉n} \AgdaBound{M} \AgdaFunction{*}\<%
\\
\>\AgdaComment{-- lemma*  \_          ⇉nv                      = ⇉nv}\<%
\\
\>\AgdaComment{-- lemma*  (nb , b≢)  (⇉nƛ M⇉N)                = ⇉nƛ  (lemma* (\{!listNotOccurBBinv (listNotOccurBinj₂inv (listNotOccurBinj₂inv (lemmalistNotOccurBindFR→ListNotOccurBindF nb)))!\}  , \{!!\}) M⇉N)}\<%
\\
\>\AgdaComment{-- lemma*  \{⟨ inj₂ (inj₁ (⟨ inj₁ x ⟩ , N)) ⟩\}}\<%
\\
\>\AgdaComment{--         (nb , b≢)  (⇉n· M⇉M' N⇉N')          = ⇉n·  (lemma* (\{!!\} , (λ \{(∈bFR (∈bFinj₁ ()))\})) M⇉M')}\<%
\\
\>\AgdaComment{--                                                    (lemma* (\{!!\} , \{!!\}) N⇉N')}\<%
\\
\>\AgdaComment{-- lemma*  \{⟨ inj₂ (inj₁ (⟨ inj₂ (inj₁ (M , P)) ⟩ , N)) ⟩\}}\<%
\\
\>\AgdaComment{--         (nb , b≢)  (⇉n· M⇉M' N⇉N')          = ⇉n·  (lemma* (\{!!\} , \{!!\}) M⇉M') }\<%
\\
\>\AgdaComment{--                                                    (lemma* (\{!!\} , \{!!\}) N⇉N')}\<%
\\
\>\AgdaComment{-- lemma*  \{⟨ inj₂ (inj₁ (⟨ inj₂ (inj₂ (x , M)) ⟩ , N)) ⟩\}}\<%
\\
\>\AgdaComment{--         (nb , b≢)  (⇉n· (⇉nƛ M⇉M') N⇉N')    = ⇉nβ  (lemma* (\{!!\} , \{!!\}) M⇉M') }\<%
\\
\>\AgdaComment{--                                                    (lemma* (\{!!\} , \{!!\}) N⇉N')   }\<%
\\
\>\AgdaComment{-- lemma*  (nb , b≢)  (⇉nβ \{M = M\} \{N = N\}\{x = y\} M⇉M' N⇉N')  }\<%
\\
\>\AgdaComment{--   = lemma-⇉SubstN  (lemma-binds:cons (lemma⇉nNotBinders (lemmaBindersβbinder b≢) M⇉M') (lemma-binds⊆ (lemma-⇉nFree* \{N\}) (lemma⇉nListNotBinders (listNotOccurBBinv (listNotOccurBinj₂inv (listNotOccurBinj₂inv  (lemmalistNotOccurBindFR→ListNotOccurBindF  (listNotOccurBx₁inv (listNotOccurBinj₁inv (listNotOccurBinj₂inv (lemmalistNotOccurBindFR→ListNotOccurBindF (lemma-binds++r \{xs = fv (ƛ y M)\} nb))))))))) M⇉M')))}\<%
\\
\>\AgdaComment{--                    (lemma* (\{!!\} , \{!!\}) M⇉M')}\<%
\\
\>\AgdaComment{--                    (lemma* (\{!!\} , \{!!\}) N⇉N')}\<%
\\
\>\AgdaComment{--                    (lemmaBinders⇉β b≢ M⇉M' N⇉N') }\<%
\\
%
\\
\>\AgdaFunction{diamBVC⇉n} \AgdaSymbol{:} \<[13]%
\>[13]\AgdaSymbol{\{}\AgdaBound{M} \AgdaBound{N} \AgdaBound{P} \AgdaSymbol{:} \AgdaFunction{λTerm}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaFunction{BVCN} \AgdaBound{M} \<[38]%
\>[38]\<%
\\
\>[7]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{→} \AgdaBound{M} \AgdaDatatype{⇉n} \AgdaBound{N} \AgdaSymbol{→} \AgdaBound{M} \AgdaDatatype{⇉n} \AgdaBound{P} \AgdaSymbol{→} \AgdaFunction{∃} \AgdaSymbol{(λ} \AgdaBound{R} \AgdaSymbol{→} \AgdaBound{N} \AgdaDatatype{⇉n} \AgdaBound{R} \AgdaFunction{×} \AgdaBound{P} \AgdaDatatype{⇉n} \AgdaBound{R}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{diamBVC⇉n} \AgdaSymbol{\{}\AgdaBound{M}\AgdaSymbol{\}} \AgdaBound{bvc} \AgdaBound{M⇉N} \AgdaBound{M⇉P} \AgdaSymbol{=} \AgdaBound{M} \AgdaFunction{*} \AgdaInductiveConstructor{,} \AgdaPostulate{lemma*} \AgdaBound{bvc} \AgdaBound{M⇉N} \AgdaInductiveConstructor{,} \AgdaPostulate{lemma*} \AgdaBound{bvc} \AgdaBound{M⇉P}\<%
\end{code}

\begin{code}%
\>\AgdaFunction{bvcTerm} \AgdaSymbol{:} \AgdaFunction{λTerm} \AgdaSymbol{→} \AgdaFunction{λTerm}\<%
\\
\>\AgdaFunction{bvcTerm} \AgdaSymbol{=} \AgdaFunction{bindersFreeα} \AgdaInductiveConstructor{[]}\<%
\\
%
\\
\>\AgdaFunction{lemma-bvcTermα} \AgdaSymbol{:} \AgdaSymbol{(}\AgdaBound{M} \AgdaSymbol{:} \AgdaFunction{λTerm}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaFunction{bvcTerm} \AgdaBound{M} \AgdaFunction{∼α} \AgdaBound{M}\<%
\\
\>\AgdaFunction{lemma-bvcTermα} \AgdaBound{M} \AgdaSymbol{=} \AgdaFunction{lemma-bindersFreeα-α} \AgdaInductiveConstructor{[]} \AgdaBound{M}\<%
\\
%
\\
\>\AgdaFunction{lemmaBVC-bvcTerm} \AgdaSymbol{:} \AgdaSymbol{(}\AgdaBound{M} \AgdaSymbol{:} \AgdaFunction{λTerm}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaFunction{BVC} \AgdaSymbol{(}\AgdaFunction{bvcTerm} \AgdaBound{M}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{lemmaBVC-bvcTerm} \<[18]%
\>[18]\AgdaBound{M} \AgdaSymbol{=} \AgdaFunction{lemma-bindersFreeα-FV∉b} \AgdaInductiveConstructor{[]} \AgdaBound{M}\<%
\\
%
\\
\>\AgdaFunction{lemmaBVCC-bvcTerm} \AgdaSymbol{:} \AgdaSymbol{(}\AgdaBound{M} \AgdaSymbol{:} \AgdaFunction{λTerm}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaFunction{BVCC} \AgdaSymbol{(}\AgdaFunction{bvcTerm} \AgdaBound{M}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{lemmaBVCC-bvcTerm} \AgdaBound{M} \AgdaSymbol{=} \AgdaPostulate{lemma-bindersFreeα-BindersAll≢} \AgdaInductiveConstructor{[]} \AgdaBound{M}\<%
\\
%
\\
\>\AgdaFunction{lemmasBVCN} \AgdaSymbol{:} \AgdaSymbol{(}\AgdaBound{M} \AgdaSymbol{:} \AgdaFunction{λTerm}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaFunction{BVCN} \AgdaSymbol{(}\AgdaFunction{bvcTerm} \AgdaBound{M}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{lemmasBVCN} \AgdaBound{M} \AgdaSymbol{=} \AgdaSymbol{(}\AgdaFunction{lemmaBVC-bvcTerm} \AgdaBound{M}\AgdaSymbol{)} \AgdaInductiveConstructor{,} \AgdaSymbol{(}\AgdaFunction{lemmaBVCC-bvcTerm} \AgdaBound{M}\AgdaSymbol{)} \<[60]%
\>[60]\<%
\\
%
\\
\>\AgdaKeyword{postulate} \<[10]%
\>[10]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaPostulate{lemma-⇉nleftα} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{M} \AgdaBound{M'} \AgdaBound{N} \AgdaSymbol{:} \AgdaFunction{λTerm}\AgdaSymbol{\}}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaSymbol{→} \AgdaFunction{BVCN} \AgdaBound{M} \AgdaSymbol{→} \AgdaFunction{BVCN} \AgdaBound{M'} \<[23]%
\>[23]\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaSymbol{→} \AgdaBound{M'} \AgdaFunction{∼α} \AgdaBound{M}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaSymbol{→} \AgdaBound{M} \AgdaDatatype{⇉n} \AgdaBound{N} \AgdaSymbol{→} \AgdaFunction{∃} \AgdaSymbol{(λ} \AgdaBound{N'} \AgdaSymbol{→} \AgdaBound{M'} \AgdaDatatype{⇉n} \AgdaBound{N'} \AgdaFunction{×} \AgdaBound{N'} \AgdaFunction{∼α} \AgdaBound{N}\AgdaSymbol{)}\<%
\\
\>\AgdaComment{-- lemma-⇉nleftα  BVCNM BVCM' }\<%
\\
\>\AgdaComment{--                (∼αR (∼α+₁ (∼αV \{x\})))                            }\<%
\\
\>\AgdaComment{--                ⇉nv }\<%
\\
\>\AgdaComment{--   = v x , ⇉nv , ∼αR (∼α+₁ ∼αV)}\<%
\\
\>\AgdaComment{-- lemma-⇉nleftα  BVCNM BVCM' }\<%
\\
\>\AgdaComment{--                (∼αR (∼α+₂ (∼α+₂ \{e = y , N\} \{x , M\} (∼αB xs f))))  }\<%
\\
\>\AgdaComment{--                (⇉nƛ M⇉nM') }\<%
\\
\>\AgdaComment{--   with lemma∼Bswap \{S = SortλTermVars\} \{y\} \{x\} \{N\} \{M\} (∼αB xs f)}\<%
\\
\>\AgdaComment{-- ... | （yx）N∼M}\<%
\\
\>\AgdaComment{--   with lemma-⇉nleftα \{!!\} \{!!\} （yx）N∼M  M⇉nM'}\<%
\\
\>\AgdaComment{-- ... | N' , （yx）N⇉nN' , N'∼N }\<%
\\
\>\AgdaComment{--   = \{! （yx）M'∼M!\}}\<%
\\
\>\AgdaComment{-- lemma-⇉nleftα BVCNM BVCM' M'∼M (⇉n· M⇉nN M⇉nN₁) = \{!!\}}\<%
\\
\>\AgdaComment{-- lemma-⇉nleftα BVCNM BVCM' M'∼M (⇉nβ M⇉nN M⇉nN₁) = \{!!\}}\<%
\end{code}


-- Another approach

\begin{code}%
\>\AgdaKeyword{infix} \AgdaNumber{7} \AgdaFunction{\_⇉\_}\<%
\\
%
\\
\>\AgdaFunction{\_⇉\_} \AgdaSymbol{:} \AgdaFunction{Rel}\<%
\\
\>\AgdaBound{M} \AgdaFunction{⇉} \AgdaBound{N} \AgdaSymbol{=} \AgdaFunction{∃} \AgdaSymbol{(λ} \AgdaBound{M'} \AgdaSymbol{→} \AgdaBound{M} \AgdaFunction{∼α} \AgdaBound{M'} \AgdaFunction{×} \AgdaFunction{BVCN} \AgdaBound{M'} \AgdaFunction{×} \AgdaFunction{∃} \AgdaSymbol{(λ} \AgdaBound{N'} \AgdaSymbol{→} \AgdaBound{N'} \AgdaFunction{∼α} \AgdaBound{N} \AgdaFunction{×} \AgdaBound{M'} \AgdaDatatype{⇉n} \AgdaBound{N'}\AgdaSymbol{))}\<%
\end{code}

\begin{code}%
\>\AgdaFunction{lemma-⇉rightα} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{M} \AgdaBound{N} \AgdaBound{P} \AgdaSymbol{:} \AgdaFunction{λTerm}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaBound{M} \AgdaFunction{⇉} \AgdaBound{N} \AgdaSymbol{→} \AgdaBound{N} \AgdaFunction{∼α} \AgdaBound{P} \AgdaSymbol{→} \AgdaBound{M} \AgdaFunction{⇉} \AgdaBound{P}\<%
\\
\>\AgdaFunction{lemma-⇉rightα} \<[15]%
\>[15]\AgdaSymbol{(}\AgdaBound{M'} \AgdaInductiveConstructor{,} \AgdaBound{M∼M'} \AgdaInductiveConstructor{,} \AgdaBound{BVCM'} \AgdaInductiveConstructor{,} \AgdaBound{N'} \AgdaInductiveConstructor{,} \AgdaBound{N'∼N} \AgdaInductiveConstructor{,} \AgdaBound{M'⇉N'}\AgdaSymbol{)} \AgdaBound{N∼P} \<[59]%
\>[59]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{=} \AgdaBound{M'} \AgdaInductiveConstructor{,} \AgdaBound{M∼M'} \AgdaInductiveConstructor{,} \AgdaBound{BVCM'} \AgdaInductiveConstructor{,} \AgdaBound{N'} \AgdaInductiveConstructor{,} \AgdaFunction{τ} \AgdaBound{N'∼N} \AgdaBound{N∼P} \AgdaInductiveConstructor{,} \AgdaBound{M'⇉N'}\<%
\\
%
\\
\>\AgdaFunction{lemma-⇉leftα} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{M} \AgdaBound{N} \AgdaBound{P} \AgdaSymbol{:} \AgdaFunction{λTerm}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaBound{P} \AgdaFunction{∼α} \AgdaBound{M} \AgdaSymbol{→} \AgdaBound{M} \AgdaFunction{⇉} \AgdaBound{N} \AgdaSymbol{→} \AgdaBound{P} \AgdaFunction{⇉} \AgdaBound{N}\<%
\\
\>\AgdaFunction{lemma-⇉leftα} \AgdaBound{P∼M} \AgdaSymbol{(}\AgdaBound{M'} \AgdaInductiveConstructor{,} \AgdaBound{M∼M'} \AgdaInductiveConstructor{,} \AgdaBound{BVCM'} \AgdaInductiveConstructor{,} \AgdaBound{N'} \AgdaInductiveConstructor{,} \AgdaBound{N'∼N} \AgdaInductiveConstructor{,} \AgdaBound{M'⇉N'}\AgdaSymbol{)} \<[57]%
\>[57]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{=} \AgdaBound{M'} \AgdaInductiveConstructor{,} \AgdaFunction{τ} \AgdaBound{P∼M} \AgdaBound{M∼M'} \AgdaInductiveConstructor{,} \AgdaBound{BVCM'} \AgdaInductiveConstructor{,} \AgdaBound{N'} \AgdaInductiveConstructor{,} \AgdaBound{N'∼N} \AgdaInductiveConstructor{,} \AgdaBound{M'⇉N'} \<[48]%
\>[48]\<%
\\
%
\\
\>\AgdaFunction{ρ⇉n} \AgdaSymbol{:} \AgdaFunction{Reflexive} \AgdaSymbol{(}\AgdaDatatype{\_⇉n\_}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{ρ⇉n} \AgdaSymbol{\{}\AgdaInductiveConstructor{⟨} \AgdaInductiveConstructor{inj₁} \AgdaBound{x} \AgdaInductiveConstructor{⟩}\AgdaSymbol{\}} \<[31]%
\>[31]\AgdaSymbol{=} \AgdaInductiveConstructor{⇉nv}\<%
\\
\>\AgdaFunction{ρ⇉n} \AgdaSymbol{\{}\AgdaInductiveConstructor{⟨} \AgdaInductiveConstructor{inj₂} \AgdaSymbol{(}\AgdaInductiveConstructor{inj₁} \AgdaSymbol{(}\AgdaBound{M} \AgdaInductiveConstructor{,} \AgdaBound{N}\AgdaSymbol{))} \AgdaInductiveConstructor{⟩}\AgdaSymbol{\}} \<[31]%
\>[31]\AgdaSymbol{=} \AgdaInductiveConstructor{⇉n·} \AgdaFunction{ρ⇉n} \AgdaFunction{ρ⇉n}\<%
\\
\>\AgdaFunction{ρ⇉n} \AgdaSymbol{\{}\AgdaInductiveConstructor{⟨} \AgdaInductiveConstructor{inj₂} \AgdaSymbol{(}\AgdaInductiveConstructor{inj₂} \AgdaSymbol{(}\AgdaBound{x} \AgdaInductiveConstructor{,} \AgdaBound{M}\AgdaSymbol{))} \AgdaInductiveConstructor{⟩}\AgdaSymbol{\}} \<[31]%
\>[31]\AgdaSymbol{=} \AgdaInductiveConstructor{⇉nƛ} \AgdaFunction{ρ⇉n}\<%
\\
%
\\
\>\AgdaFunction{ρ⇉} \AgdaSymbol{:} \AgdaFunction{Reflexive} \AgdaSymbol{(}\AgdaFunction{\_⇉\_}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{ρ⇉} \AgdaSymbol{\{}\AgdaBound{M}\AgdaSymbol{\}} \AgdaSymbol{=} \AgdaFunction{M'} \AgdaInductiveConstructor{,} \AgdaFunction{σ} \AgdaFunction{M'∼M} \AgdaInductiveConstructor{,} \AgdaFunction{BVCNM'} \AgdaInductiveConstructor{,} \AgdaFunction{M'} \AgdaInductiveConstructor{,} \AgdaFunction{M'∼M} \AgdaInductiveConstructor{,} \AgdaFunction{ρ⇉n} \<[48]%
\>[48]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaKeyword{where}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{M'} \AgdaSymbol{=} \AgdaFunction{bvcTerm} \AgdaBound{M}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{M'∼M} \AgdaSymbol{=} \AgdaFunction{lemma-bvcTermα} \AgdaBound{M}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{BVCNM'} \AgdaSymbol{=} \AgdaFunction{lemmasBVCN} \AgdaBound{M}\<%
\\
%
\\
\>\AgdaFunction{diam⇉} \AgdaSymbol{:} \AgdaFunction{diamond} \AgdaSymbol{(}\AgdaFunction{\_⇉\_}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{diam⇉} \<[7]%
\>[7]\AgdaSymbol{\{}\AgdaBound{M}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{N}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{P}\AgdaSymbol{\}} \<[19]%
\>[19]\<%
\\
\>[2]\AgdaIndent{7}{}\<[7]%
\>[7]\AgdaSymbol{(}\AgdaBound{M'} \AgdaInductiveConstructor{,} \<[14]%
\>[14]\AgdaBound{M∼M'} \<[21]%
\>[21]\AgdaInductiveConstructor{,} \AgdaBound{BVCM'} \<[31]%
\>[31]\AgdaInductiveConstructor{,} \AgdaBound{N'} \AgdaInductiveConstructor{,} \AgdaBound{N'∼N} \AgdaInductiveConstructor{,} \AgdaBound{M'⇉nN'}\AgdaSymbol{)}\<%
\\
\>[2]\AgdaIndent{7}{}\<[7]%
\>[7]\AgdaSymbol{(}\AgdaBound{M''} \AgdaInductiveConstructor{,} \AgdaBound{M∼M''} \<[21]%
\>[21]\AgdaInductiveConstructor{,} \AgdaBound{BVCM''} \<[31]%
\>[31]\AgdaInductiveConstructor{,} \AgdaBound{P'} \AgdaInductiveConstructor{,} \AgdaBound{P'∼P} \AgdaInductiveConstructor{,} \AgdaBound{M''⇉nP'}\AgdaSymbol{)} \<[54]%
\>[54]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaKeyword{with} \AgdaPostulate{lemma-⇉nleftα} \AgdaBound{BVCM''} \AgdaBound{BVCM'} \AgdaSymbol{(}\AgdaFunction{τ} \AgdaSymbol{(}\AgdaFunction{σ} \AgdaBound{M∼M'}\AgdaSymbol{)} \AgdaBound{M∼M''}\AgdaSymbol{)} \AgdaBound{M''⇉nP'} \<[62]%
\>[62]\<%
\\
\>\AgdaSymbol{...} \AgdaSymbol{|} \AgdaBound{P''} \AgdaInductiveConstructor{,} \AgdaBound{M'⇉nP''} \AgdaInductiveConstructor{,} \AgdaBound{P''∼P'} \<[33]%
\>[33]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaKeyword{with} \AgdaFunction{diamBVC⇉n} \AgdaBound{BVCM'} \AgdaBound{M'⇉nN'} \AgdaBound{M'⇉nP''}\<%
\\
\>\AgdaSymbol{...} \AgdaSymbol{|} \AgdaBound{R} \AgdaInductiveConstructor{,} \AgdaBound{N'⇉nR} \AgdaInductiveConstructor{,} \AgdaBound{P''⇉nR}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{=} \<[5]%
\>[5]\AgdaBound{R} \<[80]%
\>[80]\AgdaInductiveConstructor{,} \<[82]%
\>[82]\<%
\\
\>[2]\AgdaIndent{5}{}\<[5]%
\>[5]\AgdaSymbol{(}\AgdaBound{N'} \<[11]%
\>[11]\AgdaInductiveConstructor{,} \AgdaFunction{σ} \AgdaBound{N'∼N} \<[32]%
\>[32]\AgdaInductiveConstructor{,} \AgdaPostulate{lemma⇉nBVCN} \AgdaBound{BVCM'} \AgdaBound{M'⇉nN'} \<[61]%
\>[61]\AgdaInductiveConstructor{,} \AgdaBound{R} \AgdaInductiveConstructor{,} \AgdaFunction{ρ} \AgdaInductiveConstructor{,} \AgdaBound{N'⇉nR} \AgdaSymbol{)} \<[80]%
\>[80]\AgdaInductiveConstructor{,} \<[83]%
\>[83]\<%
\\
\>[2]\AgdaIndent{5}{}\<[5]%
\>[5]\AgdaSymbol{(}\AgdaBound{P''} \<[11]%
\>[11]\AgdaInductiveConstructor{,} \AgdaFunction{σ} \AgdaSymbol{(}\AgdaFunction{τ} \AgdaBound{P''∼P'} \AgdaBound{P'∼P}\AgdaSymbol{)} \<[32]%
\>[32]\AgdaInductiveConstructor{,} \AgdaPostulate{lemma⇉nBVCN} \AgdaBound{BVCM'} \AgdaBound{M'⇉nP''} \<[61]%
\>[61]\AgdaInductiveConstructor{,} \AgdaBound{R} \AgdaInductiveConstructor{,} \AgdaFunction{ρ} \AgdaInductiveConstructor{,} \AgdaBound{P''⇉nR}\AgdaSymbol{)}\<%
\end{code}


Ctx can be done generically

\begin{code}%
\>\AgdaKeyword{data} \AgdaDatatype{ctx} \AgdaSymbol{(}\AgdaBound{r} \AgdaSymbol{:} \AgdaFunction{Rel}\AgdaSymbol{)} \AgdaSymbol{:} \AgdaFunction{Rel} \AgdaKeyword{where}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaInductiveConstructor{ctxinj} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{t} \AgdaBound{t'}\AgdaSymbol{\}} \<[26]%
\>[26]\AgdaSymbol{→} \AgdaBound{r} \AgdaBound{t} \AgdaBound{t'} \<[42]%
\>[42]\AgdaSymbol{→} \AgdaDatatype{ctx} \AgdaBound{r} \AgdaBound{t} \AgdaBound{t'}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaInductiveConstructor{ctx·l} \<[9]%
\>[9]\AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{t₁} \AgdaBound{t₁'} \AgdaBound{t₂}\AgdaSymbol{\}} \<[26]%
\>[26]\AgdaSymbol{→} \AgdaDatatype{ctx} \AgdaBound{r} \AgdaBound{t₁} \AgdaBound{t₁'} \<[42]%
\>[42]\AgdaSymbol{→} \AgdaDatatype{ctx} \AgdaBound{r} \AgdaSymbol{(}\AgdaBound{t₁} \AgdaFunction{·} \AgdaBound{t₂}\AgdaSymbol{)} \<[62]%
\>[62]\AgdaSymbol{(}\AgdaBound{t₁'} \AgdaFunction{·} \AgdaBound{t₂}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaInductiveConstructor{ctx·r} \<[9]%
\>[9]\AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{t₁} \AgdaBound{t₂} \AgdaBound{t₂'}\AgdaSymbol{\}} \<[26]%
\>[26]\AgdaSymbol{→} \AgdaDatatype{ctx} \AgdaBound{r} \AgdaBound{t₂} \AgdaBound{t₂'} \<[42]%
\>[42]\AgdaSymbol{→} \AgdaDatatype{ctx} \AgdaBound{r} \AgdaSymbol{(}\AgdaBound{t₁} \AgdaFunction{·} \AgdaBound{t₂}\AgdaSymbol{)} \<[62]%
\>[62]\AgdaSymbol{(}\AgdaBound{t₁} \AgdaFunction{·} \AgdaBound{t₂'}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaInductiveConstructor{ctxƛ} \<[9]%
\>[9]\AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{x} \AgdaBound{t₁} \AgdaBound{t₁'}\AgdaSymbol{\}} \<[26]%
\>[26]\AgdaSymbol{→} \AgdaDatatype{ctx} \AgdaBound{r} \AgdaBound{t₁} \AgdaBound{t₁'} \<[42]%
\>[42]\AgdaSymbol{→} \AgdaDatatype{ctx} \AgdaBound{r} \AgdaSymbol{(}\AgdaFunction{ƛ} \AgdaBound{x} \AgdaBound{t₁}\AgdaSymbol{)} \<[62]%
\>[62]\AgdaSymbol{(}\AgdaFunction{ƛ} \AgdaBound{x} \AgdaBound{t₁'}\AgdaSymbol{)}\<%
\\
%
\\
\>\AgdaKeyword{infix} \AgdaNumber{1} \AgdaDatatype{\_▹n\_} \<[13]%
\>[13]\<%
\\
\>\AgdaKeyword{data} \AgdaDatatype{\_▹n\_} \AgdaSymbol{:} \AgdaFunction{Rel} \AgdaKeyword{where}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaInductiveConstructor{▹βn} \<[7]%
\>[7]\AgdaSymbol{:} \<[10]%
\>[10]\AgdaSymbol{\{}\AgdaBound{M} \AgdaBound{N} \AgdaSymbol{:} \AgdaFunction{λTerm}\AgdaSymbol{\}\{}\AgdaBound{x} \AgdaSymbol{:} \AgdaFunction{V}\AgdaSymbol{\}}\<%
\\
\>[2]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaSymbol{→} \<[9]%
\>[9]\AgdaFunction{ƛ} \AgdaBound{x} \AgdaBound{M} \AgdaFunction{·} \AgdaBound{N} \AgdaDatatype{▹n} \AgdaBound{M} \AgdaFunction{[} \AgdaBound{x} \AgdaFunction{≔} \AgdaBound{N} \AgdaFunction{]ₙ}\<%
\\
%
\\
\>\AgdaKeyword{infix} \AgdaNumber{1} \AgdaDatatype{\_▹\_} \<[12]%
\>[12]\<%
\\
\>\AgdaKeyword{data} \AgdaDatatype{\_▹\_} \AgdaSymbol{:} \AgdaFunction{Rel} \AgdaKeyword{where}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaInductiveConstructor{▹β} \<[6]%
\>[6]\AgdaSymbol{:} \<[9]%
\>[9]\AgdaSymbol{\{}\AgdaBound{M} \AgdaBound{N} \AgdaSymbol{:} \AgdaFunction{λTerm}\AgdaSymbol{\}\{}\AgdaBound{x} \AgdaSymbol{:} \AgdaFunction{V}\AgdaSymbol{\}}\<%
\\
\>[2]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaSymbol{→} \<[9]%
\>[9]\AgdaFunction{ƛ} \AgdaBound{x} \AgdaBound{M} \AgdaFunction{·} \AgdaBound{N} \AgdaDatatype{▹} \AgdaBound{M} \AgdaFunction{[} \AgdaBound{x} \AgdaFunction{≔} \AgdaBound{N} \AgdaFunction{]}\<%
\\
%
\\
\>\AgdaKeyword{infix} \AgdaNumber{4} \AgdaFunction{\_→βn\_}\<%
\\
\>\AgdaFunction{\_→βn\_} \AgdaSymbol{:} \AgdaFunction{Rel}\<%
\\
\>\AgdaFunction{\_→βn\_} \AgdaSymbol{=} \AgdaDatatype{ctx} \AgdaDatatype{\_▹n\_}\<%
\\
%
\\
\>\AgdaFunction{BVCNRel} \AgdaSymbol{:} \AgdaFunction{Rel} \AgdaSymbol{→} \AgdaFunction{Rel}\<%
\\
\>\AgdaFunction{BVCNRel} \AgdaBound{R} \AgdaBound{M} \AgdaBound{N} \AgdaSymbol{=} \AgdaFunction{BVCN} \AgdaBound{M} \AgdaFunction{×} \AgdaBound{R} \AgdaBound{M} \AgdaBound{N}\<%
\\
%
\\
\>\AgdaComment{-- lemma▹n⊆▹ : BVCNRel \_▹n\_ ⊆ (\_▹\_ ∘ᵣ \_∼α\_)}\<%
\\
\>\AgdaComment{-- lemma▹n⊆▹ (BVCN , M▹nN) = \{!!\} }\<%
\\
%
\\
\>\AgdaKeyword{infix} \AgdaNumber{4} \AgdaFunction{\_→βn*\_}\<%
\\
\>\AgdaFunction{\_→βn*\_} \AgdaSymbol{:} \AgdaFunction{Rel}\<%
\\
\>\AgdaFunction{\_→βn*\_} \AgdaSymbol{=} \AgdaDatatype{star} \AgdaFunction{\_→βn\_}\<%
\\
%
\\
\>\AgdaKeyword{infix} \AgdaNumber{4} \AgdaFunction{\_→β\_}\<%
\\
\>\AgdaFunction{\_→β\_} \AgdaSymbol{:} \AgdaFunction{Rel}\<%
\\
\>\AgdaBound{M} \AgdaFunction{→β} \AgdaBound{N} \AgdaSymbol{=} \AgdaFunction{∃} \AgdaSymbol{(λ} \AgdaBound{M'} \AgdaSymbol{→} \AgdaBound{M} \AgdaFunction{∼α} \AgdaBound{M'} \AgdaFunction{×} \AgdaFunction{BVCN} \AgdaBound{M'} \AgdaFunction{×} \AgdaFunction{∃} \AgdaSymbol{(λ} \AgdaBound{N'} \AgdaSymbol{→} \AgdaBound{N'} \AgdaFunction{∼α} \AgdaBound{N} \AgdaFunction{×} \AgdaBound{M'} \AgdaFunction{→βn} \AgdaBound{N'}\AgdaSymbol{))} \<[71]%
\>[71]\<%
\\
%
\\
\>\AgdaComment{-- Real one}\<%
\\
\>\AgdaKeyword{infix} \AgdaNumber{4} \AgdaFunction{\_→βR\_}\<%
\\
\>\AgdaFunction{\_→βR\_} \AgdaSymbol{:} \AgdaFunction{Rel}\<%
\\
\>\AgdaBound{M} \AgdaFunction{→βR} \AgdaBound{N} \AgdaSymbol{=} \AgdaFunction{∃} \AgdaSymbol{(λ} \AgdaBound{M'} \AgdaSymbol{→} \AgdaBound{M} \AgdaFunction{∼α} \AgdaBound{M'} \AgdaFunction{×} \AgdaFunction{∃} \AgdaSymbol{(λ} \AgdaBound{N'} \AgdaSymbol{→} \AgdaBound{N'} \AgdaFunction{∼α} \AgdaBound{N} \AgdaFunction{×} \AgdaSymbol{(}\AgdaDatatype{ctx} \AgdaDatatype{\_▹\_}\AgdaSymbol{)} \AgdaBound{M'} \AgdaBound{N'}\AgdaSymbol{))} \<[68]%
\>[68]\<%
\\
%
\\
\>\AgdaKeyword{postulate}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaPostulate{lemma→β⊆→βR} \AgdaSymbol{:} \AgdaFunction{\_→β\_} \AgdaFunction{⊆} \AgdaFunction{\_→βR\_}\<%
\\
\>\AgdaComment{-- lemma→β⊆→βR (M' , M∼M' , BVCM' , N' , N'∼N , M'→βnN') = M' , M∼M' , N' , N'∼N , \{!!\} }\<%
\\
%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaPostulate{lemma→βR⊆→β} \AgdaSymbol{:} \AgdaFunction{\_→βR\_} \AgdaFunction{⊆} \AgdaFunction{\_→β\_}\<%
\\
\>\AgdaComment{-- lemma→βR⊆→β (M' , M∼M' , N' , N'∼N , M'→βRN') = \{!!\}}\<%
\\
%
\\
\>\AgdaKeyword{infix} \AgdaNumber{4} \AgdaFunction{\_→α\_} \<[13]%
\>[13]\<%
\\
\>\AgdaFunction{\_→α\_} \AgdaSymbol{:} \AgdaFunction{Rel}\<%
\\
\>\AgdaFunction{\_→α\_} \AgdaSymbol{=} \AgdaFunction{\_→β\_} \AgdaFunction{∪} \AgdaFunction{\_∼α\_}\<%
\\
%
\\
\>\AgdaKeyword{infix} \AgdaNumber{4} \AgdaFunction{\_→α*\_}\<%
\\
\>\AgdaFunction{\_→α*\_} \AgdaSymbol{:} \AgdaFunction{Rel}\<%
\\
\>\AgdaFunction{\_→α*\_} \AgdaSymbol{=} \AgdaDatatype{star} \AgdaFunction{\_→α\_}\<%
\\
%
\\
\>\AgdaFunction{lemmaBVCN→βn⊆→β} \AgdaSymbol{:} \AgdaFunction{BVCNRel} \AgdaFunction{\_→βn\_} \AgdaFunction{⊆} \AgdaFunction{\_→β\_}\<%
\\
\>\AgdaFunction{lemmaBVCN→βn⊆→β} \AgdaSymbol{\{}\AgdaBound{M}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{N}\AgdaSymbol{\}} \AgdaSymbol{(}\AgdaBound{BVCNM} \AgdaInductiveConstructor{,} \AgdaBound{M→βnN}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaBound{M} \AgdaInductiveConstructor{,} \AgdaFunction{ρ} \AgdaInductiveConstructor{,} \AgdaBound{BVCNM} \AgdaInductiveConstructor{,} \AgdaBound{N} \AgdaInductiveConstructor{,} \AgdaFunction{ρ} \AgdaInductiveConstructor{,} \AgdaBound{M→βnN} \<[72]%
\>[72]\<%
\\
%
\\
\>\AgdaKeyword{infix} \AgdaNumber{4} \AgdaFunction{\_→β*\_}\<%
\\
\>\AgdaFunction{\_→β*\_} \AgdaSymbol{:} \AgdaFunction{Rel}\<%
\\
\>\AgdaFunction{\_→β*\_} \AgdaSymbol{=} \AgdaDatatype{star} \AgdaFunction{\_→β\_}\<%
\\
%
\\
\>\AgdaFunction{lemma→α*α} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{M} \AgdaBound{M'} \AgdaBound{N} \AgdaBound{N'} \AgdaSymbol{:} \AgdaFunction{λTerm}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaBound{M'} \AgdaFunction{∼α} \AgdaBound{M} \AgdaSymbol{→} \AgdaBound{N} \AgdaFunction{∼α} \AgdaBound{N'} \AgdaSymbol{→} \AgdaBound{M} \AgdaFunction{→α*} \AgdaBound{N} \AgdaSymbol{→} \AgdaBound{M'} \AgdaFunction{→α*} \AgdaBound{N'}\<%
\\
\>\AgdaFunction{lemma→α*α} \AgdaBound{M'∼M} \AgdaBound{N∼N'} \AgdaInductiveConstructor{refl} \<[41]%
\>[41]\AgdaSymbol{=} \AgdaInductiveConstructor{just} \AgdaSymbol{(}\AgdaInductiveConstructor{inj₂} \AgdaSymbol{(}\AgdaFunction{τ} \AgdaBound{M'∼M} \AgdaBound{N∼N'}\AgdaSymbol{))}\<%
\\
\>\AgdaFunction{lemma→α*α} \AgdaBound{M'∼M} \AgdaBound{N∼N'} \AgdaSymbol{(}\AgdaInductiveConstructor{just} \AgdaBound{M→αN}\AgdaSymbol{)} \<[41]%
\>[41]\AgdaSymbol{=} \AgdaInductiveConstructor{trans} \AgdaSymbol{(}\AgdaInductiveConstructor{trans} \AgdaSymbol{(}\AgdaInductiveConstructor{just} \AgdaSymbol{(}\AgdaInductiveConstructor{inj₂} \AgdaBound{M'∼M}\AgdaSymbol{))} \AgdaSymbol{(}\AgdaInductiveConstructor{just} \AgdaBound{M→αN}\AgdaSymbol{))} \AgdaSymbol{(}\AgdaInductiveConstructor{just} \AgdaSymbol{(}\AgdaInductiveConstructor{inj₂} \AgdaBound{N∼N'}\AgdaSymbol{))}\<%
\\
\>\AgdaFunction{lemma→α*α} \AgdaBound{M'∼M} \AgdaBound{N∼N'} \AgdaSymbol{(}\AgdaInductiveConstructor{trans} \AgdaBound{M→α*N} \AgdaBound{N→α*P}\AgdaSymbol{)} \<[41]%
\>[41]\AgdaSymbol{=} \AgdaInductiveConstructor{trans} \AgdaSymbol{(}\AgdaFunction{lemma→α*α} \AgdaBound{M'∼M} \AgdaFunction{ρ} \AgdaBound{M→α*N}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{lemma→α*α} \AgdaFunction{ρ} \AgdaBound{N∼N'} \AgdaBound{N→α*P}\AgdaSymbol{)}\<%
\\
%
\\
\>\AgdaKeyword{postulate}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaPostulate{lemma-BVCN→βn*} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{M} \AgdaBound{N} \AgdaSymbol{:} \AgdaFunction{λTerm}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaFunction{BVCN} \AgdaBound{M} \AgdaSymbol{→} \AgdaBound{M} \AgdaFunction{→βn*} \AgdaBound{N} \AgdaSymbol{→} \AgdaFunction{BVCN} \AgdaBound{N}\<%
\\
\>\AgdaComment{-- lemma-BVCN→βn* = \{!!\}}\<%
\\
%
\\
\>\AgdaFunction{lemmaBVCN→βn*⊆→β*} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{M} \AgdaBound{N} \AgdaSymbol{:} \AgdaFunction{λTerm}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaFunction{BVCN} \AgdaBound{M} \AgdaSymbol{→} \AgdaBound{M} \AgdaFunction{→βn*} \AgdaBound{N} \AgdaSymbol{→} \AgdaBound{M} \AgdaFunction{→β*} \AgdaBound{N}\<%
\\
\>\AgdaFunction{lemmaBVCN→βn*⊆→β*} \AgdaBound{BVCM} \AgdaInductiveConstructor{refl} \<[46]%
\>[46]\AgdaSymbol{=} \AgdaInductiveConstructor{refl}\<%
\\
\>\AgdaFunction{lemmaBVCN→βn*⊆→β*} \AgdaBound{BVCM} \AgdaSymbol{(}\AgdaInductiveConstructor{just} \AgdaBound{M→βnN}\AgdaSymbol{)} \<[46]%
\>[46]\AgdaSymbol{=} \AgdaInductiveConstructor{just} \AgdaSymbol{(}\AgdaFunction{lemmaBVCN→βn⊆→β} \AgdaSymbol{(}\AgdaBound{BVCM} \AgdaInductiveConstructor{,} \AgdaBound{M→βnN}\AgdaSymbol{))}\<%
\\
\>\AgdaFunction{lemmaBVCN→βn*⊆→β*} \AgdaBound{BVCM} \AgdaSymbol{(}\AgdaInductiveConstructor{trans} \AgdaBound{M→βn*N} \AgdaBound{N→βn*P}\AgdaSymbol{)} \<[46]%
\>[46]\AgdaSymbol{=} \AgdaInductiveConstructor{trans} \AgdaSymbol{(}\AgdaFunction{lemmaBVCN→βn*⊆→β*} \AgdaBound{BVCM} \AgdaBound{M→βn*N}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{lemmaBVCN→βn*⊆→β*} \AgdaSymbol{(}\AgdaPostulate{lemma-BVCN→βn*} \AgdaBound{BVCM} \AgdaBound{M→βn*N}\AgdaSymbol{)} \AgdaBound{N→βn*P}\AgdaSymbol{)}\<%
\\
%
\\
\>\AgdaFunction{lemma→βn*ƛ} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{x} \AgdaSymbol{:} \AgdaFunction{V}\AgdaSymbol{\}\{}\AgdaBound{M} \AgdaBound{N} \AgdaSymbol{:} \AgdaFunction{λTerm}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaBound{M} \AgdaFunction{→βn*} \AgdaBound{N} \AgdaSymbol{→} \AgdaFunction{ƛ} \AgdaBound{x} \AgdaBound{M} \AgdaFunction{→βn*} \AgdaFunction{ƛ} \AgdaBound{x} \AgdaBound{N}\<%
\\
\>\AgdaFunction{lemma→βn*ƛ} \AgdaInductiveConstructor{refl} \<[32]%
\>[32]\AgdaSymbol{=} \AgdaInductiveConstructor{refl}\<%
\\
\>\AgdaFunction{lemma→βn*ƛ} \AgdaSymbol{(}\AgdaInductiveConstructor{just} \AgdaBound{M→βnN}\AgdaSymbol{)} \<[32]%
\>[32]\AgdaSymbol{=} \AgdaInductiveConstructor{just} \AgdaSymbol{(}\AgdaInductiveConstructor{ctxƛ} \AgdaBound{M→βnN}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{lemma→βn*ƛ} \AgdaSymbol{(}\AgdaInductiveConstructor{trans} \AgdaBound{M→βnN} \AgdaBound{N→βnP}\AgdaSymbol{)} \<[32]%
\>[32]\AgdaSymbol{=} \AgdaInductiveConstructor{trans} \AgdaSymbol{(}\AgdaFunction{lemma→βn*ƛ} \AgdaBound{M→βnN}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{lemma→βn*ƛ} \AgdaBound{N→βnP}\AgdaSymbol{)}\<%
\\
%
\\
\>\AgdaFunction{lemma→βn*·l} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{M} \AgdaBound{M'} \AgdaBound{N} \AgdaSymbol{:} \AgdaFunction{λTerm}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaBound{M} \AgdaFunction{→βn*} \AgdaBound{M'} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{M} \AgdaFunction{·} \AgdaBound{N}\AgdaSymbol{)} \AgdaFunction{→βn*} \AgdaSymbol{(}\AgdaBound{M'} \AgdaFunction{·} \AgdaBound{N}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{lemma→βn*·l} \AgdaInductiveConstructor{refl} \<[33]%
\>[33]\AgdaSymbol{=} \AgdaInductiveConstructor{refl}\<%
\\
\>\AgdaFunction{lemma→βn*·l} \AgdaSymbol{(}\AgdaInductiveConstructor{just} \AgdaBound{M→βnN}\AgdaSymbol{)} \<[33]%
\>[33]\AgdaSymbol{=} \AgdaInductiveConstructor{just} \AgdaSymbol{(}\AgdaInductiveConstructor{ctx·l} \AgdaBound{M→βnN}\AgdaSymbol{)} \<[54]%
\>[54]\<%
\\
\>\AgdaFunction{lemma→βn*·l} \AgdaSymbol{(}\AgdaInductiveConstructor{trans} \AgdaBound{M→βnN} \AgdaBound{N→βnP}\AgdaSymbol{)} \<[33]%
\>[33]\AgdaSymbol{=} \AgdaInductiveConstructor{trans} \AgdaSymbol{(}\AgdaFunction{lemma→βn*·l} \AgdaBound{M→βnN}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{lemma→βn*·l} \AgdaBound{N→βnP}\AgdaSymbol{)}\<%
\\
%
\\
\>\AgdaFunction{lemma→βn*·r} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{M} \AgdaBound{N} \AgdaBound{N'} \AgdaSymbol{:} \AgdaFunction{λTerm}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaBound{N} \AgdaFunction{→βn*} \AgdaBound{N'} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{M} \AgdaFunction{·} \AgdaBound{N}\AgdaSymbol{)} \AgdaFunction{→βn*} \AgdaSymbol{(}\AgdaBound{M} \AgdaFunction{·} \AgdaBound{N'}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{lemma→βn*·r} \AgdaInductiveConstructor{refl} \<[33]%
\>[33]\AgdaSymbol{=} \AgdaInductiveConstructor{refl}\<%
\\
\>\AgdaFunction{lemma→βn*·r} \AgdaSymbol{(}\AgdaInductiveConstructor{just} \AgdaBound{M→βnN}\AgdaSymbol{)} \<[33]%
\>[33]\AgdaSymbol{=} \AgdaInductiveConstructor{just} \AgdaSymbol{(}\AgdaInductiveConstructor{ctx·r} \AgdaBound{M→βnN}\AgdaSymbol{)} \<[54]%
\>[54]\<%
\\
\>\AgdaFunction{lemma→βn*·r} \AgdaSymbol{(}\AgdaInductiveConstructor{trans} \AgdaBound{M→βnN} \AgdaBound{N→βnP}\AgdaSymbol{)} \<[33]%
\>[33]\AgdaSymbol{=} \AgdaInductiveConstructor{trans} \AgdaSymbol{(}\AgdaFunction{lemma→βn*·r} \AgdaBound{M→βnN}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{lemma→βn*·r} \AgdaBound{N→βnP}\AgdaSymbol{)}\<%
\\
%
\\
\>\AgdaFunction{lemma→βn*·} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{M} \AgdaBound{M'} \AgdaBound{N} \AgdaBound{N'} \AgdaSymbol{:} \AgdaFunction{λTerm}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaBound{M} \AgdaFunction{→βn*} \AgdaBound{M'} \AgdaSymbol{→} \AgdaBound{N} \AgdaFunction{→βn*} \AgdaBound{N'} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{M} \AgdaFunction{·} \AgdaBound{N}\AgdaSymbol{)} \AgdaFunction{→βn*} \AgdaSymbol{(}\AgdaBound{M'} \AgdaFunction{·} \AgdaBound{N'}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{lemma→βn*·} \AgdaBound{M→βn*M'} \AgdaBound{N→βn*N'} \AgdaSymbol{=} \AgdaInductiveConstructor{trans} \AgdaSymbol{(}\AgdaFunction{lemma→βn*·l} \AgdaBound{M→βn*M'}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{lemma→βn*·r} \AgdaBound{N→βn*N'}\AgdaSymbol{)}\<%
\\
%
\\
\>\AgdaFunction{lemma→βn*β} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{x} \AgdaSymbol{:} \AgdaFunction{V}\AgdaSymbol{\}\{}\AgdaBound{M} \AgdaBound{M'} \AgdaBound{N} \AgdaBound{N'} \AgdaSymbol{:} \AgdaFunction{λTerm}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaBound{M} \AgdaFunction{→βn*} \AgdaBound{M'} \AgdaSymbol{→} \AgdaBound{N} \AgdaFunction{→βn*} \AgdaBound{N'} \AgdaSymbol{→} \AgdaSymbol{((}\AgdaFunction{ƛ} \AgdaBound{x} \AgdaBound{M}\AgdaSymbol{)} \AgdaFunction{·} \AgdaBound{N}\AgdaSymbol{)} \AgdaFunction{→βn*} \AgdaSymbol{(}\AgdaBound{M'} \AgdaFunction{[} \AgdaBound{x} \AgdaFunction{≔} \AgdaBound{N'} \AgdaFunction{]ₙ}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{lemma→βn*β} \AgdaBound{M→βn*M'} \AgdaBound{N→βn*N'} \AgdaSymbol{=} \<[30]%
\>[30]\AgdaInductiveConstructor{trans} \AgdaSymbol{(}\AgdaFunction{lemma→βn*·} \AgdaSymbol{(}\AgdaFunction{lemma→βn*ƛ} \AgdaBound{M→βn*M'}\AgdaSymbol{)} \AgdaBound{N→βn*N'}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaInductiveConstructor{just} \AgdaSymbol{(}\AgdaInductiveConstructor{ctxinj} \AgdaInductiveConstructor{▹βn}\AgdaSymbol{))}\<%
\\
%
\\
\>\AgdaFunction{lemma→βn⊆⇉n} \AgdaSymbol{:} \AgdaFunction{\_→βn\_} \AgdaFunction{⊆} \AgdaDatatype{\_⇉n\_}\<%
\\
\>\AgdaFunction{lemma→βn⊆⇉n} \AgdaSymbol{(}\AgdaInductiveConstructor{ctxinj} \AgdaInductiveConstructor{▹βn}\AgdaSymbol{)} \<[26]%
\>[26]\AgdaSymbol{=} \AgdaInductiveConstructor{⇉nβ} \<[33]%
\>[33]\AgdaFunction{ρ⇉n} \AgdaFunction{ρ⇉n}\<%
\\
\>\AgdaFunction{lemma→βn⊆⇉n} \AgdaSymbol{(}\AgdaInductiveConstructor{ctx·l} \AgdaBound{r}\AgdaSymbol{)} \<[26]%
\>[26]\AgdaSymbol{=} \AgdaInductiveConstructor{⇉n·} \<[33]%
\>[33]\AgdaSymbol{(}\AgdaFunction{lemma→βn⊆⇉n} \AgdaBound{r}\AgdaSymbol{)} \AgdaFunction{ρ⇉n}\<%
\\
\>\AgdaFunction{lemma→βn⊆⇉n} \AgdaSymbol{(}\AgdaInductiveConstructor{ctx·r} \AgdaBound{r}\AgdaSymbol{)} \<[26]%
\>[26]\AgdaSymbol{=} \AgdaInductiveConstructor{⇉n·} \<[33]%
\>[33]\AgdaFunction{ρ⇉n} \AgdaSymbol{(}\AgdaFunction{lemma→βn⊆⇉n} \AgdaBound{r}\AgdaSymbol{)} \<[53]%
\>[53]\<%
\\
\>\AgdaFunction{lemma→βn⊆⇉n} \AgdaSymbol{(}\AgdaInductiveConstructor{ctxƛ} \AgdaBound{r}\AgdaSymbol{)} \<[26]%
\>[26]\AgdaSymbol{=} \AgdaInductiveConstructor{⇉nƛ} \<[33]%
\>[33]\AgdaSymbol{(}\AgdaFunction{lemma→βn⊆⇉n} \AgdaBound{r}\AgdaSymbol{)}\<%
\\
%
\\
\>\AgdaComment{-- open ∼-Reasoning(λF)}\<%
\\
%
\\
\>\AgdaComment{-- lemma-λxMN⇉M[x:=N] : (M N : λTerm)(x : V) → ƛ x M · N ⇉ M [ x ≔ N ] }\<%
\\
\>\AgdaComment{-- lemma-λxMN⇉M[x:=N] M N x }\<%
\\
\>\AgdaComment{--   with bvcTerm (ƛ x M · N) | lemma-bvcTermα (ƛ x M · N) | lemmaBVC-bvcTerm (ƛ x M · N) | lemmaBVCC-bvcTerm (ƛ x M · N)}\<%
\\
\>\AgdaComment{-- ...  | ⟨ (inj₂ (inj₁ (  ⟨ inj₂ (inj₂ (y , M')) ⟩  , N'))) ⟩  }\<%
\\
\>\AgdaComment{--      | (∼αR (∼α+₂ (∼α+₁ (∼αx (∼αR (∼α+₂ (∼α+₂ (∼αB xs f))))  N'∼N)))) }\<%
\\
\>\AgdaComment{--      | bvc | bvcc}\<%
\\
\>\AgdaComment{--   =  M' [ y ≔ N' ]ₙ          , }\<%
\\
\>\AgdaComment{--      ⇉nβ ρ⇉n ρ⇉n             ,}\<%
\\
\>\AgdaComment{--      (begin}\<%
\\
\>\AgdaComment{--           M'  [ y ≔ N'  ]ₙ}\<%
\\
\>\AgdaComment{--         ∼⟨ σ (lemmaSubsts \{y\} \{M'\} \{N'\} \{!!\}) ⟩}\<%
\\
\>\AgdaComment{--           M'  [ y ≔ N'  ]}\<%
\\
\>\AgdaComment{--         ∼⟨  \{!!\}  ⟩}\<%
\\
\>\AgdaComment{--           (swap SortλTermVars y x M') [ x ≔ N' ]}\<%
\\
\>\AgdaComment{--         ∼⟨ lemma-substα′ \{x\} \{swap SortλTermVars y x M'\} \{N'\} \{N\} N'∼N ⟩}\<%
\\
\>\AgdaComment{--           (swap SortλTermVars y x M') [ x ≔ N  ]}\<%
\\
\>\AgdaComment{--         ≈⟨ lemma-substα \{swap SortλTermVars y x M'\} \{M\} \{N\} \{x\} (lemma∼Bswap \{x = y\} \{x\} \{M'\} \{M\} (∼αB xs f)) ⟩}\<%
\\
\>\AgdaComment{--           M   [ x ≔ N   ]}\<%
\\
\>\AgdaComment{--      ∎)                     }\<%
\\
%
\\
\>\AgdaComment{-- lemma→α⊆⇉ (inj₁ (ctxinj (▹β \{M\} \{N\} \{x\})))  = lemma-λxMN⇉M[x:=N] M N x}\<%
\\
\>\AgdaComment{-- lemma→α⊆⇉ (inj₁ (ctx·l M→αM'))              = lemma-⇉· (lemma→α⊆⇉  (inj₁ M→αM')) ρ⇉}\<%
\\
\>\AgdaComment{-- lemma→α⊆⇉ (inj₁ (ctx·r N→αN'))              = lemma-⇉· ρ⇉ (lemma→α⊆⇉  (inj₁ N→αN')) }\<%
\\
\>\AgdaComment{-- lemma→α⊆⇉ (inj₁ (ctxƛ M→αM'))               = lemma-⇉λ (lemma→α⊆⇉  (inj₁ M→αM'))}\<%
\\
\>\AgdaComment{-- lemma→α⊆⇉ (inj₂ (∼αR f))                    = lemma-⇉rightα ρ⇉ (∼αR f) }\<%
\\
%
\\
\>\AgdaFunction{lemma⇉n⊆→βn*} \AgdaSymbol{:} \AgdaDatatype{\_⇉n\_} \AgdaFunction{⊆} \AgdaFunction{\_→βn*\_}\<%
\\
\>\AgdaFunction{lemma⇉n⊆→βn*} \AgdaInductiveConstructor{⇉nv} \<[30]%
\>[30]\AgdaSymbol{=} \AgdaInductiveConstructor{refl}\<%
\\
\>\AgdaFunction{lemma⇉n⊆→βn*} \AgdaSymbol{(}\AgdaInductiveConstructor{⇉nƛ} \AgdaBound{M⇉M'}\AgdaSymbol{)} \<[30]%
\>[30]\AgdaSymbol{=} \AgdaFunction{lemma→βn*ƛ} \AgdaSymbol{(}\AgdaFunction{lemma⇉n⊆→βn*} \AgdaBound{M⇉M'}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{lemma⇉n⊆→βn*} \AgdaSymbol{(}\AgdaInductiveConstructor{⇉n·} \AgdaBound{M⇉M'} \AgdaBound{N⇉N'}\AgdaSymbol{)} \<[30]%
\>[30]\AgdaSymbol{=} \AgdaFunction{lemma→βn*·} \AgdaSymbol{(}\AgdaFunction{lemma⇉n⊆→βn*} \AgdaBound{M⇉M'}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{lemma⇉n⊆→βn*} \AgdaBound{N⇉N'}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{lemma⇉n⊆→βn*} \AgdaSymbol{(}\AgdaInductiveConstructor{⇉nβ} \AgdaBound{M⇉M'} \AgdaBound{N⇉N'}\AgdaSymbol{)} \<[30]%
\>[30]\AgdaSymbol{=} \AgdaFunction{lemma→βn*β} \AgdaSymbol{(}\AgdaFunction{lemma⇉n⊆→βn*} \AgdaBound{M⇉M'}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{lemma⇉n⊆→βn*} \AgdaBound{N⇉N'}\AgdaSymbol{)}\<%
\\
%
\\
\>\AgdaKeyword{postulate}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaPostulate{lemma-CR⇉n} \AgdaSymbol{:} \AgdaFunction{cr} \AgdaSymbol{(}\AgdaDatatype{\_⇉n\_}\AgdaSymbol{)}\<%
\\
\>\AgdaComment{-- lemma-CR⇉n = diamond-cr \{!diamBVC⇉n!\} --}\<%
\\
%
\\
\>\AgdaFunction{lemma-CR→βn} \AgdaSymbol{:} \AgdaFunction{cr} \AgdaFunction{\_→βn\_}\<%
\\
\>\AgdaFunction{lemma-CR→βn} \AgdaSymbol{=} \AgdaFunction{cr-⊆} \AgdaFunction{lemma→βn⊆⇉n} \AgdaFunction{lemma⇉n⊆→βn*} \AgdaPostulate{lemma-CR⇉n}\<%
\\
%
\\
\>\AgdaFunction{lemma→β⊆⇉} \AgdaSymbol{:} \AgdaFunction{\_→β\_} \AgdaFunction{⊆} \AgdaFunction{\_⇉\_}\<%
\\
\>\AgdaFunction{lemma→β⊆⇉} \AgdaSymbol{(}\AgdaBound{M'} \AgdaInductiveConstructor{,} \AgdaBound{M∼M'} \AgdaInductiveConstructor{,} \AgdaBound{BVCNM'} \AgdaInductiveConstructor{,} \AgdaBound{N'} \AgdaInductiveConstructor{,} \AgdaBound{N'∼N} \AgdaInductiveConstructor{,} \AgdaBound{M'→βN'}\AgdaSymbol{)} \<[52]%
\>[52]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{=} \AgdaBound{M'} \AgdaInductiveConstructor{,} \AgdaBound{M∼M'} \AgdaInductiveConstructor{,} \AgdaBound{BVCNM'} \AgdaInductiveConstructor{,} \AgdaBound{N'} \AgdaInductiveConstructor{,} \AgdaBound{N'∼N} \AgdaInductiveConstructor{,} \AgdaFunction{lemma→βn⊆⇉n} \AgdaBound{M'→βN'}\<%
\\
%
\\
\>\AgdaFunction{lemma∼α⊆⇉} \AgdaSymbol{:} \AgdaFunction{\_∼α\_} \AgdaFunction{⊆} \AgdaFunction{\_⇉\_}\<%
\\
\>\AgdaFunction{lemma∼α⊆⇉} \AgdaSymbol{\{}\AgdaBound{M}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{N}\AgdaSymbol{\}} \AgdaBound{M∼N} \AgdaSymbol{=} \<[25]%
\>[25]\AgdaFunction{M'} \AgdaInductiveConstructor{,} \AgdaFunction{σ} \AgdaFunction{M'∼M} \AgdaInductiveConstructor{,} \AgdaFunction{BVCNM'} \AgdaInductiveConstructor{,} \<[49]%
\>[49]\AgdaFunction{M'} \AgdaInductiveConstructor{,} \AgdaFunction{τ} \AgdaFunction{M'∼M} \AgdaBound{M∼N} \AgdaInductiveConstructor{,} \AgdaFunction{ρ⇉n}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaKeyword{where}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{M'} \AgdaSymbol{=} \AgdaFunction{bvcTerm} \AgdaBound{M}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{M'∼M} \AgdaSymbol{=} \AgdaFunction{lemma-bvcTermα} \AgdaBound{M}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{BVCNM'} \AgdaSymbol{=} \AgdaFunction{lemmasBVCN} \AgdaBound{M}\<%
\\
%
\\
\>\AgdaFunction{lemma→α⊆⇉} \AgdaSymbol{:} \AgdaFunction{\_→α\_} \AgdaFunction{⊆} \AgdaFunction{\_⇉\_}\<%
\\
\>\AgdaFunction{lemma→α⊆⇉} \AgdaSymbol{(}\AgdaInductiveConstructor{inj₁} \AgdaBound{M→βN}\AgdaSymbol{)} \<[23]%
\>[23]\AgdaSymbol{=} \AgdaFunction{lemma→β⊆⇉} \AgdaBound{M→βN}\<%
\\
\>\AgdaFunction{lemma→α⊆⇉} \AgdaSymbol{(}\AgdaInductiveConstructor{inj₂} \AgdaBound{M∼N}\AgdaSymbol{)} \<[23]%
\>[23]\AgdaSymbol{=} \AgdaFunction{lemma∼α⊆⇉} \AgdaBound{M∼N}\<%
\\
%
\\
\>\AgdaFunction{lemma→β⊆→α} \AgdaSymbol{:} \<[14]%
\>[14]\AgdaFunction{\_→β\_} \AgdaFunction{⊆} \AgdaFunction{\_→α\_}\<%
\\
\>\AgdaFunction{lemma→β⊆→α} \AgdaSymbol{=} \AgdaInductiveConstructor{inj₁}\<%
\\
%
\\
\>\AgdaFunction{lemma⇉⊆→α*} \AgdaSymbol{:} \AgdaFunction{\_⇉\_} \AgdaFunction{⊆} \AgdaFunction{\_→α*\_}\<%
\\
\>\AgdaFunction{lemma⇉⊆→α*} \AgdaSymbol{\{}\AgdaBound{M}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{N}\AgdaSymbol{\}} \AgdaSymbol{(}\AgdaBound{M'} \AgdaInductiveConstructor{,} \AgdaBound{M∼M'} \AgdaInductiveConstructor{,} \AgdaBound{BVCNM'} \AgdaInductiveConstructor{,} \AgdaBound{N'} \AgdaInductiveConstructor{,} \AgdaBound{N'∼N} \AgdaInductiveConstructor{,} \AgdaBound{M'⇉nN'}\AgdaSymbol{)} \<[61]%
\>[61]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{=} \AgdaFunction{lemma→α*α} \AgdaBound{M∼M'} \AgdaBound{N'∼N} \AgdaSymbol{(}\AgdaFunction{mon-star} \AgdaFunction{lemma→β⊆→α} \AgdaSymbol{(}\AgdaFunction{lemmaBVCN→βn*⊆→β*} \AgdaBound{BVCNM'} \AgdaSymbol{(}\AgdaFunction{lemma⇉n⊆→βn*} \AgdaBound{M'⇉nN'}\AgdaSymbol{)))} \<[95]%
\>[95]\<%
\\
%
\\
\>\AgdaFunction{lemma-CR⇉} \AgdaSymbol{:} \AgdaFunction{cr} \AgdaFunction{\_⇉\_}\<%
\\
\>\AgdaFunction{lemma-CR⇉} \AgdaSymbol{=} \AgdaFunction{diamond-cr} \AgdaFunction{diam⇉}\<%
\\
%
\\
\>\AgdaFunction{lemma-CR→β} \AgdaSymbol{:} \AgdaFunction{cr} \AgdaFunction{\_→α\_}\<%
\\
\>\AgdaFunction{lemma-CR→β} \AgdaSymbol{=} \AgdaFunction{cr-⊆} \AgdaFunction{lemma→α⊆⇉} \AgdaFunction{lemma⇉⊆→α*} \AgdaFunction{lemma-CR⇉}\<%
\end{code}



